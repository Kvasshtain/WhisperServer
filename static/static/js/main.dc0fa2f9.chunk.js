(this.webpackJsonpwhisper=this.webpackJsonpwhisper||[]).push([[0],Array(23).concat([function(e,t,n){},,,,,,,,function(e,t,n){e.exports=n.p+"static/media/BlueWaitingIcon.599230fc.png"},function(e,t,n){e.exports=n(78)},,,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){e.exports=n.p+"static/media/Whisper.83cc1573.png"},function(e,t,n){},,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),s=n(20),c=n.n(s),o=n(8),u=n(18),i=n(15),l=n(30),p=n(16),d=n(6),m=n.n(d),f=n(14),h=n(9),v="http://localhost:4000/",g={Accept:"application/json","Content-Type":"application/json"};function b(e){return{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}function S(e){if(!e.ok)return{status:e.status,badStatusText:e.statusText,message:e.message}}function E(e){return/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/.test(e)}function w(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(){t(r.result)},r.onerror=n,r.readAsText(e)}))}function y(e,t){return t&&(e=e.map((function(e){var n=t(e.text);return Object(f.a)(Object(f.a)({},e),{},{text:n})}))),e}function C(){return O.apply(this,arguments)}function O(){return(O=Object(h.a)(m.a.mark((function e(){var t,n,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=localStorage,n=t.userJson){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,JSON.parse(n);case 5:if(r=e.sent){e.next=8;break}return e.abrupt("return",null);case 8:return e.abrupt("return",r.token?r.token:null);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return{type:"CHANGE_CURRENT_USER",payload:e}}function N(e){return{type:"CHANGE_CURRENT_CHAT",payload:e}}function k(e){return{type:"SET_AUTHENTICATION_RESULT",payload:e}}function j(e){return function(t){401===e.status&&t(_()),t(U(e))}}function U(e){return{type:"SET_LAST_ERROR",payload:e}}function _(){return function(e){localStorage.removeItem("userJson"),e(k(!1))}}function M(e,t){return{type:"ADD_NEW_SPECIAL_MESSAGES_PREPROCESSOR_FUNCTION",payload:{forwardPreprocessorFunction:e,backwardPreprocessorFunction:t}}}function A(e){return function(t){var n,r,a=localStorage.getItem(e._id);if(a){var s=JSON.parse(a);n=new Function("text",s.forward),r=new Function("text",s.backward)}t(N(e)),t({type:"CLEAR_MESSAGES"}),n&&r&&t(M(n,r))}}function R(e){return function(){var t=Object(h.a)(m.a.mark((function t(n){var r,a,s;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,C();case 3:if(r=t.sent){t.next=6;break}return t.abrupt("return");case 6:return t.next=8,fetch("".concat(v).concat("chats/listRequest/","?user_id=").concat(e),{method:"GET",headers:b(r)});case 8:if(a=t.sent,s=S(a)){t.next=14;break}return t.next=13,a.json();case 13:s=t.sent;case 14:s.badStatusText?(n(j(s)),localStorage.removeItem("token"),localStorage.removeItem("userJson")):n({type:"REFRESH_CHATS_LIST",payload:s}),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(0),console.log("error",t.t0);case 20:case"end":return t.stop()}}),t,null,[[0,17]])})));return function(e){return t.apply(this,arguments)}}()}function T(e,t){return function(){var n=Object(h.a)(m.a.mark((function n(r){var a,s,c,o;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,E(e)){n.next=4;break}return r(U({message:"Bad email: ".concat(e)})),n.abrupt("return");case 4:return a={user:{email:e,name:"",password:t}},n.next=7,fetch(v+"users/login/",{method:"POST",headers:g,body:JSON.stringify(a)});case 7:if(s=n.sent,c=S(s)){n.next=13;break}return n.next=12,s.json();case 12:c=n.sent;case 13:c.badStatusText?(r(j(c)),r(k(!1))):(o=c.user._id,localStorage.setItem("userJson",JSON.stringify(c.user)),r(x(c.user)),r(k(!0)),r(R(o))),n.next=19;break;case 16:n.prev=16,n.t0=n.catch(0),console.log("error",n.t0);case 19:case"end":return n.stop()}}),n,null,[[0,16]])})));return function(e){return n.apply(this,arguments)}}()}function D(e){return function(){var t=Object(h.a)(m.a.mark((function t(n){var r,a,s;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,E(e.email)){t.next=4;break}return n(U({message:"Bad email: ".concat(e.email)})),t.abrupt("return");case 4:return t.next=6,fetch(v+"users/new/",{method:"POST",headers:g,body:JSON.stringify({user:e})});case 6:if(r=t.sent,a=S(r)){t.next=12;break}return t.next=11,r.json();case 11:a=t.sent;case 12:a.badStatusText?(n(j(a)),n(k(!1))):(s=a.user._id,localStorage.setItem("userJson",JSON.stringify(a.user)),n(x(a.user)),n(N({})),n(k(!0)),n(R(s))),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(0),console.log("error",t.t0);case 18:case"end":return t.stop()}}),t,null,[[0,15]])})));return function(e){return t.apply(this,arguments)}}()}function L(e){return{type:"MESSAGE_WAS_RECEIVED",payload:e}}function F(e){return function(t,n){var r=n().currentChat.forwardPreprocessorFunction,a=e;r&&(a=r(e)),t(function(e,t){return function(){var n=Object(h.a)(m.a.mark((function n(r,a){var s,c,o,u,i,l,p,d,h;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,C();case 3:if(s=n.sent){n.next=6;break}return n.abrupt("return");case 6:return r(L(!1)),c="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})).toUpperCase(),o=(new Date).getTime(),u=a().currentUser.email,i=a().currentUser.name,l=a().currentChat._id,p={_id:null,clientSideId:c,chatId:l,time:o,authorEmail:u,authorName:i,text:e},r(I(Object(f.a)(Object(f.a)({},p),{},{text:t}))),n.next=16,fetch(v+"messages/new/",{method:"POST",headers:b(s),body:JSON.stringify(p)});case 16:if(d=n.sent,h=S(d)){n.next=22;break}return n.next=21,d.json();case 21:h=n.sent;case 22:h.status?(r(j(h)),p.wasMessageReceived=!1,localStorage.removeItem("token")):(p.wasMessageReceived=!0,r(L(!0))),n.next=28;break;case 25:n.prev=25,n.t0=n.catch(0),console.log("error",n.t0);case 28:case"end":return n.stop()}}),n,null,[[0,25]])})));return function(e,t){return n.apply(this,arguments)}}()}(a,e))}}function I(e){return{type:"ADD_MSSAGE_TO_WAITING_LIST",payload:e}}function P(e){return function(t,n){var r=n().currentChat.backwardPreprocessorFunction;r&&(e=y(e,r)),t(function(e){return{type:"PUSH_NEW_MESSAGES",payload:e}}(e)),t(function(e){return{type:"REMOVE_MESSAGES_FROM_WAITING_LIST",payload:e.map((function(e){return e.clientSideId}))}}(e))}}var W=Object(i.c)({messages:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CLEAR_MESSAGES":return[];case"ADD_NEW_MESSAGE":return[].concat(Object(p.a)(e),[t.payload]);case"REFRESH_MESSAGES_LIST":return t.payload;case"UNSHIFT_PREVIOUS_MESSAGES":var n=t.payload;return[].concat(Object(p.a)(n),Object(p.a)(e));case"PUSH_NEW_MESSAGES":var r=t.payload;return[].concat(Object(p.a)(e),Object(p.a)(r));default:return e}},wasMessageReceived:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"MESSAGE_WAS_RECEIVED":return t.payload;default:return e}},messagesWaitingList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_MSSAGE_TO_WAITING_LIST":return[].concat(Object(p.a)(e),[t.payload]);case"REMOVE_MESSAGES_FROM_WAITING_LIST":return e.filter((function(e){return!t.payload.includes(e.clientSideId)}));default:return e}},currentUser:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CHANGE_CURRENT_USER":return t.payload;default:return e}},currentChat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CHANGE_CURRENT_CHAT":return t.payload;case"ADD_NEW_SPECIAL_MESSAGES_PREPROCESSOR_FUNCTION":return Object(f.a)(Object(f.a)({},e),t.payload);default:return e}},chatsList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"REFRESH_CHATS_LIST":return t.payload;default:return e}},isUserAuthenticated:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_AUTHENTICATION_RESULT":return t.payload;default:return e}},lastError:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_LAST_ERROR":return t.payload;case"CLEAR_LAST_ERROR":return null;default:return e}},usersList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"FILL_FOUND_USERS_LIST":return t.payload;default:return e}}}),G=function(){var e=null;return function(t){return function(n){return function(r){switch(r.type){case"WS_CONNECT":null!==e&&e.close(),(e=new WebSocket(r.payload)).onmessage=function(e){return function(t){var n=JSON.parse(t.data);switch(n.actionType){case"save":var r=[n.message];e.dispatch(P(r))}}}(t),e.onclose=function(e){return function(){e.dispatch({type:"WS_DISCONNECTED"})}}(t),e.onopen=function(e){return function(t){e.dispatch((t.target.url,{type:"WS_CONNECTED"}))}}(t);break;case"WS_DISCONNECT":null!==e&&e.close(),e=null;break;default:return n(r)}}}}}();n(42);var H=n(1),B=n(2),J=n(4),V=n(3),z=n(7);n(43);function Q(e){return function(t){return a.a.createElement("div",{className:"modalWindow"},a.a.createElement("div",null,a.a.createElement(e,t)))}}n(44);function Z(e){var t=e.caption,n=e.name,r=e.placeholder,s=e.type,c=e.value,o=e.onChange;return a.a.createElement("div",{className:"inputField"},a.a.createElement("label",null,t),a.a.createElement("input",{name:n,placeholder:r,type:s,value:c,onChange:o}))}n(45),n(23),n(46);var q=function(e){Object(J.a)(r,e);var t=Object(V.a)(r);function r(){var e;Object(H.a)(this,r);for(var s=arguments.length,c=new Array(s),o=0;o<s;o++)c[o]=arguments[o];return(e=t.call.apply(t,[this].concat(c))).state={email:"",name:"",password:"",isRegistrationMode:!1},e.onSubmit=function(t){t.preventDefault();var n=e.state,r=n.email,a=n.name,s=n.password,c=n.isRegistrationMode,o=e.props,u=o.onAuthenticationSubmit,i=o.onRegistrationSubmit;c?i({email:r,name:a,password:s}):u(r,s),e.setState({email:"",name:"",password:""})},e.updateUserEmailValue=function(t){e.setState({email:t.target.value})},e.updateUserNameValue=function(t){e.setState({name:t.target.value})},e.updateUserPasswordValue=function(t){e.setState({password:t.target.value})},e.changeMode=function(t){var n=t.target.checked;e.setState({isRegistrationMode:n})},e.renderHeader=function(){var t;return t=e.state.isRegistrationMode?"New user registration":"Login",a.a.createElement("h3",{className:"authenticationAndRegistrationForm__Header"},t)},e.renderLabel=function(){return a.a.createElement("div",{className:"authenticationAndRegistrationForm-Label",align:"center"},a.a.createElement("img",{src:n(47)}))},e.renderUserNameInputField=function(){if(e.state.isRegistrationMode)return a.a.createElement(Z,{caption:"User name",name:"userName",placeholder:"User name",type:"text",value:e.state.name,onChange:e.updateUserNameValue})},e.renderSubmitButton=function(){var t;return t=e.state.isRegistrationMode?"Sign up":"Sign in",a.a.createElement("button",{className:"submitButton",type:"submit"},t)},e}return Object(B.a)(r,[{key:"render",value:function(){return a.a.createElement("div",{className:"authenticationAndRegistrationForm"},a.a.createElement("input",{type:"checkbox",name:"changeMode",onClick:this.changeMode}),a.a.createElement("span",null,"Registration"),a.a.createElement("form",{onSubmit:this.onSubmit},this.renderLabel(),a.a.createElement("div",{align:"center"},this.renderHeader()),this.renderUserNameInputField(),a.a.createElement(Z,{caption:"User email",name:"userEmail",placeholder:"User email",type:"text",value:this.state.email,onChange:this.updateUserEmailValue}),a.a.createElement(Z,{caption:"User password",name:"userPassword",placeholder:"User password",type:"text",value:this.state.password,onChange:this.updateUserPasswordValue}),a.a.createElement("div",{align:"center"},this.renderSubmitButton())))}}]),r}(a.a.Component),X=(n(48),function(e){Object(J.a)(n,e);var t=Object(V.a)(n);function n(){var e;Object(H.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).componentDidUpdate=function(){var t=e.props,n=t.isUserAuthenticated,r=t.history;n&&r.push("/chat")},e}return Object(B.a)(n,[{key:"render",value:function(){var e=this.props,t=e.submitUserEmailAndPassword,n=e.submitNewUser;return a.a.createElement("div",{className:"authenticationAndRegistrationWindow"},a.a.createElement(q,{onAuthenticationSubmit:t,onRegistrationSubmit:n}))}}]),n}(a.a.Component)),$=Object(z.f)(X),Y=Object(o.b)((function(e){return{isUserAuthenticated:e.isUserAuthenticated}}),(function(e){return{submitUserEmailAndPassword:function(t,n){return e(T(t,n))},submitNewUser:function(t){return e(D(t))},onSignOut:function(){return e(_())}}}))($);n(50);n(51);var K=function(e){Object(J.a)(n,e);var t=Object(V.a)(n);function n(){return Object(H.a)(this,n),t.apply(this,arguments)}return Object(B.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"settingsPanel"},a.a.createElement("span",null,this.props.currentUser.name),a.a.createElement("button",{onClick:this.props.onSignOut},"Sign out"))}}]),n}(a.a.Component),ee=Object(o.b)((function(e){return{currentUser:e.currentUser}}),(function(e){return{onSignOut:function(){return e(_())}}}))(K),te=(n(52),function(e){Object(J.a)(n,e);var t=Object(V.a)(n);function n(){var e;Object(H.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).onUserClick=function(){var t=e.props.user;e.props.onUserClick(t)},e}return Object(B.a)(n,[{key:"render",value:function(){var e=this.props.user;return a.a.createElement("div",{className:"userFrame",onClick:this.onUserClick},a.a.createElement("span",null,e.name))}}]),n}(a.a.Component)),ne=function(e){Object(J.a)(n,e);var t=Object(V.a)(n);function n(){var e;Object(H.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).state={userSeekData:""},e.onSubmit=function(t){t.preventDefault(),e.props.onSubmitUserSeekData(e.state.userSeekData),e.setState({searchQueryString:""})},e.updateSearchQueryString=function(t){e.setState({userSeekData:t.target.value})},e}return Object(B.a)(n,[{key:"render",value:function(){return a.a.createElement("form",{onSubmit:this.onSubmit},a.a.createElement(Z,{caption:"User email",name:"userEmail",placeholder:"User email",type:"text",value:this.state.userSeekData,onChange:this.updateSearchQueryString}),a.a.createElement("div",{align:"center"},a.a.createElement("button",{className:"submitButton",type:"submit"},"Find users")))}}]),n}(a.a.Component),re=(n(53),n(54),n(55),function(e){Object(J.a)(n,e);var t=Object(V.a)(n);function n(){var e;Object(H.a)(this,n);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).onSubmitUserSeekData=function(t){e.props.findUsers(t)},e.renderUsersList=function(){var t=e.props,n=t.usersList,r=t.onUserClick;if(n&&n.length)return n.map((function(e){return a.a.createElement(te,{onUserClick:r,key:e._id,user:e})}))},e}return Object(B.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"addToChatNewUserWindow"},a.a.createElement("h4",null,"Search for a new member"),a.a.createElement("button",{className:"closeButton",onClick:this.props.onCancelClick},"X"),a.a.createElement(ne,{onSubmitUserSeekData:this.onSubmitUserSeekData}),a.a.createElement("div",{className:"addToChatNewUserWindow-UsersList"},this.renderUsersList()))}}]),n}(a.a.Component)),ae=(n(56),function(e){Object(J.a)(n,e);var t=Object(V.a)(n);function n(){var e;Object(H.a)(this,n);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).state={file:null,filePath:""},e.updateFile=function(t){e.setState({file:t.target.files[0],filePath:t.target.value}),e.props.updateFile(t)},e.renderFileName=function(){var t=e.state.file,n="";return t&&(n=t.name),a.a.createElement("span",null,n)},e}return Object(B.a)(n,[{key:"render",value:function(){var e=this.props.name;return a.a.createElement("div",{className:"fileInput"},a.a.createElement("div",null,a.a.createElement("span",null,this.renderFileName())),a.a.createElement("div",null,a.a.createElement("label",null,a.a.createElement("input",{name:e,type:"file",value:this.state.filePath,onChange:this.updateFile}),a.a.createElement("span",null,"Open file"))))}}]),n}(a.a.Component)),se=(n(57),function(e){Object(J.a)(n,e);var t=Object(V.a)(n);function n(){var e;Object(H.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).state={file:null},e.onSubmit=function(t){var n=e.state.file,r=e.props.onSubmitFile;t.preventDefault(),n&&r(n)},e.updateMessagesPreprocessorFile=function(t){e.setState({file:t.target.files[0]})},e}return Object(B.a)(n,[{key:"render",value:function(){return a.a.createElement("form",{className:"addFileForm",onSubmit:this.onSubmit},a.a.createElement(ae,{name:"messagesPreprocessorFile",updateFile:this.updateMessagesPreprocessorFile}),a.a.createElement("div",null,a.a.createElement("button",{className:"submitButton",type:"submit"},"Add")))}}]),n}(a.a.Component)),ce=(n(58),function(e){Object(J.a)(n,e);var t=Object(V.a)(n);function n(){return Object(H.a)(this,n),t.apply(this,arguments)}return Object(B.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"specialMessagesPreprocessorMenu"},a.a.createElement("h4",null,"Add special messages preprocessor"),a.a.createElement("button",{className:"closeButton",onClick:this.props.onCancelClick},"X"),a.a.createElement(se,{onSubmitFile:this.props.onSubmit}))}}]),n}(a.a.Component)),oe=(n(59),Q(re)),ue=Q(ce),ie=function(e){Object(J.a)(n,e);var t=Object(V.a)(n);function n(e){var r;return Object(H.a)(this,n),(r=t.call(this,e)).onAddUserButtonClick=function(){r.setState({showAddedUserMenu:!0})},r.onAddSpecialMessagesPreprocessorButtonClick=function(){r.setState({showSpecialMessagesPreprocessorMenu:!0})},r.addNewUserToCurrentChat=function(e){r.cancelUserAdding(),r.props.addNewUserToCurrentChat(e)},r.cancelUserAdding=function(){r.setState({showAddedUserMenu:!1})},r.addNewSpecialMessagesPreprocessor=function(e){r.cancelSpecialMessagesPreprocessorAdding(),r.props.addNewSpecialMessagesPreprocessor(e)},r.cancelSpecialMessagesPreprocessorAdding=function(){r.setState({showSpecialMessagesPreprocessorMenu:!1})},r.renderAddedUserWindow=function(){var e=r.state,t=e.showAddedUserMenu,n=e.showSpecialMessagesPreprocessorMenu,s=r.props,c=s.currentChat,o=s.findUsers,u=s.usersList;return t?a.a.createElement(oe,{findUsers:o,usersList:u,onUserClick:r.addNewUserToCurrentChat,onCancelClick:r.cancelUserAdding}):n?a.a.createElement(ue,{currentChat:c,onSubmit:r.addNewSpecialMessagesPreprocessor,onCancelClick:r.cancelSpecialMessagesPreprocessorAdding}):c._id?a.a.createElement(a.a.Fragment,null,a.a.createElement("button",{onClick:r.onAddUserButtonClick},"Add new user to chat"),a.a.createElement("button",{onClick:r.onAddSpecialMessagesPreprocessorButtonClick},"Add special messages preprocessor")):void 0},r.state={showAddedUserMenu:!1,showSpecialMessagesPreprocessorMenu:!1},r}return Object(B.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"currentChatSettings"},this.renderAddedUserWindow())}}]),n}(a.a.Component),le=Object(o.b)((function(e){return{currentChat:e.currentChat,usersList:e.usersList}}),(function(e){return{findUsers:function(t){return e(function(e){return function(){var t=Object(h.a)(m.a.mark((function t(n){var r,a,s;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,C();case 3:if(r=t.sent){t.next=6;break}return t.abrupt("return");case 6:return t.next=8,fetch("".concat(v).concat("users/search/","?user_seek_data=").concat(e),{method:"GET",headers:b(r)});case 8:if(a=t.sent,s=S(a)){t.next=14;break}return t.next=13,a.json();case 13:s=t.sent;case 14:s.badStatusText?(n(j(s)),localStorage.removeItem("token"),localStorage.removeItem("userJson")):n({type:"FILL_FOUND_USERS_LIST",payload:s}),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(0),console.log("error",t.t0);case 20:case"end":return t.stop()}}),t,null,[[0,17]])})));return function(e){return t.apply(this,arguments)}}()}(t))},addNewUserToCurrentChat:function(t){return e(function(e){return function(){var t=Object(h.a)(m.a.mark((function t(n,r){var a,s,c,o,u;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,C();case 3:if(a=t.sent){t.next=6;break}return t.abrupt("return");case 6:return s=r(),c=s.currentChat,t.next=9,fetch(v+"chats/addNewUser/",{method:"POST",headers:b(a),body:JSON.stringify({chatId:c._id,newUserId:e._id})});case 9:if(o=t.sent,u=S(o)){t.next=15;break}return t.next=14,o.json();case 14:u=t.sent;case 15:u.badStatusText?n(j(u)):n(A(u.chat)),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(0),console.log("error",t.t0);case 21:case"end":return t.stop()}}),t,null,[[0,18]])})));return function(e,n){return t.apply(this,arguments)}}()}(t))},addNewSpecialMessagesPreprocessor:function(t){return e(function(e){return function(){var t=Object(h.a)(m.a.mark((function t(n,r){var a,s,c,o,u,i;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,w(e);case 4:if(a=t.sent,(l=a)&&""!==l.trim()){t.next=8;break}return n(U({message:"File is empty or has wrong format"})),t.abrupt("return");case 8:if((s=JSON.parse(a)).forward&&s.backward){t.next=12;break}return n(U({message:"File has wrong format"})),t.abrupt("return");case 12:c=new Function("text",s.forward),o=new Function("text",s.backward),u=r(),i=u.currentChat,localStorage.setItem(i._id,a),n(M(c,o));case 17:case"end":return t.stop()}var l}),t)})));return function(e,n){return t.apply(this,arguments)}}()}(t))}}}))(ie);n(60);function pe(){return a.a.createElement("div",{className:"topPanel"},a.a.createElement(le,null),a.a.createElement(ee,null))}function de(e){return e<10?"0"+e:e}n(61);function me(e){var t=new Date(e.time),n=de(t.getHours()),r=de(t.getMinutes()),s=de(t.getDate()),c=de(t.getMonth()+1),o=t.getFullYear();return a.a.createElement("div",{className:"messageFrame-MessageTimestamp"},a.a.createElement("span",null,n,":",r," ",s,".",c,".",o))}n(62);function fe(e){return a.a.createElement("span",{className:"messageFrame-AuthorNameLabel"},e.authorName)}function he(e){return a.a.createElement("span",null,e.text)}n(63),n(64),n(65),n(66);var ve=n(31),ge=n.n(ve),be=function(e){Object(J.a)(n,e);var t=Object(V.a)(n);function n(e){var r;return Object(H.a)(this,n),(r=t.call(this,e)).componentDidMount=function(){r.props.hasServerReceivedMessage||(r.statusRenderingDelayId=setTimeout((function(){return r.enableStatusRendering()}),1e3))},r.enableStatusRendering=function(){r.setState({isStatusRenderingEnabled:!0})},r.renderAuthorName=function(){var e=r.props,t=e.message;return e.currentUserEmail===t.authorEmail?void 0:a.a.createElement(fe,{authorName:t.authorName})},r.state={isStatusRenderingEnabled:!1},r}return Object(B.a)(n,[{key:"componentWillUnmount",value:function(){clearInterval(this.statusRenderingDelayId)}},{key:"renderMessageStatus",value:function(){if(!this.props.hasServerReceivedMessage&&this.state.isStatusRenderingEnabled)return a.a.createElement("div",{className:"messageStatus"},a.a.createElement("img",{className:"RotatingImage",src:ge.a}))}},{key:"render",value:function(){var e=this.props,t=e.message,n="messageFrame";return e.currentUserEmail===t.authorEmail?n+=" messageFrame_user_current":n+=" messageFrame_user_another",a.a.createElement("div",{className:n},a.a.createElement("div",null,this.renderMessageStatus()),a.a.createElement("div",null,a.a.createElement("div",null,this.renderAuthorName()),a.a.createElement("div",null,a.a.createElement(he,{text:t.text})),a.a.createElement("div",null,a.a.createElement(me,{time:t.time}))))}}]),n}(a.a.Component);n(67);function Se(e){var t=(new DOMParser).parseFromString("<!doctype html><body>".concat("&#11015"),"text/html").body.textContent;return a.a.createElement("div",{className:"scrollDownButton",onClick:e.onScrollDownClick},t)}n(68),n(69),n(70);var Ee=function(e){Object(J.a)(n,e);var t=Object(V.a)(n);function n(e){var r;return Object(H.a)(this,n),(r=t.call(this,e)).componentDidMount=function(){var e=r.props,t=e.currentChat,n=e.subscribeForNewMessages;r.state.currentChat!==t&&(r.setState({currentChat:t}),n(r.props.currentChat._id)),r.fetchMessages()},r.componentDidUpdate=function(){var e=r.props,t=e.messages,n=e.currentChat,a=e.subscribeForNewMessages,s=r.messageListRef.current;if(r.state.currentChat!==n)return r.reloadMessagesList(),void a(r.props.currentChat._id);if(t){var c=t.length;c<=r.state.previousMessagesLength||(r.setState({previousMessagesLength:c,suspendMessagesFetching:!1}),s&&(s.scrollTop+=30),r.scrollDownIfNeed())}},r.reloadMessagesList=function(){r.setState({currentChat:r.props.currentChat,previousMessagesLength:0,suspendMessagesFetching:!0,needScrollDown:!0}),r.fetchMessagesForced()},r.fetchMessages=function(){r.state.suspendMessagesFetching||r.fetchMessagesForced()},r.fetchMessagesForced=function(){var e=r.props.currentChat,t=r.props.messages;if(e&&e._id&&t){var n=(new Date).getTime(),a=t.length?t[0].time:n;r.props.fetchMessagesList(e._id,a)}},r.fetchNewMessages=function(){var e=r.props.currentChat,t=r.props.messages;if(e&&e._id&&t){var n=t.length-1;n<0?r.fetchMessages():r.props.fetchNewMessages(e._id,t[n].time)}},r.scrollDownIfNeed=function(){r.state.needScrollDown&&(r.setState({needScrollDown:!1}),r.scrollDown())},r.scrollDown=function(){var e=r.messageListRef.current;r.setState({needScrollDown:!1}),e&&(e.scrollTop=e.scrollHeight)},r.onScrollDownClick=function(){r.scrollDown()},r.onScroll=function(){var e=r.messageListRef.current,t=e.scrollHeight,n=e.scrollTop,a=e.clientHeight;r.setState({showScrollDownButton:t-n>=a+200,needScrollDown:t-n==a}),r.state.suspendMessagesFetching||n<200&&(r.setState({suspendMessagesFetching:!0}),r.fetchMessages())},r.renderMessageList=function(e,t){var n=r.props.currentUser,s=e.length;if(e&&s)return e.map((function(e,r){return a.a.createElement("div",{className:"item",key:r},a.a.createElement(be,{hasServerReceivedMessage:t,message:e,currentUserEmail:n.email}))}))},r.renderScrollDownButton=function(){if(r.state.showScrollDownButton)return a.a.createElement(Se,{onScrollDownClick:r.onScrollDownClick})},r.renderChatNameCaption=function(){var e=r.props.currentChat.name;if(e)return a.a.createElement("div",{className:"chatNameCaption"},a.a.createElement("div",null,a.a.createElement("span",null,e)))},r.messageListRef=a.a.createRef(),r.state={enableScrollDown:!0,previousMessagesLength:0,suspendMessagesFetching:!1,currentChat:null,needScrollDown:!0,showScrollDownButton:!1},r}return Object(B.a)(n,[{key:"componentWillUnmount",value:function(){this.props.unsubscribeForNewMessages()}},{key:"tryLoadMessagesUntilScrollAppears",value:function(){var e=this.messageListRef.current;e.offsetWidth<=e.clientWidth&&this.fetchMessages()}},{key:"render",value:function(){(new DOMParser).parseFromString("<!doctype html><body>".concat("&#11015"),"text/html").body.textContent;var e=this.props,t=e.messages,n=e.waitingMessages;return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{ref:this.messageListRef,className:"messageList",onScroll:this.onScroll},this.renderMessageList(t,!0),this.renderMessageList(n,!1)),this.renderScrollDownButton(),this.renderChatNameCaption())}}]),n}(a.a.Component),we=Object(o.b)((function(e){return{messages:e.messages,waitingMessages:e.messagesWaitingList,currentChat:e.currentChat,currentUser:e.currentUser}}),(function(e){return{fetchMessagesList:function(t,n){return e(function(e,t){return function(){var n=Object(h.a)(m.a.mark((function n(r,a){var s,c,o,u;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,C();case 3:if(s=n.sent){n.next=6;break}return n.abrupt("return");case 6:return n.next=8,fetch("".concat(v).concat("messages/listRequest/","?chat_id=").concat(e,"&oldest_message_time=").concat(t,"&fetch_messages_count=").concat(15),{method:"GET",headers:b(s)});case 8:if(c=n.sent,o=S(c)){n.next=14;break}return n.next=13,c.json();case 13:o=n.sent;case 14:o.badStatusText?(r(j(o)),localStorage.removeItem("token")):(u=a().currentChat.backwardPreprocessorFunction,o=y(o,u),r({type:"UNSHIFT_PREVIOUS_MESSAGES",payload:o})),n.next=20;break;case 17:n.prev=17,n.t0=n.catch(0),console.log("error",n.t0);case 20:case"end":return n.stop()}}),n,null,[[0,17]])})));return function(e,t){return n.apply(this,arguments)}}()}(t,n))},fetchNewMessages:function(t,n){return e(function(e,t){return function(){var n=Object(h.a)(m.a.mark((function n(r){var a,s,c;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,C();case 3:if(a=n.sent){n.next=6;break}return n.abrupt("return");case 6:return n.next=8,fetch("".concat(v).concat("messages/lastMessages/","?chat_id=").concat(e,"&newest_message_time=").concat(t),{method:"GET",headers:b(a)});case 8:if(s=n.sent,c=S(s)){n.next=14;break}return n.next=13,s.json();case 13:c=n.sent;case 14:c.badStatusText?(r(j(c)),localStorage.removeItem("token")):r(P(c)),n.next=20;break;case 17:n.prev=17,n.t0=n.catch(0),console.log("error",n.t0);case 20:case"end":return n.stop()}}),n,null,[[0,17]])})));return function(e){return n.apply(this,arguments)}}()}(t,n))},subscribeForNewMessages:function(t){return e(function(e){return function(t){t({type:"WS_CONNECT",payload:"".concat("ws://localhost:4000/").concat(e)})}}(t))},unsubscribeForNewMessages:function(){return e((function(e){e({type:"WS_DISCONNECT"})}))}}}))(Ee),ye=(n(71),function(e){Object(J.a)(n,e);var t=Object(V.a)(n);function n(){var e;Object(H.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).state={newData:""},e.onSubmit=function(t){t.preventDefault(),""!=e.state.newData.trim()&&(e.props.onSubmitNewData(e.state.newData),e.setState({newData:""}))},e.updateInputValue=function(t){e.setState({newData:t.target.value})},e}return Object(B.a)(n,[{key:"render",value:function(){var e=this.props,t=e.caption,n=e.name,r=e.placeholder,s=e.type,c=e.buttonCaption;return a.a.createElement("form",{className:"simpleDataForm",onSubmit:this.onSubmit},a.a.createElement("h4",null,t),a.a.createElement("div",null,a.a.createElement("input",{name:n,placeholder:r,type:s,value:this.state.newData,onChange:this.updateInputValue}),a.a.createElement("button",{type:"submit"},c)))}}]),n}(a.a.Component)),Ce=(n(72),function(e){Object(J.a)(n,e);var t=Object(V.a)(n);function n(){return Object(H.a)(this,n),t.apply(this,arguments)}return Object(B.a)(n,[{key:"renderMessageList",value:function(){if(this.props.currentUser._id&&this.props.currentChat._id)return a.a.createElement(a.a.Fragment,null,a.a.createElement(we,null),a.a.createElement(ye,{onSubmitNewData:this.props.sendNewMessage,caption:"+Message",name:"userMessage",placeholder:"message text",type:"text",buttonCaption:"Send"}))}},{key:"render",value:function(){return a.a.createElement("div",{className:"currentChatPanel"},this.renderMessageList())}}]),n}(a.a.Component)),Oe=Object(o.b)((function(e){return{currentUser:e.currentUser,currentChat:e.currentChat}}),(function(e){return{sendNewMessage:function(t){return e(F(t))}}}))(Ce),xe=(n(73),function(e){Object(J.a)(n,e);var t=Object(V.a)(n);function n(){var e;Object(H.a)(this,n);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).onSelectChat=function(){var t=e.props.chat;e.props.onSelectChat(t)},e.renderUsersList=function(e){if(e&&e.length)return e.map((function(e,t){return a.a.createElement("div",{key:t},a.a.createElement("p",null,e.name))}))},e}return Object(B.a)(n,[{key:"render",value:function(){var e=this.props.chat;return a.a.createElement("div",{className:"chatList-ChatFrame",onClick:this.onSelectChat},a.a.createElement("div",null,a.a.createElement("h4",null,e.name)),a.a.createElement("div",null,a.a.createElement("p",null,"Chat members:"),a.a.createElement("div",null,this.renderUsersList(e.users))))}}]),n}(a.a.Component)),Ne=(n(74),function(e){Object(J.a)(n,e);var t=Object(V.a)(n);function n(){var e;Object(H.a)(this,n);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).renderChatList=function(){var t=e.props,n=t.chatsList,r=t.changeCurrentChat;if(n&&n.length)return n.map((function(e){return a.a.createElement(xe,{onSelectChat:r,key:e._id,chat:e})}))},e}return Object(B.a)(n,[{key:"componentDidMount",value:function(){var e=this.props.currentUser._id;e&&this.props.fetchChatsList(e)}},{key:"render",value:function(){return a.a.createElement("div",{className:"\u0441hatList"},this.renderChatList())}}]),n}(a.a.Component)),ke=Object(o.b)((function(e){return{chatsList:e.chatsList,currentUser:e.currentUser}}),(function(e){return{fetchChatsList:function(t){return e(R(t))},changeCurrentChat:function(t){return e(A(t))}}}))(Ne),je=(n(75),function(e){Object(J.a)(n,e);var t=Object(V.a)(n);function n(){var e;Object(H.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).onSubmitNewChat=function(t){e.props.createNewChat(t,[e.props.currentUser._id])},e}return Object(B.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"userChatsPanel"},a.a.createElement(ke,null),a.a.createElement(ye,{onSubmitNewData:this.onSubmitNewChat,caption:"+Chat",name:"chatName",placeholder:"chat name",type:"text",buttonCaption:"Create"}))}}]),n}(a.a.Component)),Ue=Object(o.b)((function(e){return{currentUser:e.currentUser}}),(function(e){return{createNewChat:function(t,n){return e((r=t,a=n,function(){var e=Object(h.a)(m.a.mark((function e(t,n){var s,c,o,u,i,l;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,C();case 3:if(s=e.sent){e.next=6;break}return e.abrupt("return");case 6:return c={chat:{name:r,users:a}},e.next=9,fetch(v+"chats/new/",{method:"POST",headers:b(s),body:JSON.stringify(c)});case 9:if(o=e.sent,u=S(o)){e.next=15;break}return e.next=14,o.json();case 14:u=e.sent;case 15:u.status?t(j(u)):(i=n(),l=i.currentUser,t(A(u.chat)),t(R(l._id))),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),console.log("error",e.t0);case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(t,n){return e.apply(this,arguments)}}()));var r,a}}}))(je);n(76);function _e(){return a.a.createElement("div",{className:"mainPanel"},a.a.createElement(Ue,null),a.a.createElement(Oe,null))}n(77);var Me=function(e){Object(J.a)(n,e);var t=Object(V.a)(n);function n(){var e;Object(H.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).componentDidUpdate=function(){var t=e.props,n=t.isUserAuthenticated,r=t.history;n||r.push("/login")},e}return Object(B.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"appPanel"},a.a.createElement("div",{className:"mainPanelPlace"},a.a.createElement(_e,null)),a.a.createElement("div",{className:"topPanelPlace"},a.a.createElement(pe,null)))}}]),n}(a.a.Component),Ae=Object(z.f)(Me),Re=Object(o.b)((function(e){return{isUserAuthenticated:e.isUserAuthenticated}}))(Ae),Te=Q((function(e){var t,n,r,s=e.lastError,c=s.status,o=s.badStatusText,u=s.message;return c&&(t=a.a.createElement("p",null,"Status: ",c),n=a.a.createElement("p",null,"Status text: ",o),r=a.a.createElement("p",null,"Message: ",u)),a.a.createElement("div",{className:"errorWindow"},a.a.createElement("div",null,a.a.createElement("h4",null,"Error")),a.a.createElement("div",null,t,n,r),a.a.createElement("button",{onClick:e.onOk},"Ok"))})),De=function(e){Object(J.a)(n,e);var t=Object(V.a)(n);function n(){return Object(H.a)(this,n),t.apply(this,arguments)}return Object(B.a)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.isUserAuthenticated;(0,e.checkIsUserAuthenticated)(),t?this.props.history.push("/chat"):this.props.history.push("/login")}},{key:"renderErrorWindow",value:function(){if(this.props.lastError)return a.a.createElement(Te,{onOk:this.props.clearLastError,lastError:this.props.lastError})}},{key:"renderMainContent",value:function(){return a.a.createElement(z.c,null,a.a.createElement(z.a,{exact:!0,path:"/login",render:function(){return a.a.createElement(Y,null)}}),a.a.createElement(z.a,{path:"/chat",component:Re}))}},{key:"render",value:function(){return a.a.createElement(a.a.Fragment,null,this.renderErrorWindow(),this.renderMainContent())}}]),n}(a.a.Component),Le=Object(z.f)(De),Fe=Object(o.b)((function(e){return{isUserAuthenticated:e.isUserAuthenticated,lastError:e.lastError}}),(function(e){return{checkIsUserAuthenticated:function(){return e(function(){var e=Object(h.a)(m.a.mark((function e(t){var n,r,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=localStorage,r=n.userJson,e.prev=1,r){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,JSON.parse(r);case 6:a=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(1),localStorage.removeItem("userJson"),e.abrupt("return");case 13:t(x(a)),t(k(!0)),t(R(a._id));case 16:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}())},submitUserEmailAndPassword:function(t,n){return e(T(t,n))},submitNewUser:function(t){return e(D(t))},clearLastError:function(){return e({type:"CLEAR_LAST_ERROR"})},onSignOut:function(){return e(_())}}}))(Le);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Ie=Object(i.d)(W,Object(i.a)(l.a,G));c.a.render(a.a.createElement(u.a,null,a.a.createElement(o.a,{store:Ie},a.a.createElement(Fe,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}]),[[32,1,2]]]);
//# sourceMappingURL=main.dc0fa2f9.chunk.js.map