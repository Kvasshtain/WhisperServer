(this.webpackJsonpwhisper=this.webpackJsonpwhisper||[]).push([[0],{18:function(e,t,n){e.exports=n(43)},30:function(e,t,n){},31:function(e,t,n){},32:function(e,t,n){},33:function(e,t,n){},34:function(e,t,n){},35:function(e,t,n){},36:function(e,t,n){},37:function(e,t,n){},38:function(e,t,n){},39:function(e,t,n){},40:function(e,t,n){},41:function(e,t,n){},42:function(e,t,n){},43:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(10),c=n.n(s),o=n(7),u=n(8),i=n(17),l=n(9),p=n(1),d=n.n(p),m="http://localhost:4000/",h="ws://localhost:4000/",f="messages/new/",g="messages/listRequest/",v="messages/lastMessages/",b="chats/new/",S="chats/listRequest/",w="users/login/",E="users/new/",y="users/search/",C="chats/addNewUser/",k=15,O=n(11),N={Accept:"application/json","Content-Type":"application/json"};function x(e){return{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}function M(e){if(!e.ok)return{status:e.status,badStatusText:e.statusText,message:e.message}}function U(e){return/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/.test(e)}function j(e){return new Promise((function(t,n){var a=new FileReader;a.onload=function(){t(a.result)},a.onerror=n,a.readAsText(e)}))}function _(e,t){return t&&(e=e.map((function(e){var n=t(e.text);return Object(O.a)({},e,{text:n})}))),e}function A(){var e,t,n;return d.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(e=localStorage,t=e.userJson){a.next=3;break}return a.abrupt("return",null);case 3:return a.next=5,d.a.awrap(JSON.parse(t));case 5:if(n=a.sent){a.next=8;break}return a.abrupt("return",null);case 8:return a.abrupt("return",n.token?n.token:null);case 9:case"end":return a.stop()}}))}var F="CHANGE_CURRENT_USER",T="CHANGE_CURRENT_CHAT",L="REFRESH_CHATS_LIST",R="SET_AUTHENTICATION_RESULT",D="SET_LAST_ERROR",P="FILL_FOUND_USERS_LIST",I="CLEAR_LAST_ERROR",J="ADD_NEW_SPECIAL_MESSAGES_PREPROCESSOR_FUNCTION";function W(e){return{type:F,payload:e}}function H(e){return{type:T,payload:e}}function B(e){return{type:R,payload:e}}function G(e){return function(t){401===e.status&&t(z()),t(V(e))}}function V(e){return{type:D,payload:e}}function z(){return function(e){localStorage.removeItem("userJson"),e(B(!1))}}function Q(e,t){return{type:J,payload:{forwardPreprocessorFunction:e,backwardPreprocessorFunction:t}}}function Z(e){return function(t){var n,a,r=localStorage.getItem(e._id);if(r){var s=JSON.parse(r);n=new Function("text",s.forward),a=new Function("text",s.backward)}t(H(e)),t({type:se}),n&&a&&t(Q(n,a))}}function q(e){return function(t){var n,a,r;return d.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,d.a.awrap(A());case 3:if(n=s.sent){s.next=6;break}return s.abrupt("return");case 6:return s.next=8,d.a.awrap(fetch("".concat(m).concat(S,"?user_id=").concat(e),{method:"GET",headers:x(n)}));case 8:if(a=s.sent,r=M(a)){s.next=14;break}return s.next=13,d.a.awrap(a.json());case 13:r=s.sent;case 14:r.badStatusText?(t(G(r)),localStorage.removeItem("token"),localStorage.removeItem("userJson")):t({type:L,payload:r}),s.next=20;break;case 17:s.prev=17,s.t0=s.catch(0),console.log("error",s.t0);case 20:case"end":return s.stop()}}),null,null,[[0,17]])}}var $="WS_CONNECT",Y="WS_CONNECTED",K="WS_DISCONNECT",X="WS_DISCONNECTED";var ee="ADD_NEW_MESSAGE",te="MESSAGE_WAS_RECEIVED",ne="REFRESH_MESSAGES_LIST",ae="UNSHIFT_PREVIOUS_MESSAGES",re="PUSH_NEW_MESSAGES",se="CLEAR_MESSAGES";function ce(e){return{type:ee,payload:e}}function oe(e){return{type:te,payload:e}}function ue(e){return function(t,n){var a=n().currentChat.forwardPreprocessorFunction;a&&(e=a(e)),t(function(e){return function(t,n){var a,r,s,c,o,u,i,l;return d.a.async((function(p){for(;;)switch(p.prev=p.next){case 0:return p.prev=0,p.next=3,d.a.awrap(A());case 3:if(a=p.sent){p.next=6;break}return p.abrupt("return");case 6:return t(oe(!1)),r=(new Date).getTime(),s=n().currentUser.email,c=n().currentUser.name,o=n().currentChat._id,u={chatId:o,time:r,authorEmail:s,authorName:c,text:e},p.next=14,d.a.awrap(fetch(m+f,{method:"POST",headers:x(a),body:JSON.stringify(u)}));case 14:if(i=p.sent,l=M(i)){p.next=20;break}return p.next=19,d.a.awrap(i.json());case 19:l=p.sent;case 20:l.status?(t(G(l)),u.wasMessageReceived=!1,t(ce(u)),localStorage.removeItem("token")):(u.wasMessageReceived=!0,t(oe(!0))),p.next=26;break;case 23:p.prev=23,p.t0=p.catch(0),console.log("error",p.t0);case 26:case"end":return p.stop()}}),null,null,[[0,23]])}}(e))}}function ie(e){return function(t,n){var a=n().currentChat.backwardPreprocessorFunction;a&&(e=_(e,a)),t(function(e){return{type:re,payload:e}}(e))}}function le(e){return function(t){var n;t((n="".concat(h).concat(e),{type:$,payload:n}))}}function pe(){return function(e){e({type:K})}}var de=Object(u.c)({messages:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case se:return[];case ee:return[].concat(Object(l.a)(e),[t.payload]);case ne:return t.payload;case ae:var n=t.payload;return[].concat(Object(l.a)(n),Object(l.a)(e));case re:var a=t.payload;return[].concat(Object(l.a)(e),Object(l.a)(a));default:return e}},wasMessageReceived:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case te:return t.payload;default:return e}},currentUser:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case F:return t.payload;default:return e}},currentChat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case T:return t.payload;case J:return Object(O.a)({},e,{},t.payload);default:return e}},chatsList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case L:return t.payload;default:return e}},isUserAuthenticated:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case R:return t.payload;default:return e}},lastError:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case D:return t.payload;case I:return null;default:return e}},usersList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case P:return t.payload;default:return e}}}),me=function(){var e=null,t=function(e){return function(t){e.dispatch((t.target.url,{type:Y}))}},n=function(e){return function(){e.dispatch({type:X})}};return function(a){return function(r){return function(s){switch(s.type){case $:null!==e&&e.close(),(e=new WebSocket(s.payload)).onmessage=function(e){return function(t){var n=JSON.parse(t.data);switch(n.actionType){case"save":var a=[n.message];e.dispatch(ie(a))}}}(a),e.onclose=n(a),e.onopen=t(a);break;case K:null!==e&&e.close(),e=null;break;default:return r(s)}}}}}();n(30);var he=n(2),fe=n(3),ge=n(5),ve=n(4),be=n(6),Se=function(e){function t(){var e,n;Object(he.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(ge.a)(this,(e=Object(ve.a)(t)).call.apply(e,[this].concat(r)))).state={name:"",users:[]},n.onSubmit=function(e){e.preventDefault(),n.props.onSubmitNewChat(n.state.name,[n.props.currentUserId]),n.setState({name:"",users:[]})},n.updateChatNameValue=function(e){n.setState({name:e.target.value})},n}return Object(be.a)(t,e),Object(fe.a)(t,[{key:"render",value:function(){return r.a.createElement("form",{onSubmit:this.onSubmit},r.a.createElement("h4",null,"+Chat"),r.a.createElement("input",{name:"chatName",placeholder:"chat name",type:"text",value:this.state.name,onChange:this.updateChatNameValue}),r.a.createElement("button",{type:"submit"},"Create new chat"))}}]),t}(r.a.Component);function we(e){return e<10?"0"+e:e}n(31);function Ee(e){var t=new Date(e.time),n=we(t.getHours()),a=we(t.getMinutes()),s=we(t.getDate()),c=we(t.getMonth()+1),o=t.getFullYear();return r.a.createElement("div",{className:"messageFrame-MessageTimestamp"},r.a.createElement("span",null,n,":",a," ",s,".",c,".",o))}n(32);function ye(e){return r.a.createElement("span",{className:"messageFrame-AuthorNameLabel"},e.authorName)}function Ce(e){return r.a.createElement("span",null,e.text)}n(33),n(34),n(35);var ke=function(e){function t(){var e,n;Object(he.a)(this,t);for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];return(n=Object(ge.a)(this,(e=Object(ve.a)(t)).call.apply(e,[this].concat(s)))).renderAuthorName=function(){var e=n.props,t=e.message;return e.currentUserEmail===t.authorEmail?void 0:r.a.createElement(ye,{authorName:t.authorName})},n}return Object(be.a)(t,e),Object(fe.a)(t,[{key:"render",value:function(){var e=this.props,t=e.message,n="messageFrame";return e.currentUserEmail===t.authorEmail?n+=" messageFrame_user_current":n+=" messageFrame_user_another",r.a.createElement("div",{className:n},r.a.createElement("div",null,this.renderAuthorName()),r.a.createElement("div",null,r.a.createElement(Ce,{text:t.text})),r.a.createElement("div",null,r.a.createElement(Ee,{time:t.time})))}}]),t}(r.a.Component);n(36);function Oe(e){var t=(new DOMParser).parseFromString("<!doctype html><body>".concat("&#11015"),"text/html").body.textContent;return r.a.createElement("div",{className:"scrollDownButton",onClick:e.onScrollDownClick},t)}var Ne=function(e){function t(){var e,n;Object(he.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(ge.a)(this,(e=Object(ve.a)(t)).call.apply(e,[this].concat(r)))).state={newMessage:""},n.onSubmit=function(e){e.preventDefault(),n.props.onSubmitNewMessage(n.state.newMessage),n.setState({newMessage:""})},n.updateInputValue=function(e){n.setState({newMessage:e.target.value})},n}return Object(be.a)(t,e),Object(fe.a)(t,[{key:"render",value:function(){return r.a.createElement("form",{className:"new-message-input",onSubmit:this.onSubmit},r.a.createElement("h4",null,"+Message"),r.a.createElement("input",{name:"userMessage",placeholder:"message text",type:"text",value:this.state.newMessage,onChange:this.updateInputValue}),r.a.createElement("button",{type:"submit"},"Send message"))}}]),t}(r.a.Component),xe=(n(37),function(e){function t(e){var n;return Object(he.a)(this,t),(n=Object(ge.a)(this,Object(ve.a)(t).call(this,e))).componentDidMount=function(){var e=n.props,t=e.currentChat,a=e.subscribeForNewMessages;n.state.currentChat!==t&&(n.setState({currentChat:t}),a(n.props.currentChat._id)),n.fetchMessages()},n.componentDidUpdate=function(){var e=n.props,t=e.messages,a=e.currentChat,r=e.subscribeForNewMessages,s=n.messageListRef.current;if(n.state.currentChat!==a)return n.reloadMessagesList(),void r(n.props.currentChat._id);if(t){var c=t.length;c!==n.state.previousMessagesLength&&(n.setState({previousMessagesLength:c}),n.setState({suspendMessagesFetching:!1}),s&&(s.scrollTop+=30),n.scrollDownIfEnabled())}},n.reloadMessagesList=function(){n.setState({currentChat:n.props.currentChat}),n.fetchMessagesForced(),n.setState({suspendMessagesFetching:!0})},n.fetchMessages=function(){n.state.suspendMessagesFetching||n.fetchMessagesForced()},n.fetchMessagesForced=function(){var e=n.props.currentChat,t=n.props.messages;if(e&&e._id&&t){var a=(new Date).getTime(),r=t.length?t[0].time:a;n.props.fetchMessagesList(e._id,r)}},n.fetchNewMessages=function(){var e=n.props.currentChat,t=n.props.messages;if(e&&e._id&&t){var a=t.length-1;a<0?n.fetchMessages():n.props.fetchNewMessages(e._id,t[a].time)}},n.scrollDownIfEnabled=function(){n.state.enableScrollDown&&(n.setState({enableScrollDown:!1}),n.scrollDown())},n.scrollDown=function(){var e=n.messageListRef.current;e&&(e.scrollTop=e.scrollHeight)},n.renderMessageList=function(){var e=n.props,t=e.messages,a=e.currentUser,s=t.length;if(t&&s)return t.map((function(e,t){return r.a.createElement("div",{key:t},r.a.createElement(ke,{message:e,currentUserEmail:a.email}))}))},n.onScrollDownClick=function(){n.scrollDown()},n.onScroll=function(){n.messageListRef.current.scrollTop<20&&(n.setState({suspendMessagesFetching:!0}),n.fetchMessages())},n.sendNewMessage=function(e){n.props.sendNewMessage(e),n.setState({enableScrollDown:!0})},n.messageListRef=r.a.createRef(),n.state={enableScrollDown:!0,previousMessagesLength:0,suspendMessagesFetching:!1,currentChat:null},n}return Object(be.a)(t,e),Object(fe.a)(t,[{key:"componentWillUnmount",value:function(){this.props.unsubscribeForNewMessages()}},{key:"tryLoadMessagesUntilScrollAppears",value:function(){var e=this.messageListRef.current;e.offsetWidth<=e.clientWidth&&this.fetchMessages()}},{key:"render",value:function(){(new DOMParser).parseFromString("<!doctype html><body>".concat("&#11015"),"text/html").body.textContent;return r.a.createElement("div",null,r.a.createElement(Oe,{onScrollDownClick:this.onScrollDownClick}),r.a.createElement("div",{ref:this.messageListRef,className:"message-list",onScroll:this.onScroll},this.renderMessageList()),r.a.createElement(Ne,{onSubmitNewMessage:this.sendNewMessage}))}}]),t}(r.a.Component)),Me=Object(o.b)((function(e){return{messages:e.messages,currentChat:e.currentChat,currentUser:e.currentUser}}),(function(e){return{fetchMessagesList:function(t,n){return e(function(e,t){return function(n,a){var r,s,c,o;return d.a.async((function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,u.next=3,d.a.awrap(A());case 3:if(r=u.sent){u.next=6;break}return u.abrupt("return");case 6:return u.next=8,d.a.awrap(fetch("".concat(m).concat(g,"?chat_id=").concat(e,"&oldest_message_time=").concat(t,"&fetch_messages_count=").concat(k),{method:"GET",headers:x(r)}));case 8:if(s=u.sent,c=M(s)){u.next=14;break}return u.next=13,d.a.awrap(s.json());case 13:c=u.sent;case 14:c.badStatusText?(n(G(c)),localStorage.removeItem("token")):(o=a().currentChat.backwardPreprocessorFunction,c=_(c,o),n({type:ae,payload:c})),u.next=20;break;case 17:u.prev=17,u.t0=u.catch(0),console.log("error",u.t0);case 20:case"end":return u.stop()}}),null,null,[[0,17]])}}(t,n))},fetchNewMessages:function(t,n){return e(function(e,t){return function(n,a){var r,s,c;return d.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,d.a.awrap(A());case 3:if(r=a.sent){a.next=6;break}return a.abrupt("return");case 6:return a.next=8,d.a.awrap(fetch("".concat(m).concat(v,"?chat_id=").concat(e,"&newest_message_time=").concat(t),{method:"GET",headers:x(r)}));case 8:if(s=a.sent,c=M(s)){a.next=14;break}return a.next=13,d.a.awrap(s.json());case 13:c=a.sent;case 14:c.badStatusText?(n(G(c)),localStorage.removeItem("token")):n(ie(c)),a.next=20;break;case 17:a.prev=17,a.t0=a.catch(0),console.log("error",a.t0);case 20:case"end":return a.stop()}}),null,null,[[0,17]])}}(t,n))},subscribeForNewMessages:function(t){return e(le(t))},unsubscribeForNewMessages:function(){return e(pe())}}}))(xe),Ue=function(e){function t(){var e,n;Object(he.a)(this,t);for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];return(n=Object(ge.a)(this,(e=Object(ve.a)(t)).call.apply(e,[this].concat(s)))).onSelectChat=function(){var e=n.props.chat;n.props.onSelectChat(e)},n.renderUsersList=function(e){if(e&&e.length)return e.map((function(e,t){return r.a.createElement("div",{key:t},r.a.createElement("p",null,e.name))}))},n}return Object(be.a)(t,e),Object(fe.a)(t,[{key:"render",value:function(){var e=this.props.chat;return r.a.createElement("div",{className:"selected-item",onClick:this.onSelectChat},r.a.createElement("div",null,r.a.createElement("h4",null,e.name)),r.a.createElement("div",null,r.a.createElement("p",null,"Chat members:"),r.a.createElement("div",null,this.renderUsersList(e.users))))}}]),t}(r.a.Component),je=(n(38),function(e){function t(){var e,n;Object(he.a)(this,t);for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];return(n=Object(ge.a)(this,(e=Object(ve.a)(t)).call.apply(e,[this].concat(s)))).renderChatList=function(){var e=n.props,t=e.chatsList,a=e.changeCurrentChat;if(t&&t.length)return t.map((function(e){return r.a.createElement(Ue,{onSelectChat:a,key:e._id,chat:e})}))},n}return Object(be.a)(t,e),Object(fe.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.currentUser._id;e&&this.props.fetchChatsList(e)}},{key:"render",value:function(){return r.a.createElement("div",{className:"\u0441hat-list"},this.renderChatList())}}]),t}(r.a.Component)),_e=Object(o.b)((function(e){return{chatsList:e.chatsList,currentUser:e.currentUser}}),(function(e){return{fetchChatsList:function(t){return e(q(t))},changeCurrentChat:function(t){return e(Z(t))}}}))(je),Ae=function(e){function t(){var e,n;Object(he.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(ge.a)(this,(e=Object(ve.a)(t)).call.apply(e,[this].concat(r)))).onUserClick=function(){var e=n.props.user;n.props.onUserClick(e)},n}return Object(be.a)(t,e),Object(fe.a)(t,[{key:"render",value:function(){var e=this.props.user;return r.a.createElement("div",{className:"selected-item",onClick:this.onUserClick},r.a.createElement("p",null,e.name),r.a.createElement("p",null,e.email))}}]),t}(r.a.Component),Fe=function(e){function t(){var e,n;Object(he.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(ge.a)(this,(e=Object(ve.a)(t)).call.apply(e,[this].concat(r)))).state={userSeekData:""},n.onSubmit=function(e){e.preventDefault(),n.props.onSubmitUserSeekData(n.state.userSeekData),n.setState({searchQueryString:""})},n.updateSearchQueryString=function(e){n.setState({userSeekData:e.target.value})},n}return Object(be.a)(t,e),Object(fe.a)(t,[{key:"render",value:function(){return r.a.createElement("form",{onSubmit:this.onSubmit},r.a.createElement("h1",null,"Search for a new member"),r.a.createElement("label",null,"Enter email"),r.a.createElement("input",{name:"userEmail",placeholder:"User email",type:"text",value:this.state.userSeekData,onChange:this.updateSearchQueryString}),r.a.createElement("button",{type:"submit"},"Find users"))}}]),t}(r.a.Component),Te=function(e){function t(){var e,n;Object(he.a)(this,t);for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];return(n=Object(ge.a)(this,(e=Object(ve.a)(t)).call.apply(e,[this].concat(s)))).onSubmitUserSeekData=function(e){n.props.findUsers(e)},n.renderUsersList=function(){var e=n.props,t=e.usersList,a=e.onUserClick;if(t&&t.length)return t.map((function(e){return r.a.createElement(Ae,{onUserClick:a,key:e._id,user:e})}))},n}return Object(be.a)(t,e),Object(fe.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"cover-div"},r.a.createElement("div",{className:"modal-window"},r.a.createElement(Fe,{onSubmitUserSeekData:this.onSubmitUserSeekData}),this.renderUsersList(),r.a.createElement("button",{onClick:this.props.onCancelClick},"Cancel")))}}]),t}(r.a.Component),Le=function(e){function t(){var e,n;Object(he.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(ge.a)(this,(e=Object(ve.a)(t)).call.apply(e,[this].concat(r)))).state={file:null,filePath:""},n.onSubmit=function(e){var t=n.state.file,a=n.props.onSubmit;e.preventDefault(),t&&a(t)},n.updateMessagesPreprocessorFile=function(e){n.setState({file:e.target.files[0],filePath:e.target.value})},n}return Object(be.a)(t,e),Object(fe.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"cover-div"},r.a.createElement("div",{className:"modal-window"},r.a.createElement("form",{onSubmit:this.onSubmit},r.a.createElement("h4",null,"+Chat"),r.a.createElement("input",{name:"messagesPreprocessorFile",type:"file",value:this.state.filePath,onChange:this.updateMessagesPreprocessorFile}),r.a.createElement("button",{type:"submit"},"Add special messages preprocessor"),r.a.createElement("button",{onClick:this.props.onCancelClick},"Cancel"))))}}]),t}(r.a.Component),Re=function(e){function t(e){var n;return Object(he.a)(this,t),(n=Object(ge.a)(this,Object(ve.a)(t).call(this,e))).onAddUserButtonClick=function(){n.setState({showAddedUserMenu:!0})},n.onAddSpecialMessagesPreprocessorButtonClick=function(){n.setState({showSpecialMessagesPreprocessorMenu:!0})},n.addNewUserToCurrentChat=function(e){n.cancelUserAdding(),n.props.addNewUserToCurrentChat(e)},n.cancelUserAdding=function(){n.setState({showAddedUserMenu:!1})},n.addNewSpecialMessagesPreprocessor=function(e){n.cancelSpecialMessagesPreprocessorAdding(),n.props.addNewSpecialMessagesPreprocessor(e)},n.cancelSpecialMessagesPreprocessorAdding=function(){n.setState({showSpecialMessagesPreprocessorMenu:!1})},n.renderAddedUserWindow=function(){var e=n.state,t=e.showAddedUserMenu,a=e.showSpecialMessagesPreprocessorMenu,s=n.props,c=s.currentChat,o=s.findUsers,u=s.usersList;return t?r.a.createElement(Te,{findUsers:o,usersList:u,onUserClick:n.addNewUserToCurrentChat,onCancelClick:n.cancelUserAdding}):a?r.a.createElement(Le,{currentChat:c,onSubmit:n.addNewSpecialMessagesPreprocessor,onCancelClick:n.cancelSpecialMessagesPreprocessorAdding}):c._id?r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{onClick:n.onAddUserButtonClick},"Add new user to chat"),r.a.createElement("button",{onClick:n.onAddSpecialMessagesPreprocessorButtonClick},"Add special messages preprocessor")):void 0},n.state={showAddedUserMenu:!1,showSpecialMessagesPreprocessorMenu:!1},n}return Object(be.a)(t,e),Object(fe.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("span",null,"Chat: ",this.props.currentChat.name),this.renderAddedUserWindow())}}]),t}(r.a.Component),De=Object(o.b)((function(e){return{currentChat:e.currentChat,usersList:e.usersList}}),(function(e){return{findUsers:function(t){return e(function(e){return function(t){var n,a,r;return d.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,d.a.awrap(A());case 3:if(n=s.sent){s.next=6;break}return s.abrupt("return");case 6:return s.next=8,d.a.awrap(fetch("".concat(m).concat(y,"?user_seek_data=").concat(e),{method:"GET",headers:x(n)}));case 8:if(a=s.sent,r=M(a)){s.next=14;break}return s.next=13,d.a.awrap(a.json());case 13:r=s.sent;case 14:r.badStatusText?(t(G(r)),localStorage.removeItem("token"),localStorage.removeItem("userJson")):t({type:P,payload:r}),s.next=20;break;case 17:s.prev=17,s.t0=s.catch(0),console.log("error",s.t0);case 20:case"end":return s.stop()}}),null,null,[[0,17]])}}(t))},addNewUserToCurrentChat:function(t){return e(function(e){return function(t,n){var a,r,s,c,o;return d.a.async((function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,u.next=3,d.a.awrap(A());case 3:if(a=u.sent){u.next=6;break}return u.abrupt("return");case 6:return r=n(),s=r.currentChat,u.next=9,d.a.awrap(fetch(m+C,{method:"POST",headers:x(a),body:JSON.stringify({chatId:s._id,newUserId:e._id})}));case 9:if(c=u.sent,o=M(c)){u.next=15;break}return u.next=14,d.a.awrap(c.json());case 14:o=u.sent;case 15:o.badStatusText?t(G(o)):t(Z(o.chat)),u.next=21;break;case 18:u.prev=18,u.t0=u.catch(0),console.log("error",u.t0);case 21:case"end":return u.stop()}}),null,null,[[0,18]])}}(t))},addNewSpecialMessagesPreprocessor:function(t){return e(function(e){return function(t,n){var a,r,s,c,o,u;return d.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:if(e){i.next=2;break}return i.abrupt("return");case 2:return i.next=4,d.a.awrap(j(e));case 4:if(a=i.sent,(l=a)&&""!==l.trim()){i.next=8;break}return t(V({message:"File is empty or has wrong format"})),i.abrupt("return");case 8:if((r=JSON.parse(a)).forward&&r.backward){i.next=12;break}return t(V({message:"File has wrong format"})),i.abrupt("return");case 12:s=new Function("text",r.forward),c=new Function("text",r.backward),o=n(),u=o.currentChat,localStorage.setItem(u._id,a),t(Q(s,c));case 17:case"end":return i.stop()}var l}))}}(t))}}}))(Re);n(39);function Pe(e){var t=e.caption,n=e.name,a=e.placeholder,s=e.type,c=e.value,o=e.onChange;return r.a.createElement("div",{className:"inputField"},r.a.createElement("label",null,t),r.a.createElement("input",{name:n,placeholder:a,type:s,value:c,onChange:o}))}n(40),n(41);var Ie=function(e){function t(){var e,n;Object(he.a)(this,t);for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];return(n=Object(ge.a)(this,(e=Object(ve.a)(t)).call.apply(e,[this].concat(s)))).state={email:"",name:"",password:"",isRegistrationMode:!1},n.onSubmit=function(e){e.preventDefault();var t=n.state,a=t.email,r=t.name,s=t.password,c=t.isRegistrationMode,o=n.props,u=o.onAuthenticationSubmit,i=o.onRegistrationSubmit;c?i({email:a,name:r,password:s}):u(a,s),n.setState({email:"",name:"",password:""})},n.updateUserEmailValue=function(e){n.setState({email:e.target.value})},n.updateUserNameValue=function(e){n.setState({name:e.target.value})},n.updateUserPasswordValue=function(e){n.setState({password:e.target.value})},n.changeMode=function(e){var t=e.target.checked;n.setState({isRegistrationMode:t})},n.renderHeader=function(){var e;return e=n.state.isRegistrationMode?"New user registration":"Login",r.a.createElement("h3",{className:"registrationForm__Header"},e)},n.renderUserNameInputField=function(){if(n.state.isRegistrationMode)return r.a.createElement(Pe,{caption:"User name",name:"userName",placeholder:"User name",type:"text",value:n.state.name,onChange:n.updateUserNameValue})},n.renderSubmitButton=function(){var e;return e=n.state.isRegistrationMode?"Sign up":"Sign in",r.a.createElement("button",{className:"registrationForm__SubmitButton",type:"submit"},e)},n}return Object(be.a)(t,e),Object(fe.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("input",{type:"checkbox",onClick:this.changeMode}),r.a.createElement("span",null,"Registration"),r.a.createElement("form",{onSubmit:this.onSubmit,className:"registrationForm"},r.a.createElement("div",{align:"center"},this.renderHeader()),this.renderUserNameInputField(),r.a.createElement(Pe,{caption:"User email",name:"userEmail",placeholder:"User email",type:"text",value:this.state.email,onChange:this.updateUserEmailValue}),r.a.createElement(Pe,{caption:"User password",name:"userPassword",placeholder:"User password",type:"text",value:this.state.password,onChange:this.updateUserPasswordValue}),r.a.createElement("div",{align:"center"},this.renderSubmitButton())))}}]),t}(r.a.Component);function Je(e){return r.a.createElement("div",null,r.a.createElement("button",{onClick:e.onSignOut},"Sign out"),r.a.createElement("span",null,e.currentUserName))}function We(e){var t,n,a,s=e.lastError,c=s.status,o=s.badStatusText,u=s.message;return c&&(t=r.a.createElement("p",null,"Status: ",c)),c&&(n=r.a.createElement("p",null,"Status text: ",o)),c&&(a=r.a.createElement("p",null,"Message: ",u)),r.a.createElement("div",{className:"moda-window"},r.a.createElement("div",null,r.a.createElement("h4",null,"Error")),r.a.createElement("div",null,t,n,a),r.a.createElement("button",{onClick:e.onOk},"Ok"))}n(42);var He=function(e){function t(){var e,n;Object(he.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(ge.a)(this,(e=Object(ve.a)(t)).call.apply(e,[this].concat(r)))).onSignOut=function(){n.props.resetAuthenticationResult()},n}return Object(be.a)(t,e),Object(fe.a)(t,[{key:"componentDidMount",value:function(){this.props.checkIsUserAuthenticated()}},{key:"renderChatListNewChatForm",value:function(){if(this.props.currentUser._id)return r.a.createElement("div",null,r.a.createElement(_e,null),r.a.createElement(Se,{onSubmitNewChat:this.props.createNewChat,currentUserId:this.props.currentUser._id}))}},{key:"renderMessageList",value:function(){if(this.props.currentUser._id&&this.props.currentChat._id)return r.a.createElement(Me,{sendNewMessage:this.props.sendNewMessage})}},{key:"renderErrorWindow",value:function(){if(this.props.lastError)return r.a.createElement("div",{className:"cover-div"},r.a.createElement(We,{className:"modal-window",onOk:this.props.clearLastError,lastError:this.props.lastError}))}},{key:"renderMainContent",value:function(){return this.props.isUserAuthenticated?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"main-panel"},r.a.createElement("div",{className:"user-chats-panel"},this.renderChatListNewChatForm()),r.a.createElement("div",{className:"current-chat-panel"},this.renderMessageList())),r.a.createElement("div",{className:"top-panel"},r.a.createElement(Je,{className:"settings-panel",onSignOut:this.onSignOut,currentUserName:this.props.currentUser.name}),r.a.createElement(De,{className:"current-chat-settings"}))):r.a.createElement(r.a.Fragment,null,this.renderErrorWindow(),r.a.createElement("div",{className:"reg-auth-forms-panel"},r.a.createElement(Ie,{onAuthenticationSubmit:this.props.submitUserEmailAndPassword,onRegistrationSubmit:this.props.submitNewUser})))}},{key:"render",value:function(){return r.a.createElement("div",{className:"app-panel"},this.renderMainContent())}}]),t}(r.a.Component),Be=Object(o.b)((function(e){return{currentUser:e.currentUser,currentChat:e.currentChat,wasMessageReceived:e.wasMessageReceived,isUserAuthenticated:e.isUserAuthenticated,lastError:e.lastError}}),(function(e){return{checkIsUserAuthenticated:function(){return e((function(e){var t,n,a;return d.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(t=localStorage,n=t.userJson,r.prev=1,n){r.next=4;break}return r.abrupt("return");case 4:return r.next=6,d.a.awrap(JSON.parse(n));case 6:a=r.sent,r.next=13;break;case 9:return r.prev=9,r.t0=r.catch(1),localStorage.removeItem("userJson"),r.abrupt("return");case 13:e(W(a)),e(B(!0)),e(q(a._id));case 16:case"end":return r.stop()}}),null,null,[[1,9]])}))},createNewChat:function(t,n){return e((a=t,r=n,function(e,t){var n,s,c,o,u,i;return d.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:return l.prev=0,l.next=3,d.a.awrap(A());case 3:if(n=l.sent){l.next=6;break}return l.abrupt("return");case 6:return s={chat:{name:a,users:r}},l.next=9,d.a.awrap(fetch(m+b,{method:"POST",headers:x(n),body:JSON.stringify(s)}));case 9:if(c=l.sent,o=M(c)){l.next=15;break}return l.next=14,d.a.awrap(c.json());case 14:o=l.sent;case 15:o.status?e(G(o)):(u=t(),i=u.currentUser,e(Z(o.chat)),e(q(i._id))),l.next=21;break;case 18:l.prev=18,l.t0=l.catch(0),console.log("error",l.t0);case 21:case"end":return l.stop()}}),null,null,[[0,18]])}));var a,r},sendNewMessage:function(t){return e(ue(t))},submitUserEmailAndPassword:function(t,n){return e((a=t,r=n,function(e){var t,n,s,c;return d.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:if(o.prev=0,U(a)){o.next=4;break}return e(V({message:"Bad email: ".concat(a)})),o.abrupt("return");case 4:return t={user:{email:a,name:"",password:r}},o.next=7,d.a.awrap(fetch(m+w,{method:"POST",headers:N,body:JSON.stringify(t)}));case 7:if(n=o.sent,s=M(n)){o.next=13;break}return o.next=12,d.a.awrap(n.json());case 12:s=o.sent;case 13:s.badStatusText?(e(G(s)),e(B(!1))):(c=s.user._id,localStorage.setItem("userJson",JSON.stringify(s.user)),e(W(s.user)),e(B(!0)),e(q(c))),o.next=19;break;case 16:o.prev=16,o.t0=o.catch(0),console.log("error",o.t0);case 19:case"end":return o.stop()}}),null,null,[[0,16]])}));var a,r},submitNewUser:function(t){return e(function(e){return function(t){var n,a,r;return d.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:if(s.prev=0,U(e.email)){s.next=4;break}return t(V({message:"Bad email: ".concat(e.email)})),s.abrupt("return");case 4:return s.next=6,d.a.awrap(fetch(m+E,{method:"POST",headers:N,body:JSON.stringify({user:e})}));case 6:if(n=s.sent,a=M(n)){s.next=12;break}return s.next=11,d.a.awrap(n.json());case 11:a=s.sent;case 12:a.badStatusText?(t(G(a)),t(B(!1))):(r=a.user._id,localStorage.setItem("userJson",JSON.stringify(a.user)),t(W(a.user)),t(H({})),t(B(!0)),t(q(r))),s.next=18;break;case 15:s.prev=15,s.t0=s.catch(0),console.log("error",s.t0);case 18:case"end":return s.stop()}}),null,null,[[0,15]])}}(t))},resetAuthenticationResult:function(){return e(z())},clearLastError:function(){return e({type:I})}}}))(He);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Ge=Object(u.d)(de,Object(u.a)(i.a,me));c.a.render(r.a.createElement(o.a,{store:Ge},r.a.createElement(Be,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[18,1,2]]]);
//# sourceMappingURL=main.7041fdfd.chunk.js.map