(this.webpackJsonpwhisper=this.webpackJsonpwhisper||[]).push([[0],[,,,,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"c",(function(){return CHANGE_CURRENT_USER})),__webpack_require__.d(__webpack_exports__,"b",(function(){return CHANGE_CURRENT_CHAT})),__webpack_require__.d(__webpack_exports__,"f",(function(){return REFRESH_CHATS_LIST})),__webpack_require__.d(__webpack_exports__,"g",(function(){return SET_AUTHENTICATION_RESULT})),__webpack_require__.d(__webpack_exports__,"h",(function(){return SET_LAST_ERROR})),__webpack_require__.d(__webpack_exports__,"e",(function(){return FILL_FOUND_USERS_LIST})),__webpack_require__.d(__webpack_exports__,"d",(function(){return CLEAR_LAST_ERROR})),__webpack_require__.d(__webpack_exports__,"a",(function(){return ADD_NEW_SPECIAL_MESSAGES_PREPROCESSOR_FUNCTION})),__webpack_require__.d(__webpack_exports__,"p",(function(){return handleServerError})),__webpack_require__.d(__webpack_exports__,"q",(function(){return resetAuthenticationResult})),__webpack_require__.d(__webpack_exports__,"l",(function(){return clearLastError})),__webpack_require__.d(__webpack_exports__,"k",(function(){return checkIsUserAuthenticated})),__webpack_require__.d(__webpack_exports__,"i",(function(){return addNewSpecialMessagesPreprocessor})),__webpack_require__.d(__webpack_exports__,"t",(function(){return tryGetPreprocessorAnd\u0421hangeCurrentChat})),__webpack_require__.d(__webpack_exports__,"m",(function(){return createNewChat})),__webpack_require__.d(__webpack_exports__,"n",(function(){return fetchChatsList})),__webpack_require__.d(__webpack_exports__,"s",(function(){return submitUserEmailAndPassword})),__webpack_require__.d(__webpack_exports__,"r",(function(){return submitNewUser})),__webpack_require__.d(__webpack_exports__,"o",(function(){return findUsers})),__webpack_require__.d(__webpack_exports__,"j",(function(){return addNewUserToCurrentChat}));var _home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(8),_home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__),_home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(13),_applicationSettings__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(9),_messageListActions__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(12),_helper__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(6),CHANGE_CURRENT_USER="CHANGE_CURRENT_USER",CHANGE_CURRENT_CHAT="CHANGE_CURRENT_CHAT",REFRESH_CHATS_LIST="REFRESH_CHATS_LIST",SET_AUTHENTICATION_RESULT="SET_AUTHENTICATION_RESULT",SET_LAST_ERROR="SET_LAST_ERROR",FILL_FOUND_USERS_LIST="FILL_FOUND_USERS_LIST",CLEAR_LAST_ERROR="CLEAR_LAST_ERROR",ADD_NEW_SPECIAL_MESSAGES_PREPROCESSOR_FUNCTION="ADD_NEW_SPECIAL_MESSAGES_PREPROCESSOR_FUNCTION";function changeCurrentUser(e){return{type:CHANGE_CURRENT_USER,payload:e}}function changeCurrentChat(e){return{type:CHANGE_CURRENT_CHAT,payload:e}}function refreshChatsList(e){return{type:REFRESH_CHATS_LIST,payload:e}}function setAuthenticationResult(e){return{type:SET_AUTHENTICATION_RESULT,payload:e}}function handleServerError(e){return function(t){401===e.status&&t(resetAuthenticationResult()),t(setLastError(e))}}function setLastError(e){return{type:SET_LAST_ERROR,payload:e}}function fillFoundUsersList(e){return{type:FILL_FOUND_USERS_LIST,payload:e}}function resetAuthenticationResult(){return function(e){localStorage.removeItem("userJson"),e(setAuthenticationResult(!1))}}function clearLastError(){return{type:CLEAR_LAST_ERROR}}function addNewSpecialMessagesPreprocessorFunction(e,t){return{type:ADD_NEW_SPECIAL_MESSAGES_PREPROCESSOR_FUNCTION,payload:{forwardPreprocessorFunction:e,backwardPreprocessorFunction:t}}}function checkIsUserAuthenticated(){return function(){var e=Object(_home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__.a)(_home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark((function e(t){var r,n,a;return _home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=localStorage,n=r.userJson,e.prev=1,n){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,JSON.parse(n);case 6:a=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(1),localStorage.removeItem("userJson"),e.abrupt("return");case 13:t(changeCurrentUser(a)),t(setAuthenticationResult(!0)),t(fetchChatsList(a._id));case 16:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}()}function addNewSpecialMessagesPreprocessor(file){return function(){var _ref2=Object(_home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__.a)(_home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark((function _callee2(dispatch,getState){var preprocessorString,createTextMutators,mutators,forward,backward,_getState,currentChat;return _home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(file){_context2.next=2;break}return _context2.abrupt("return");case 2:return _context2.next=4,Object(_helper__WEBPACK_IMPORTED_MODULE_4__.g)(file);case 4:if(preprocessorString=_context2.sent,!Object(_helper__WEBPACK_IMPORTED_MODULE_4__.f)(preprocessorString)){_context2.next=8;break}return dispatch(setLastError({message:"File is empty or has wrong format"})),_context2.abrupt("return");case 8:if(eval(preprocessorString),createTextMutators){_context2.next=12;break}return dispatch(setLastError({message:"File has wrong format"})),_context2.abrupt("return");case 12:if(mutators=createTextMutators(),mutators){_context2.next=16;break}return dispatch(setLastError({message:"File has wrong format"})),_context2.abrupt("return");case 16:if(forward=mutators.forward,backward=mutators.backward,"function"===typeof forward&&"function"===typeof backward){_context2.next=20;break}return dispatch(setLastError({message:"File has wrong format"})),_context2.abrupt("return");case 20:_getState=getState(),currentChat=_getState.currentChat,localStorage.setItem(currentChat._id,preprocessorString),dispatch(addNewSpecialMessagesPreprocessorFunction(forward,backward));case 23:case"end":return _context2.stop()}}),_callee2)})));return function(e,t){return _ref2.apply(this,arguments)}}()}function tryGetPreprocessorAnd\u0421hangeCurrentChat(e){return function(t){var r,n,a=localStorage.getItem(e._id);if(a){var s=JSON.parse(a);r=new Function("text",s.forward),n=new Function("text",s.backward)}t(changeCurrentChat(e)),t(Object(_messageListActions__WEBPACK_IMPORTED_MODULE_3__.h)()),r&&n&&t(addNewSpecialMessagesPreprocessorFunction(r,n))}}function createNewChat(e,t){return function(){var r=Object(_home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__.a)(_home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark((function r(n,a){var s,c,o,u,_,i;return _home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,Object(_helper__WEBPACK_IMPORTED_MODULE_4__.d)();case 3:if(s=r.sent){r.next=6;break}return r.abrupt("return");case 6:return c={chat:{name:e,users:t}},r.next=9,fetch(_applicationSettings__WEBPACK_IMPORTED_MODULE_2__.h+_applicationSettings__WEBPACK_IMPORTED_MODULE_2__.i,{method:"POST",headers:Object(_helper__WEBPACK_IMPORTED_MODULE_4__.c)(s),body:JSON.stringify(c)});case 9:if(o=r.sent,u=Object(_helper__WEBPACK_IMPORTED_MODULE_4__.a)(o)){r.next=15;break}return r.next=14,o.json();case 14:u=r.sent;case 15:u.status?n(handleServerError(u)):(_=a(),i=_.currentUser,n(tryGetPreprocessorAnd\u0421hangeCurrentChat(u.chat)),n(fetchChatsList(i._id))),r.next=21;break;case 18:r.prev=18,r.t0=r.catch(0),console.log("error",r.t0);case 21:case"end":return r.stop()}}),r,null,[[0,18]])})));return function(e,t){return r.apply(this,arguments)}}()}function fetchChatsList(e){return function(){var t=Object(_home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__.a)(_home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark((function t(r){var n,a,s;return _home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(_helper__WEBPACK_IMPORTED_MODULE_4__.d)();case 3:if(n=t.sent){t.next=6;break}return t.abrupt("return");case 6:return t.next=8,fetch("".concat(_applicationSettings__WEBPACK_IMPORTED_MODULE_2__.h).concat(_applicationSettings__WEBPACK_IMPORTED_MODULE_2__.b,"?user_id=").concat(e),{method:"GET",headers:Object(_helper__WEBPACK_IMPORTED_MODULE_4__.c)(n)});case 8:if(a=t.sent,s=Object(_helper__WEBPACK_IMPORTED_MODULE_4__.a)(a)){t.next=14;break}return t.next=13,a.json();case 13:s=t.sent;case 14:s.badStatusText?(r(handleServerError(s)),localStorage.removeItem("token"),localStorage.removeItem("userJson")):r(refreshChatsList(s)),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(0),console.log("error",t.t0);case 20:case"end":return t.stop()}}),t,null,[[0,17]])})));return function(e){return t.apply(this,arguments)}}()}function submitUserEmailAndPassword(e,t){return function(){var r=Object(_home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__.a)(_home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark((function r(n){var a,s,c,o;return _home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,Object(_helper__WEBPACK_IMPORTED_MODULE_4__.h)(e)){r.next=4;break}return n(setLastError({message:"Bad email: ".concat(e)})),r.abrupt("return");case 4:return a={user:{email:e,name:"",password:t}},r.next=7,fetch(_applicationSettings__WEBPACK_IMPORTED_MODULE_2__.h+_applicationSettings__WEBPACK_IMPORTED_MODULE_2__.k,{method:"POST",headers:_helper__WEBPACK_IMPORTED_MODULE_4__.e,body:JSON.stringify(a)});case 7:if(s=r.sent,c=Object(_helper__WEBPACK_IMPORTED_MODULE_4__.a)(s)){r.next=13;break}return r.next=12,s.json();case 12:c=r.sent;case 13:c.badStatusText?(n(handleServerError(c)),n(setAuthenticationResult(!1))):(o=c.user._id,localStorage.setItem("userJson",JSON.stringify(c.user)),n(changeCurrentUser(c.user)),n(setAuthenticationResult(!0)),n(fetchChatsList(o))),r.next=19;break;case 16:r.prev=16,r.t0=r.catch(0),console.log("error",r.t0);case 19:case"end":return r.stop()}}),r,null,[[0,16]])})));return function(e){return r.apply(this,arguments)}}()}function submitNewUser(e){return function(){var t=Object(_home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__.a)(_home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark((function t(r){var n,a,s;return _home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,Object(_helper__WEBPACK_IMPORTED_MODULE_4__.h)(e.email)){t.next=4;break}return r(setLastError({message:"Bad email: ".concat(e.email)})),t.abrupt("return");case 4:return t.next=6,fetch(_applicationSettings__WEBPACK_IMPORTED_MODULE_2__.h+_applicationSettings__WEBPACK_IMPORTED_MODULE_2__.j,{method:"POST",headers:_helper__WEBPACK_IMPORTED_MODULE_4__.e,body:JSON.stringify({user:e})});case 6:if(n=t.sent,a=Object(_helper__WEBPACK_IMPORTED_MODULE_4__.a)(n)){t.next=12;break}return t.next=11,n.json();case 11:a=t.sent;case 12:a.badStatusText?(r(handleServerError(a)),r(setAuthenticationResult(!1))):(s=a.user._id,localStorage.setItem("userJson",JSON.stringify(a.user)),r(changeCurrentUser(a.user)),r(changeCurrentChat({})),r(setAuthenticationResult(!0)),r(fetchChatsList(s))),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(0),console.log("error",t.t0);case 18:case"end":return t.stop()}}),t,null,[[0,15]])})));return function(e){return t.apply(this,arguments)}}()}function findUsers(e){return function(){var t=Object(_home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__.a)(_home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark((function t(r){var n,a,s;return _home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(_helper__WEBPACK_IMPORTED_MODULE_4__.d)();case 3:if(n=t.sent){t.next=6;break}return t.abrupt("return");case 6:return t.next=8,fetch("".concat(_applicationSettings__WEBPACK_IMPORTED_MODULE_2__.h).concat(_applicationSettings__WEBPACK_IMPORTED_MODULE_2__.g,"?user_seek_data=").concat(e),{method:"GET",headers:Object(_helper__WEBPACK_IMPORTED_MODULE_4__.c)(n)});case 8:if(a=t.sent,s=Object(_helper__WEBPACK_IMPORTED_MODULE_4__.a)(a)){t.next=14;break}return t.next=13,a.json();case 13:s=t.sent;case 14:s.badStatusText?(r(handleServerError(s)),localStorage.removeItem("token"),localStorage.removeItem("userJson")):r(fillFoundUsersList(s)),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(0),console.log("error",t.t0);case 20:case"end":return t.stop()}}),t,null,[[0,17]])})));return function(e){return t.apply(this,arguments)}}()}function addNewUserToCurrentChat(e){return function(){var t=Object(_home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__.a)(_home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark((function t(r,n){var a,s,c,o,u;return _home_kvasshtain_js_projects_Whisper_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(_helper__WEBPACK_IMPORTED_MODULE_4__.d)();case 3:if(a=t.sent){t.next=6;break}return t.abrupt("return");case 6:return s=n(),c=s.currentChat,t.next=9,fetch(_applicationSettings__WEBPACK_IMPORTED_MODULE_2__.h+_applicationSettings__WEBPACK_IMPORTED_MODULE_2__.a,{method:"POST",headers:Object(_helper__WEBPACK_IMPORTED_MODULE_4__.c)(a),body:JSON.stringify({chatId:c._id,newUserId:e._id})});case 9:if(o=t.sent,u=Object(_helper__WEBPACK_IMPORTED_MODULE_4__.a)(o)){t.next=15;break}return t.next=14,o.json();case 14:u=t.sent;case 15:u.badStatusText?r(handleServerError(u)):r(tryGetPreprocessorAnd\u0421hangeCurrentChat(u.chat)),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(0),console.log("error",t.t0);case 21:case"end":return t.stop()}}),t,null,[[0,18]])})));return function(e,r){return t.apply(this,arguments)}}()}},function(e,t,r){"use strict";r.d(t,"e",(function(){return o})),r.d(t,"c",(function(){return u})),r.d(t,"a",(function(){return _})),r.d(t,"h",(function(){return i})),r.d(t,"g",(function(){return l})),r.d(t,"f",(function(){return p})),r.d(t,"b",(function(){return d})),r.d(t,"d",(function(){return h}));var n=r(8),a=r.n(n),s=r(13),c=r(26),o={Accept:"application/json","Content-Type":"application/json"};function u(e){return{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}function _(e){if(!e.ok)return{status:e.status,badStatusText:e.statusText,message:e.message}}function i(e){return/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/.test(e)}function l(e){return new Promise((function(t,r){var n=new FileReader;n.onload=function(){t(n.result)},n.onerror=r,n.readAsText(e)}))}function p(e){return!e||""===e.trim()}function d(e,t){return t&&(e=e.map((function(e){var r=t(e.text);return Object(c.a)({},e,{text:r})}))),e}function h(){return m.apply(this,arguments)}function m(){return(m=Object(s.a)(a.a.mark((function e(){var t,r,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=localStorage,r=t.userJson){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,JSON.parse(r);case 5:if(n=e.sent){e.next=8;break}return e.abrupt("return",null);case 8:return e.abrupt("return",n.token?n.token:null);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},,,function(e,t,r){"use strict";r.d(t,"h",(function(){return n})),r.d(t,"l",(function(){return a})),r.d(t,"e",(function(){return s})),r.d(t,"d",(function(){return c})),r.d(t,"f",(function(){return o})),r.d(t,"i",(function(){return u})),r.d(t,"b",(function(){return _})),r.d(t,"k",(function(){return i})),r.d(t,"j",(function(){return l})),r.d(t,"g",(function(){return p})),r.d(t,"a",(function(){return d})),r.d(t,"c",(function(){return h}));var n="http://localhost:4000/",a="ws://localhost:4000/",s="messages/new/",c="messages/listRequest/",o="messages/lastMessages/",u="chats/new/",_="chats/listRequest/",i="users/login/",l="users/new/",p="users/search/",d="chats/addNewUser/",h=15},,,function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"c",(function(){return l})),r.d(t,"e",(function(){return p})),r.d(t,"f",(function(){return d})),r.d(t,"d",(function(){return h})),r.d(t,"b",(function(){return m})),r.d(t,"h",(function(){return f})),r.d(t,"i",(function(){return O})),r.d(t,"j",(function(){return v})),r.d(t,"k",(function(){return g})),r.d(t,"g",(function(){return S})),r.d(t,"l",(function(){return C})),r.d(t,"m",(function(){return w}));var n=r(8),a=r.n(n),s=r(13),c=r(9),o=r(5),u=r(18),_=r(6),i="ADD_NEW_MESSAGE",l="MESSAGE_WAS_RECEIVED",p="REFRESH_MESSAGES_LIST",d="UNSHIFT_PREVIOUS_MESSAGES",h="PUSH_NEW_MESSAGES",m="CLEAR_MESSAGES";function f(){return{type:m}}function b(e){return{type:i,payload:e}}function E(e){return{type:l,payload:e}}function O(e){return function(t,r){var n=r().currentChat.forwardPreprocessorFunction;n&&(e=n(e)),t(function(e){return function(){var t=Object(s.a)(a.a.mark((function t(r,n){var s,u,i,l,p,d,h,m;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(_.d)();case 3:if(s=t.sent){t.next=6;break}return t.abrupt("return");case 6:return r(E(!1)),u=(new Date).getTime(),i=n().currentUser.email,l=n().currentUser.name,p=n().currentChat._id,d={chatId:p,time:u,authorEmail:i,authorName:l,text:e},t.next=14,fetch(c.h+c.e,{method:"POST",headers:Object(_.c)(s),body:JSON.stringify(d)});case 14:if(h=t.sent,m=Object(_.a)(h)){t.next=20;break}return t.next=19,h.json();case 19:m=t.sent;case 20:m.status?(r(Object(o.p)(m)),d.wasMessageReceived=!1,r(b(d)),localStorage.removeItem("token")):(d.wasMessageReceived=!0,r(E(!0))),t.next=26;break;case 23:t.prev=23,t.t0=t.catch(0),console.log("error",t.t0);case 26:case"end":return t.stop()}}),t,null,[[0,23]])})));return function(e,r){return t.apply(this,arguments)}}()}(e))}}function v(e,t){return function(){var r=Object(s.a)(a.a.mark((function r(n,s){var u,i,l,p;return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,Object(_.d)();case 3:if(u=r.sent){r.next=6;break}return r.abrupt("return");case 6:return r.next=8,fetch("".concat(c.h).concat(c.d,"?chat_id=").concat(e,"&oldest_message_time=").concat(t,"&fetch_messages_count=").concat(c.c),{method:"GET",headers:Object(_.c)(u)});case 8:if(i=r.sent,l=Object(_.a)(i)){r.next=14;break}return r.next=13,i.json();case 13:l=r.sent;case 14:l.badStatusText?(n(Object(o.p)(l)),localStorage.removeItem("token")):(p=s().currentChat.backwardPreprocessorFunction,l=Object(_.b)(l,p),n({type:d,payload:l})),r.next=20;break;case 17:r.prev=17,r.t0=r.catch(0),console.log("error",r.t0);case 20:case"end":return r.stop()}}),r,null,[[0,17]])})));return function(e,t){return r.apply(this,arguments)}}()}function g(e,t){return function(){var r=Object(s.a)(a.a.mark((function r(n,s){var u,i,l;return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,Object(_.d)();case 3:if(u=r.sent){r.next=6;break}return r.abrupt("return");case 6:return r.next=8,fetch("".concat(c.h).concat(c.f,"?chat_id=").concat(e,"&newest_message_time=").concat(t),{method:"GET",headers:Object(_.c)(u)});case 8:if(i=r.sent,l=Object(_.a)(i)){r.next=14;break}return r.next=13,i.json();case 13:l=r.sent;case 14:l.badStatusText?(n(Object(o.p)(l)),localStorage.removeItem("token")):n(S(l)),r.next=20;break;case 17:r.prev=17,r.t0=r.catch(0),console.log("error",r.t0);case 20:case"end":return r.stop()}}),r,null,[[0,17]])})));return function(e,t){return r.apply(this,arguments)}}()}function S(e){return function(t,r){var n=r().currentChat.backwardPreprocessorFunction;n&&(e=Object(_.b)(e,n)),t(function(e){return{type:h,payload:e}}(e))}}function C(e){return function(t){t(Object(u.c)("".concat(c.l).concat(e)))}}function w(){return function(e){e(Object(u.e)())}}},,,,,,function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return c})),r.d(t,"e",(function(){return o})),r.d(t,"f",(function(){return u}));var n="WS_CONNECT",a="WS_DISCONNECT";function s(e){return{type:n,payload:e}}function c(){return{type:"WS_CONNECTED"}}function o(){return{type:a}}function u(){return{type:"WS_DISCONNECTED"}}},,,,,,,,,,function(e,t,r){},,,,,,,,function(e,t,r){e.exports=r(79)},,,,,,,,,,function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},,function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){},function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),s=r(24),c=r.n(s),o=r(11),u=r(22),_=r(19),i=r(35),l=r(21),p=r(12);var d=r(26),h=r(5);var m=Object(_.c)({messages:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case p.b:return[];case p.a:return[].concat(Object(l.a)(e),[t.payload]);case p.e:return t.payload;case p.f:var r=t.payload;return[].concat(Object(l.a)(r),Object(l.a)(e));case p.d:var n=t.payload;return[].concat(Object(l.a)(e),Object(l.a)(n));default:return e}},wasMessageReceived:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case p.c:return t.payload;default:return e}},currentUser:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case h.c:return t.payload;default:return e}},currentChat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case h.b:return t.payload;case h.a:return Object(d.a)({},e,{},t.payload);default:return e}},chatsList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case h.f:return t.payload;default:return e}},isUserAuthenticated:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case h.g:return t.payload;default:return e}},lastError:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case h.h:return t.payload;case h.d:return null;default:return e}},usersList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case h.e:return t.payload;default:return e}}}),f=r(18),b=function(){var e=null;return function(t){return function(r){return function(n){switch(n.type){case f.a:null!==e&&e.close(),(e=new WebSocket(n.payload)).onmessage=function(e){return function(t){var r=JSON.parse(t.data);switch(r.actionType){case"save":var n=[r.message];e.dispatch(Object(p.g)(n))}}}(t),e.onclose=function(e){return function(){e.dispatch(Object(f.f)())}}(t),e.onopen=function(e){return function(t){e.dispatch(Object(f.d)(t.target.url))}}(t);break;case f.b:null!==e&&e.close(),e=null;break;default:return r(n)}}}}}();r(46);var E=r(1),O=r(2),v=r(4),g=r(3),S=r(10);r(47);function C(e){return function(t){return a.a.createElement("div",{className:"modalWindow"},a.a.createElement("div",null,a.a.createElement(e,t)))}}r(48);function w(e){var t=e.caption,r=e.name,n=e.placeholder,s=e.type,c=e.value,o=e.onChange;return a.a.createElement("div",{className:"inputField"},a.a.createElement("label",null,t),a.a.createElement("input",{name:r,placeholder:n,type:s,value:c,onChange:o}))}r(49),r(28);var j=function(e){Object(v.a)(r,e);var t=Object(g.a)(r);function r(){var e;Object(E.a)(this,r);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).state={email:"",name:"",password:"",isRegistrationMode:!1},e.onSubmit=function(t){t.preventDefault();var r=e.state,n=r.email,a=r.name,s=r.password,c=r.isRegistrationMode,o=e.props,u=o.onAuthenticationSubmit,_=o.onRegistrationSubmit;c?_({email:n,name:a,password:s}):u(n,s),e.setState({email:"",name:"",password:""})},e.updateUserEmailValue=function(t){e.setState({email:t.target.value})},e.updateUserNameValue=function(t){e.setState({name:t.target.value})},e.updateUserPasswordValue=function(t){e.setState({password:t.target.value})},e.changeMode=function(t){var r=t.target.checked;e.setState({isRegistrationMode:r})},e.renderHeader=function(){var t;return t=e.state.isRegistrationMode?"New user registration":"Login",a.a.createElement("h3",{className:"authenticationAndRegistrationForm__Header"},t)},e.renderUserNameInputField=function(){if(e.state.isRegistrationMode)return a.a.createElement(w,{caption:"User name",name:"userName",placeholder:"User name",type:"text",value:e.state.name,onChange:e.updateUserNameValue})},e.renderSubmitButton=function(){var t;return t=e.state.isRegistrationMode?"Sign up":"Sign in",a.a.createElement("button",{className:"submitButton",type:"submit"},t)},e}return Object(O.a)(r,[{key:"render",value:function(){return a.a.createElement("div",{className:"authenticationAndRegistrationForm"},a.a.createElement("input",{type:"checkbox",name:"changeMode",onClick:this.changeMode}),a.a.createElement("span",null,"Registration"),a.a.createElement("form",{onSubmit:this.onSubmit},a.a.createElement("div",{align:"center"},this.renderHeader()),this.renderUserNameInputField(),a.a.createElement(w,{caption:"User email",name:"userEmail",placeholder:"User email",type:"text",value:this.state.email,onChange:this.updateUserEmailValue}),a.a.createElement(w,{caption:"User password",name:"userPassword",placeholder:"User password",type:"text",value:this.state.password,onChange:this.updateUserPasswordValue}),a.a.createElement("div",{align:"center"},this.renderSubmitButton())))}}]),r}(a.a.Component),M=(r(50),function(e){Object(v.a)(r,e);var t=Object(g.a)(r);function r(){var e;Object(E.a)(this,r);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).componentDidUpdate=function(){var t=e.props,r=t.isUserAuthenticated,n=t.history;r&&n.push("/chat")},e}return Object(O.a)(r,[{key:"render",value:function(){var e=this.props,t=e.submitUserEmailAndPassword,r=e.submitNewUser;return a.a.createElement("div",{className:"authenticationAndRegistrationWindow"},a.a.createElement(j,{onAuthenticationSubmit:t,onRegistrationSubmit:r}))}}]),r}(a.a.Component)),k=Object(S.f)(M),U=Object(o.b)((function(e){return{isUserAuthenticated:e.isUserAuthenticated}}),(function(e){return{submitUserEmailAndPassword:function(t,r){return e(Object(h.s)(t,r))},submitNewUser:function(t){return e(Object(h.r)(t))},onSignOut:function(){return e(Object(h.q)())}}}))(k);r(52);r(53);var A=function(e){Object(v.a)(r,e);var t=Object(g.a)(r);function r(){return Object(E.a)(this,r),t.apply(this,arguments)}return Object(O.a)(r,[{key:"render",value:function(){return a.a.createElement("div",{className:"settingsPanel"},a.a.createElement("span",null,this.props.currentUser.name),a.a.createElement("button",{onClick:this.props.onSignOut},"Sign out"))}}]),r}(a.a.Component),D=Object(o.b)((function(e){return{currentUser:e.currentUser}}),(function(e){return{onSignOut:function(){return e(Object(h.q)())}}}))(A),P=(r(54),function(e){Object(v.a)(r,e);var t=Object(g.a)(r);function r(){var e;Object(E.a)(this,r);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).onUserClick=function(){var t=e.props.user;e.props.onUserClick(t)},e}return Object(O.a)(r,[{key:"render",value:function(){var e=this.props.user;return a.a.createElement("div",{className:"userFrame",onClick:this.onUserClick},a.a.createElement("span",null,e.name))}}]),r}(a.a.Component)),y=function(e){Object(v.a)(r,e);var t=Object(g.a)(r);function r(){var e;Object(E.a)(this,r);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).state={userSeekData:""},e.onSubmit=function(t){t.preventDefault(),e.props.onSubmitUserSeekData(e.state.userSeekData),e.setState({searchQueryString:""})},e.updateSearchQueryString=function(t){e.setState({userSeekData:t.target.value})},e}return Object(O.a)(r,[{key:"render",value:function(){return a.a.createElement("form",{onSubmit:this.onSubmit},a.a.createElement(w,{caption:"User email",name:"userEmail",placeholder:"User email",type:"text",value:this.state.userSeekData,onChange:this.updateSearchQueryString}),a.a.createElement("div",{align:"center"},a.a.createElement("button",{className:"submitButton",type:"submit"},"Find users")))}}]),r}(a.a.Component),R=(r(55),r(56),r(57),function(e){Object(v.a)(r,e);var t=Object(g.a)(r);function r(){var e;Object(E.a)(this,r);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).onSubmitUserSeekData=function(t){e.props.findUsers(t)},e.renderUsersList=function(){var t=e.props,r=t.usersList,n=t.onUserClick;if(r&&r.length)return r.map((function(e){return a.a.createElement(P,{onUserClick:n,key:e._id,user:e})}))},e}return Object(O.a)(r,[{key:"render",value:function(){return a.a.createElement("div",{className:"addToChatNewUserWindow"},a.a.createElement("h4",null,"Search for a new member"),a.a.createElement("button",{className:"closeButton",onClick:this.props.onCancelClick},"X"),a.a.createElement(y,{onSubmitUserSeekData:this.onSubmitUserSeekData}),a.a.createElement("div",{className:"addToChatNewUserWindow-UsersList"},this.renderUsersList()))}}]),r}(a.a.Component)),T=(r(58),function(e){Object(v.a)(r,e);var t=Object(g.a)(r);function r(){var e;Object(E.a)(this,r);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).state={file:null,filePath:""},e.updateFile=function(t){e.setState({file:t.target.files[0],filePath:t.target.value}),e.props.updateFile(t)},e.renderFileName=function(){var t=e.state.file,r="";return t&&(r=t.name),a.a.createElement("span",null,r)},e}return Object(O.a)(r,[{key:"render",value:function(){var e=this.props.name;return a.a.createElement("div",{className:"fileInput"},a.a.createElement("div",null,a.a.createElement("span",null,this.renderFileName())),a.a.createElement("div",null,a.a.createElement("label",null,a.a.createElement("input",{name:e,type:"file",value:this.state.filePath,onChange:this.updateFile}),a.a.createElement("span",null,"Open file"))))}}]),r}(a.a.Component)),L=(r(59),function(e){Object(v.a)(r,e);var t=Object(g.a)(r);function r(){var e;Object(E.a)(this,r);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).state={file:null},e.onSubmit=function(t){var r=e.state.file,n=e.props.onSubmitFile;t.preventDefault(),r&&n(r)},e.updateMessagesPreprocessorFile=function(t){e.setState({file:t.target.files[0]})},e}return Object(O.a)(r,[{key:"render",value:function(){return a.a.createElement("form",{className:"addFileForm",onSubmit:this.onSubmit},a.a.createElement(T,{name:"messagesPreprocessorFile",updateFile:this.updateMessagesPreprocessorFile}),a.a.createElement("div",null,a.a.createElement("button",{className:"submitButton",type:"submit"},"Add")))}}]),r}(a.a.Component)),N=(r(60),function(e){Object(v.a)(r,e);var t=Object(g.a)(r);function r(){return Object(E.a)(this,r),t.apply(this,arguments)}return Object(O.a)(r,[{key:"render",value:function(){return a.a.createElement("div",{className:"specialMessagesPreprocessorMenu"},a.a.createElement("h4",null,"Add special messages preprocessor"),a.a.createElement("button",{className:"closeButton",onClick:this.props.onCancelClick},"X"),a.a.createElement(L,{onSubmitFile:this.props.onSubmit}))}}]),r}(a.a.Component)),x=(r(61),C(R)),I=C(N),W=function(e){Object(v.a)(r,e);var t=Object(g.a)(r);function r(e){var n;return Object(E.a)(this,r),(n=t.call(this,e)).onAddUserButtonClick=function(){n.setState({showAddedUserMenu:!0})},n.onAddSpecialMessagesPreprocessorButtonClick=function(){n.setState({showSpecialMessagesPreprocessorMenu:!0})},n.addNewUserToCurrentChat=function(e){n.cancelUserAdding(),n.props.addNewUserToCurrentChat(e)},n.cancelUserAdding=function(){n.setState({showAddedUserMenu:!1})},n.addNewSpecialMessagesPreprocessor=function(e){n.cancelSpecialMessagesPreprocessorAdding(),n.props.addNewSpecialMessagesPreprocessor(e)},n.cancelSpecialMessagesPreprocessorAdding=function(){n.setState({showSpecialMessagesPreprocessorMenu:!1})},n.renderAddedUserWindow=function(){var e=n.state,t=e.showAddedUserMenu,r=e.showSpecialMessagesPreprocessorMenu,s=n.props,c=s.currentChat,o=s.findUsers,u=s.usersList;return t?a.a.createElement(x,{findUsers:o,usersList:u,onUserClick:n.addNewUserToCurrentChat,onCancelClick:n.cancelUserAdding}):r?a.a.createElement(I,{currentChat:c,onSubmit:n.addNewSpecialMessagesPreprocessor,onCancelClick:n.cancelSpecialMessagesPreprocessorAdding}):c._id?a.a.createElement(a.a.Fragment,null,a.a.createElement("button",{onClick:n.onAddUserButtonClick},"Add new user to chat"),a.a.createElement("button",{onClick:n.onAddSpecialMessagesPreprocessorButtonClick},"Add special messages preprocessor")):void 0},n.state={showAddedUserMenu:!1,showSpecialMessagesPreprocessorMenu:!1},n}return Object(O.a)(r,[{key:"render",value:function(){return a.a.createElement("div",{className:"currentChatSettings"},this.renderAddedUserWindow())}}]),r}(a.a.Component),B=Object(o.b)((function(e){return{currentChat:e.currentChat,usersList:e.usersList}}),(function(e){return{findUsers:function(t){return e(Object(h.o)(t))},addNewUserToCurrentChat:function(t){return e(Object(h.j)(t))},addNewSpecialMessagesPreprocessor:function(t){return e(Object(h.i)(t))}}}))(W);r(62);function F(){return a.a.createElement("div",{className:"topPanel"},a.a.createElement(B,null),a.a.createElement(D,null))}function K(e){return e<10?"0"+e:e}r(63);function G(e){var t=new Date(e.time),r=K(t.getHours()),n=K(t.getMinutes()),s=K(t.getDate()),c=K(t.getMonth()+1),o=t.getFullYear();return a.a.createElement("div",{className:"messageFrame-MessageTimestamp"},a.a.createElement("span",null,r,":",n," ",s,".",c,".",o))}r(64);function H(e){return a.a.createElement("span",{className:"messageFrame-AuthorNameLabel"},e.authorName)}function q(e){return a.a.createElement("span",null,e.text)}r(65),r(66),r(67);var J=function(e){Object(v.a)(r,e);var t=Object(g.a)(r);function r(){var e;Object(E.a)(this,r);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).renderAuthorName=function(){var t=e.props,r=t.message;return t.currentUserEmail===r.authorEmail?void 0:a.a.createElement(H,{authorName:r.authorName})},e}return Object(O.a)(r,[{key:"render",value:function(){var e=this.props,t=e.message,r="messageFrame";return e.currentUserEmail===t.authorEmail?r+=" messageFrame_user_current":r+=" messageFrame_user_another",a.a.createElement("div",{className:r},a.a.createElement("div",null,this.renderAuthorName()),a.a.createElement("div",null,a.a.createElement(q,{text:t.text})),a.a.createElement("div",null,a.a.createElement(G,{time:t.time})))}}]),r}(a.a.Component);r(68);function V(e){var t=(new DOMParser).parseFromString("<!doctype html><body>".concat("&#11015"),"text/html").body.textContent;return a.a.createElement("div",{className:"scrollDownButton",onClick:e.onScrollDownClick},t)}r(69),r(70),r(71);var z=function(e){Object(v.a)(r,e);var t=Object(g.a)(r);function r(e){var n;return Object(E.a)(this,r),(n=t.call(this,e)).componentDidMount=function(){var e=n.props,t=e.currentChat,r=e.subscribeForNewMessages;n.state.currentChat!==t&&(n.setState({currentChat:t}),r(n.props.currentChat._id)),n.fetchMessages()},n.componentDidUpdate=function(){var e=n.props,t=e.messages,r=e.currentChat,a=e.subscribeForNewMessages,s=n.messageListRef.current;if(n.state.currentChat!==r)return n.reloadMessagesList(),void a(n.props.currentChat._id);if(t){var c=t.length;c<=n.state.previousMessagesLength||(n.setState({previousMessagesLength:c,suspendMessagesFetching:!1}),s&&(s.scrollTop+=30),n.scrollDownIfNeed())}},n.reloadMessagesList=function(){n.setState({currentChat:n.props.currentChat,previousMessagesLength:0,suspendMessagesFetching:!0,needScrollDown:!0}),n.fetchMessagesForced()},n.fetchMessages=function(){n.state.suspendMessagesFetching||n.fetchMessagesForced()},n.fetchMessagesForced=function(){var e=n.props.currentChat,t=n.props.messages;if(e&&e._id&&t){var r=(new Date).getTime(),a=t.length?t[0].time:r;n.props.fetchMessagesList(e._id,a)}},n.fetchNewMessages=function(){var e=n.props.currentChat,t=n.props.messages;if(e&&e._id&&t){var r=t.length-1;r<0?n.fetchMessages():n.props.fetchNewMessages(e._id,t[r].time)}},n.scrollDownIfNeed=function(){n.state.needScrollDown&&(n.setState({needScrollDown:!1}),n.scrollDown())},n.scrollDown=function(){var e=n.messageListRef.current;n.setState({needScrollDown:!1}),e&&(e.scrollTop=e.scrollHeight)},n.onScrollDownClick=function(){n.scrollDown()},n.onScroll=function(){var e=n.messageListRef.current,t=e.scrollHeight,r=e.scrollTop,a=e.clientHeight;n.setState({showScrollDownButton:t-r>=a+200,needScrollDown:t-r==a}),n.state.suspendMessagesFetching||r<200&&(n.setState({suspendMessagesFetching:!0}),n.fetchMessages())},n.renderMessageList=function(){var e=n.props,t=e.messages,r=e.currentUser,s=t.length;if(t&&s)return t.map((function(e,t){return a.a.createElement("div",{className:"item",key:t},a.a.createElement(J,{message:e,currentUserEmail:r.email}))}))},n.renderScrollDownButton=function(){if(n.state.showScrollDownButton)return a.a.createElement(V,{onScrollDownClick:n.onScrollDownClick})},n.renderChatNameCaption=function(){var e=n.props.currentChat.name;if(e)return a.a.createElement("div",{className:"chatNameCaption"},a.a.createElement("div",null,a.a.createElement("span",null,e)))},n.messageListRef=a.a.createRef(),n.state={enableScrollDown:!0,previousMessagesLength:0,suspendMessagesFetching:!1,currentChat:null,needScrollDown:!0,showScrollDownButton:!1},n}return Object(O.a)(r,[{key:"componentWillUnmount",value:function(){this.props.unsubscribeForNewMessages()}},{key:"tryLoadMessagesUntilScrollAppears",value:function(){var e=this.messageListRef.current;e.offsetWidth<=e.clientWidth&&this.fetchMessages()}},{key:"render",value:function(){(new DOMParser).parseFromString("<!doctype html><body>".concat("&#11015"),"text/html").body.textContent;return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{ref:this.messageListRef,className:"messageList",onScroll:this.onScroll},this.renderMessageList()),this.renderScrollDownButton(),this.renderChatNameCaption())}}]),r}(a.a.Component),Q=Object(o.b)((function(e){return{messages:e.messages,currentChat:e.currentChat,currentUser:e.currentUser}}),(function(e){return{fetchMessagesList:function(t,r){return e(Object(p.j)(t,r))},fetchNewMessages:function(t,r){return e(Object(p.k)(t,r))},subscribeForNewMessages:function(t){return e(Object(p.l)(t))},unsubscribeForNewMessages:function(){return e(Object(p.m)())}}}))(z),Z=(r(72),function(e){Object(v.a)(r,e);var t=Object(g.a)(r);function r(){var e;Object(E.a)(this,r);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).state={newData:""},e.onSubmit=function(t){t.preventDefault(),e.props.onSubmitNewData(e.state.newData),e.setState({newData:""})},e.updateInputValue=function(t){e.setState({newData:t.target.value})},e}return Object(O.a)(r,[{key:"render",value:function(){var e=this.props,t=e.caption,r=e.name,n=e.placeholder,s=e.type,c=e.buttonCaption;return a.a.createElement("form",{className:"simpleDataForm",onSubmit:this.onSubmit},a.a.createElement("h4",null,t),a.a.createElement("div",null,a.a.createElement("input",{name:r,placeholder:n,type:s,value:this.state.newData,onChange:this.updateInputValue}),a.a.createElement("button",{type:"submit"},c)))}}]),r}(a.a.Component)),$=(r(73),function(e){Object(v.a)(r,e);var t=Object(g.a)(r);function r(){return Object(E.a)(this,r),t.apply(this,arguments)}return Object(O.a)(r,[{key:"renderMessageList",value:function(){if(this.props.currentUser._id&&this.props.currentChat._id)return a.a.createElement(a.a.Fragment,null,a.a.createElement(Q,null),a.a.createElement(Z,{onSubmitNewData:this.props.sendNewMessage,caption:"+Message",name:"userMessage",placeholder:"message text",type:"text",buttonCaption:"Send"}))}},{key:"render",value:function(){return a.a.createElement("div",{className:"currentChatPanel"},this.renderMessageList())}}]),r}(a.a.Component)),X=Object(o.b)((function(e){return{currentUser:e.currentUser,currentChat:e.currentChat}}),(function(e){return{sendNewMessage:function(t){return e(Object(p.i)(t))}}}))($),Y=(r(74),function(e){Object(v.a)(r,e);var t=Object(g.a)(r);function r(){var e;Object(E.a)(this,r);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).onSelectChat=function(){var t=e.props.chat;e.props.onSelectChat(t)},e.renderUsersList=function(e){if(e&&e.length)return e.map((function(e,t){return a.a.createElement("div",{key:t},a.a.createElement("p",null,e.name))}))},e}return Object(O.a)(r,[{key:"render",value:function(){var e=this.props.chat;return a.a.createElement("div",{className:"chatList-ChatFrame",onClick:this.onSelectChat},a.a.createElement("div",null,a.a.createElement("h4",null,e.name)),a.a.createElement("div",null,a.a.createElement("p",null,"Chat members:"),a.a.createElement("div",null,this.renderUsersList(e.users))))}}]),r}(a.a.Component)),ee=(r(75),function(e){Object(v.a)(r,e);var t=Object(g.a)(r);function r(){var e;Object(E.a)(this,r);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).renderChatList=function(){var t=e.props,r=t.chatsList,n=t.changeCurrentChat;if(r&&r.length)return r.map((function(e){return a.a.createElement(Y,{onSelectChat:n,key:e._id,chat:e})}))},e}return Object(O.a)(r,[{key:"componentDidMount",value:function(){var e=this.props.currentUser._id;e&&this.props.fetchChatsList(e)}},{key:"render",value:function(){return a.a.createElement("div",{className:"\u0441hatList"},this.renderChatList())}}]),r}(a.a.Component)),te=Object(o.b)((function(e){return{chatsList:e.chatsList,currentUser:e.currentUser}}),(function(e){return{fetchChatsList:function(t){return e(Object(h.n)(t))},changeCurrentChat:function(t){return e(Object(h.t)(t))}}}))(ee),re=(r(76),function(e){Object(v.a)(r,e);var t=Object(g.a)(r);function r(){var e;Object(E.a)(this,r);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).onSubmitNewChat=function(t){e.props.createNewChat(t,[e.props.currentUser._id])},e}return Object(O.a)(r,[{key:"render",value:function(){return a.a.createElement("div",{className:"userChatsPanel"},a.a.createElement(te,null),a.a.createElement(Z,{onSubmitNewData:this.onSubmitNewChat,caption:"+Chat",name:"chatName",placeholder:"chat name",type:"text",buttonCaption:"Create"}))}}]),r}(a.a.Component)),ne=Object(o.b)((function(e){return{currentUser:e.currentUser}}),(function(e){return{createNewChat:function(t,r){return e(Object(h.m)(t,r))}}}))(re);r(77);function ae(){return a.a.createElement("div",{className:"mainPanel"},a.a.createElement(ne,null),a.a.createElement(X,null))}r(78);var se=function(e){Object(v.a)(r,e);var t=Object(g.a)(r);function r(){var e;Object(E.a)(this,r);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).componentDidUpdate=function(){var t=e.props,r=t.isUserAuthenticated,n=t.history;r||n.push("/login")},e}return Object(O.a)(r,[{key:"render",value:function(){return a.a.createElement("div",{className:"appPanel"},a.a.createElement("div",{className:"mainPanelPlace"},a.a.createElement(ae,null)),a.a.createElement("div",{className:"topPanelPlace"},a.a.createElement(F,null)))}}]),r}(a.a.Component),ce=Object(S.f)(se),oe=Object(o.b)((function(e){return{isUserAuthenticated:e.isUserAuthenticated}}))(ce),ue=C((function(e){var t,r,n,s=e.lastError,c=s.status,o=s.badStatusText,u=s.message;return c&&(t=a.a.createElement("p",null,"Status: ",c),r=a.a.createElement("p",null,"Status text: ",o),n=a.a.createElement("p",null,"Message: ",u)),a.a.createElement("div",{className:"errorWindow"},a.a.createElement("div",null,a.a.createElement("h4",null,"Error")),a.a.createElement("div",null,t,r,n),a.a.createElement("button",{onClick:e.onOk},"Ok"))})),_e=function(e){Object(v.a)(r,e);var t=Object(g.a)(r);function r(){return Object(E.a)(this,r),t.apply(this,arguments)}return Object(O.a)(r,[{key:"componentDidMount",value:function(){var e=this.props,t=e.isUserAuthenticated;(0,e.checkIsUserAuthenticated)(),t?this.props.history.push("/chat"):this.props.history.push("/login")}},{key:"renderErrorWindow",value:function(){if(this.props.lastError)return a.a.createElement(ue,{onOk:this.props.clearLastError,lastError:this.props.lastError})}},{key:"renderMainContent",value:function(){return a.a.createElement(S.c,null,a.a.createElement(S.a,{exact:!0,path:"/login",render:function(){return a.a.createElement(U,null)}}),a.a.createElement(S.a,{path:"/chat",component:oe}))}},{key:"render",value:function(){return a.a.createElement(a.a.Fragment,null,this.renderErrorWindow(),this.renderMainContent())}}]),r}(a.a.Component),ie=Object(S.f)(_e),le=Object(o.b)((function(e){return{isUserAuthenticated:e.isUserAuthenticated,lastError:e.lastError}}),(function(e){return{checkIsUserAuthenticated:function(){return e(Object(h.k)())},submitUserEmailAndPassword:function(t,r){return e(Object(h.s)(t,r))},submitNewUser:function(t){return e(Object(h.r)(t))},clearLastError:function(){return e(Object(h.l)())},onSignOut:function(){return e(Object(h.q)())}}}))(ie);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var pe=Object(_.d)(m,Object(_.a)(i.a,b));c.a.render(a.a.createElement(u.a,null,a.a.createElement(o.a,{store:pe},a.a.createElement(le,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}],[[36,1,2]]]);
//# sourceMappingURL=main.3b8a791d.chunk.js.map