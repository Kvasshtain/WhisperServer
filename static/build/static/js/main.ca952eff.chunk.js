(this.webpackJsonpwhisper=this.webpackJsonpwhisper||[]).push([[0],{20:function(e,t,a){e.exports=a(35)},31:function(e,t,a){},32:function(e,t,a){},33:function(e,t,a){},34:function(e,t,a){},35:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(12),c=a.n(s),o=a(7),u=a(9),i=a(19),l=a(11),p=a(1),m=a.n(p),d="http://localhost:4000/",h="messages/new/",f="messages/listRequest/",g="messages/lastMessages/",v="chats/new/",b="chats/listRequest/",E="users/login/",S="users/new/",w="users/search/",y="chats/addNewUser/",C=3,k=1e4,O=a(13),U={Accept:"application/json","Content-Type":"application/json"};function j(e){return{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}function x(e){if(!e.ok)return{status:e.status,badStatusText:e.statusText,message:e.message}}function M(e){return/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/.test(e)}function N(e){return new Promise((function(t,a){var n=new FileReader;n.onload=function(){t(n.result)},n.onerror=a,n.readAsText(e)}))}function A(e,t){return t&&(e=e.map((function(e){var a=t(e.text);return Object(O.a)({},e,{text:a})}))),e}var _="CHANGE_CURRENT_USER",L="CHANGE_CURRENT_CHAT",T="REFRESH_CHATS_LIST",P="SET_AUTHENTICATION_RESULT",D="SET_LAST_ERROR",R="FILL_FOUND_USERS_LIST",F="CLEAR_LAST_ERROR",I="ADD_NEW_SPECIAL_MESSAGES_PREPROCESSOR_FUNCTION";function V(e){return{type:_,payload:e}}function G(e){return{type:L,payload:e}}function W(e){return{type:P,payload:e}}function H(e){return function(t){401===e.status&&t(J()),t(B(e))}}function B(e){return{type:D,payload:e}}function J(){return function(e){localStorage.removeItem("token"),e(W(!1))}}function z(e,t){return{type:I,payload:{forwardPreprocessorFunction:e,backwardPreprocessorFunction:t}}}function Q(e){return function(t){var a,n,r=localStorage.getItem(e._id);if(r){var s=JSON.parse(r);a=new Function("text",s.forward),n=new Function("text",s.backward)}t(G(e)),t({type:ee}),a&&n&&t(z(a,n))}}function Z(e){return function(t){var a,n,r,s;return m.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:if(c.prev=0,a=localStorage,!(n=a.token)){c.next=12;break}return c.next=5,m.a.awrap(fetch("".concat(d).concat(b,"?user_id=").concat(e),{method:"GET",headers:j(n)}));case 5:if(r=c.sent,s=x(r)){c.next=11;break}return c.next=10,m.a.awrap(r.json());case 10:s=c.sent;case 11:s.badStatusText?(t(H(s)),localStorage.removeItem("token")):t({type:T,payload:s});case 12:c.next=17;break;case 14:c.prev=14,c.t0=c.catch(0),console.log("error",c.t0);case 17:case"end":return c.stop()}}),null,null,[[0,14]])}}var q="ADD_NEW_MESSAGE",$="MESSAGE_WAS_RECEIVED",Y="REFRESH_MESSAGES_LIST",K="UNSHIFT_PREVIOUS_MESSAGES",X="PUSH_NEW_MESSAGES",ee="CLEAR_MESSAGES";function te(e){return{type:q,payload:e}}function ae(e){return{type:$,payload:e}}function ne(e){return function(t,a){var n=a().currentChat.forwardPreprocessorFunction;n&&(e=n(e)),t(function(e){return function(t,a){var n,r,s,c,o,u,i,l;return m.a.async((function(p){for(;;)switch(p.prev=p.next){case 0:if(p.prev=0,!(n=localStorage.token)){p.next=18;break}return t(ae(!1)),r=(new Date).getTime(),s=a().currentUser.email,c=a().currentUser.name,o=a().currentChat._id,u={chatId:o,time:r,authorEmail:s,authorName:c,text:e},p.next=11,m.a.awrap(fetch(d+h,{method:"POST",headers:j(n),body:JSON.stringify(u)}));case 11:if(i=p.sent,l=x(i)){p.next=17;break}return p.next=16,m.a.awrap(i.json());case 16:l=p.sent;case 17:l.status?(t(H(l)),u.wasMessageReceived=!1,t(te(u)),localStorage.removeItem("token")):(u.wasMessageReceived=!0,t(te(u)),t(ae(!0)));case 18:p.next=23;break;case 20:p.prev=20,p.t0=p.catch(0),console.log("error",p.t0);case 23:case"end":return p.stop()}}),null,null,[[0,20]])}}(e))}}var re=Object(u.c)({messages:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ee:return[];case q:return[].concat(Object(l.a)(e),[t.payload]);case Y:return t.payload;case K:var a=t.payload;return[].concat(Object(l.a)(a),Object(l.a)(e));case X:var n=t.payload;return[].concat(Object(l.a)(e),Object(l.a)(n));default:return e}},wasMessageReceived:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case $:return t.payload;default:return e}},currentUser:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case _:return t.payload;default:return e}},currentChat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case L:return t.payload;case I:return Object(O.a)({},e,{},t.payload);default:return e}},chatsList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case T:return t.payload;default:return e}},isUserAuthenticated:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case P:return t.payload;default:return e}},lastError:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case D:return t.payload;case F:return null;default:return e}},usersList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case R:return t.payload;default:return e}}});a(31);var se=a(2),ce=a(3),oe=a(5),ue=a(4),ie=a(6),le=function(e){function t(){var e,a;Object(se.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(oe.a)(this,(e=Object(ue.a)(t)).call.apply(e,[this].concat(r)))).state={name:"",users:[]},a.onSubmit=function(e){e.preventDefault(),a.props.onSubmitNewChat(a.state.name,[a.props.currentUserId]),a.setState({name:"",users:[]})},a.updateChatNameValue=function(e){a.setState({name:e.target.value})},a}return Object(ie.a)(t,e),Object(ce.a)(t,[{key:"render",value:function(){return r.a.createElement("form",{onSubmit:this.onSubmit},r.a.createElement("h4",null,"+Chat"),r.a.createElement("input",{name:"chatName",placeholder:"chat name",type:"text",value:this.state.name,onChange:this.updateChatNameValue}),r.a.createElement("button",{type:"submit"},"Create new chat"))}}]),t}(r.a.Component);function pe(e){var t=new Date(e.time),a=t.getHours(),n=t.getMinutes(),s=t.getDate(),c=t.getMonth()+1,o=t.getFullYear();return r.a.createElement("div",null,r.a.createElement("p",null,a,":",n," ",s,".",c,".",o))}function me(e){var t,a=e.message;return t=e.currentUserEmail===a.authorEmail?"current_user_message":"another_user_message",r.a.createElement("div",{className:t},r.a.createElement("div",null,r.a.createElement("p",null,a.authorName)),r.a.createElement("div",null,r.a.createElement("p",null,a.authorEmail)),r.a.createElement("div",null,r.a.createElement("p",null,a.text)),r.a.createElement(pe,{time:a.time}))}var de=function(e){function t(){var e,a;Object(se.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(oe.a)(this,(e=Object(ue.a)(t)).call.apply(e,[this].concat(r)))).state={newMessage:""},a.onSubmit=function(e){e.preventDefault(),a.props.onSubmitNewMessage(a.state.newMessage),a.setState({newMessage:""})},a.updateInputValue=function(e){a.setState({newMessage:e.target.value})},a}return Object(ie.a)(t,e),Object(ce.a)(t,[{key:"render",value:function(){return r.a.createElement("form",{className:"new-message-input",onSubmit:this.onSubmit},r.a.createElement("h4",null,"+Message"),r.a.createElement("input",{name:"userMessage",placeholder:"message text",type:"text",value:this.state.newMessage,onChange:this.updateInputValue}),r.a.createElement("button",{type:"submit"},"Send message"))}}]),t}(r.a.Component),he=(a(32),function(e){function t(e){var a;return Object(se.a)(this,t),(a=Object(oe.a)(this,Object(ue.a)(t).call(this,e))).componentDidMount=function(){var e=a.props.currentChat;a.state.currentChat!==e&&a.setState({currentChat:e}),a.fetchMessages(),a.initializeMessagesListUpdateTimer()},a.componentDidUpdate=function(){var e=a.props,t=e.messages,n=e.currentChat,r=a.messageListRef.current;if(a.state.currentChat!==n)return a.setState({currentChat:n}),a.fetchMessages(),void a.setState({suspendMessagesFetching:!0});if(t){var s=t.length;s!==a.state.previousMessagesLength&&(a.setState({previousMessagesLength:s}),a.setState({suspendMessagesFetching:!1}),r.scrollTop+=30,a.scrollDownIfEnabled(),a.tryLoadMessagesUntilScrollAppears())}},a.initializeMessagesListUpdateTimer=function(){a.timerID=setInterval((function(){return a.fetchNewMessages()}),k)},a.fetchMessages=function(){a.state.suspendMessagesFetching||a.fetchMessagesForced()},a.fetchMessagesForced=function(){var e=a.props.currentChat,t=a.props.messages;if(e&&e._id&&t){var n=(new Date).getTime(),r=t.length?t[0].time:n;a.props.fetchMessagesList(e._id,r)}},a.fetchNewMessages=function(){var e=a.props.currentChat,t=a.props.messages;if(e&&e._id&&t){var n=t.length-1;n<0?a.fetchMessages():a.props.fetchNewMessages(e._id,t[n].time)}},a.scrollDownIfEnabled=function(){a.state.enableScrollDown&&(a.setState({enableScrollDown:!1}),a.scrollDown())},a.scrollDown=function(){var e=a.messageListRef.current;e.scrollTop=e.scrollHeight},a.renderMessageList=function(){var e=a.props,t=e.messages,n=e.currentUser,s=t.length;if(t&&s)return t.map((function(e,t){return r.a.createElement("div",{key:t},r.a.createElement(me,{message:e,currentUserEmail:n.email}))}))},a.onScrollDownClick=function(){a.scrollDown()},a.onScroll=function(){a.messageListRef.current.scrollTop<30&&(a.setState({suspendMessagesFetching:!0}),a.fetchMessages())},a.sendNewMessage=function(e){a.props.sendNewMessage(e),a.setState({enableScrollDown:!0})},a.messageListRef=r.a.createRef(),a.state={enableScrollDown:!0,previousMessagesLength:0,suspendMessagesFetching:!1,currentChat:null},a}return Object(ie.a)(t,e),Object(ce.a)(t,[{key:"componentWillUnmount",value:function(){clearInterval(this.timerID)}},{key:"tryLoadMessagesUntilScrollAppears",value:function(){var e=this.messageListRef.current;e.offsetWidth<=e.clientWidth&&this.fetchMessages()}},{key:"render",value:function(){var e=(new DOMParser).parseFromString("<!doctype html><body>".concat("&#11015"),"text/html").body.textContent;return r.a.createElement("div",null,r.a.createElement("div",{className:"scroll-down-button",onClick:this.onScrollDownClick},e),r.a.createElement("div",{ref:this.messageListRef,className:"message-list",onScroll:this.onScroll},this.renderMessageList()),r.a.createElement(de,{onSubmitNewMessage:this.sendNewMessage}))}}]),t}(r.a.Component)),fe=Object(o.b)((function(e){return{messages:e.messages,currentChat:e.currentChat,currentUser:e.currentUser}}),(function(e){return{fetchMessagesList:function(t,a){return e(function(e,t){return function(a,n){var r,s,c,o;return m.a.async((function(u){for(;;)switch(u.prev=u.next){case 0:if(u.prev=0,!(r=localStorage.token)){u.next=12;break}return u.next=5,m.a.awrap(fetch("".concat(d).concat(f,"?chat_id=").concat(e,"&oldest_message_time=").concat(t,"&fetch_messages_count=").concat(C),{method:"GET",headers:j(r)}));case 5:if(s=u.sent,c=x(s)){u.next=11;break}return u.next=10,m.a.awrap(s.json());case 10:c=u.sent;case 11:c.badStatusText?(a(H(c)),localStorage.removeItem("token")):(o=n().currentChat.backwardPreprocessorFunction,c=A(c,o),a({type:K,payload:c}));case 12:u.next=17;break;case 14:u.prev=14,u.t0=u.catch(0),console.log("error",u.t0);case 17:case"end":return u.stop()}}),null,null,[[0,14]])}}(t,a))},fetchNewMessages:function(t,a){return e(function(e,t){return function(a,n){var r,s,c,o;return m.a.async((function(u){for(;;)switch(u.prev=u.next){case 0:if(u.prev=0,!(r=localStorage.token)){u.next=12;break}return u.next=5,m.a.awrap(fetch("".concat(d).concat(g,"?chat_id=").concat(e,"&newest_message_time=").concat(t),{method:"GET",headers:j(r)}));case 5:if(s=u.sent,c=x(s)){u.next=11;break}return u.next=10,m.a.awrap(s.json());case 10:c=u.sent;case 11:c.badStatusText?(a(H(c)),localStorage.removeItem("token")):(o=n().currentChat.backwardPreprocessorFunction,c=A(c,o),a({type:X,payload:c}));case 12:u.next=17;break;case 14:u.prev=14,u.t0=u.catch(0),console.log("error",u.t0);case 17:case"end":return u.stop()}}),null,null,[[0,14]])}}(t,a))}}}))(he),ge=function(e){function t(){var e,a;Object(se.a)(this,t);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(a=Object(oe.a)(this,(e=Object(ue.a)(t)).call.apply(e,[this].concat(s)))).onSelectChat=function(){var e=a.props.chat;a.props.onSelectChat(e)},a.renderUsersList=function(e){if(e&&e.length)return e.map((function(e,t){return r.a.createElement("div",{key:t},r.a.createElement("p",null,e.name))}))},a}return Object(ie.a)(t,e),Object(ce.a)(t,[{key:"render",value:function(){var e=this.props.chat;return r.a.createElement("div",{className:"selected-item",onClick:this.onSelectChat},r.a.createElement("div",null,r.a.createElement("h4",null,e.name)),r.a.createElement("div",null,r.a.createElement("p",null,"Chat members:"),r.a.createElement("div",null,this.renderUsersList(e.users))))}}]),t}(r.a.Component),ve=(a(33),function(e){function t(){var e,a;Object(se.a)(this,t);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(a=Object(oe.a)(this,(e=Object(ue.a)(t)).call.apply(e,[this].concat(s)))).renderChatList=function(){var e=a.props,t=e.chatsList,n=e.changeCurrentChat;if(t&&t.length)return t.map((function(e){return r.a.createElement(ge,{onSelectChat:n,key:e._id,chat:e})}))},a}return Object(ie.a)(t,e),Object(ce.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.currentUser._id;e&&this.props.fetchChatsList(e)}},{key:"render",value:function(){return r.a.createElement("div",{className:"\u0441hat-list"},this.renderChatList())}}]),t}(r.a.Component)),be=Object(o.b)((function(e){return{chatsList:e.chatsList,currentUser:e.currentUser}}),(function(e){return{fetchChatsList:function(t){return e(Z(t))},changeCurrentChat:function(t){return e(Q(t))}}}))(ve),Ee=function(e){function t(){var e,a;Object(se.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(oe.a)(this,(e=Object(ue.a)(t)).call.apply(e,[this].concat(r)))).onUserClick=function(){var e=a.props.user;a.props.onUserClick(e)},a}return Object(ie.a)(t,e),Object(ce.a)(t,[{key:"render",value:function(){var e=this.props.user;return r.a.createElement("div",{className:"selected-item",onClick:this.onUserClick},r.a.createElement("p",null,e.name),r.a.createElement("p",null,e.email))}}]),t}(r.a.Component),Se=function(e){function t(){var e,a;Object(se.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(oe.a)(this,(e=Object(ue.a)(t)).call.apply(e,[this].concat(r)))).state={userSeekData:""},a.onSubmit=function(e){e.preventDefault(),a.props.onSubmitUserSeekData(a.state.userSeekData),a.setState({searchQueryString:""})},a.updateSearchQueryString=function(e){a.setState({userSeekData:e.target.value})},a}return Object(ie.a)(t,e),Object(ce.a)(t,[{key:"render",value:function(){return r.a.createElement("form",{onSubmit:this.onSubmit},r.a.createElement("h1",null,"Search for a new member"),r.a.createElement("label",null,"Enter email"),r.a.createElement("input",{name:"userEmail",placeholder:"User email",type:"text",value:this.state.userSeekData,onChange:this.updateSearchQueryString}),r.a.createElement("button",{type:"submit"},"Find users"))}}]),t}(r.a.Component),we=function(e){function t(){var e,a;Object(se.a)(this,t);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(a=Object(oe.a)(this,(e=Object(ue.a)(t)).call.apply(e,[this].concat(s)))).onSubmitUserSeekData=function(e){a.props.findUsers(e)},a.renderUsersList=function(){var e=a.props,t=e.usersList,n=e.onUserClick;if(t&&t.length)return t.map((function(e){return r.a.createElement(Ee,{onUserClick:n,key:e._id,user:e})}))},a}return Object(ie.a)(t,e),Object(ce.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"cover-div"},r.a.createElement("div",{className:"modal-window"},r.a.createElement(Se,{onSubmitUserSeekData:this.onSubmitUserSeekData}),this.renderUsersList(),r.a.createElement("button",{onClick:this.props.onCancelClick},"Cancel")))}}]),t}(r.a.Component),ye=function(e){function t(){var e,a;Object(se.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(oe.a)(this,(e=Object(ue.a)(t)).call.apply(e,[this].concat(r)))).state={file:null,filePath:""},a.onSubmit=function(e){var t=a.state.file,n=a.props.onSubmit;e.preventDefault(),t&&n(t)},a.updateMessagesPreprocessorFile=function(e){a.setState({file:e.target.files[0],filePath:e.target.value})},a}return Object(ie.a)(t,e),Object(ce.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"cover-div"},r.a.createElement("div",{className:"modal-window"},r.a.createElement("form",{onSubmit:this.onSubmit},r.a.createElement("h4",null,"+Chat"),r.a.createElement("input",{name:"messagesPreprocessorFile",type:"file",value:this.state.filePath,onChange:this.updateMessagesPreprocessorFile}),r.a.createElement("button",{type:"submit"},"Add special messages preprocessor"),r.a.createElement("button",{onClick:this.props.onCancelClick},"Cancel"))))}}]),t}(r.a.Component),Ce=function(e){function t(e){var a;return Object(se.a)(this,t),(a=Object(oe.a)(this,Object(ue.a)(t).call(this,e))).onAddUserButtonClick=function(){a.setState({showAddedUserMenu:!0})},a.onAddSpecialMessagesPreprocessorButtonClick=function(){a.setState({showSpecialMessagesPreprocessorMenu:!0})},a.addNewUserToCurrentChat=function(e){a.cancelUserAdding(),a.props.addNewUserToCurrentChat(e)},a.cancelUserAdding=function(){a.setState({showAddedUserMenu:!1})},a.addNewSpecialMessagesPreprocessor=function(e){a.cancelSpecialMessagesPreprocessorAdding(),a.props.addNewSpecialMessagesPreprocessor(e)},a.cancelSpecialMessagesPreprocessorAdding=function(){a.setState({showSpecialMessagesPreprocessorMenu:!1})},a.renderAddedUserWindow=function(){var e=a.state,t=e.showAddedUserMenu,n=e.showSpecialMessagesPreprocessorMenu,s=a.props,c=s.currentChat,o=s.findUsers,u=s.usersList;return t?r.a.createElement(we,{findUsers:o,usersList:u,onUserClick:a.addNewUserToCurrentChat,onCancelClick:a.cancelUserAdding}):n?r.a.createElement(ye,{currentChat:c,onSubmit:a.addNewSpecialMessagesPreprocessor,onCancelClick:a.cancelSpecialMessagesPreprocessorAdding}):c._id?r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{onClick:a.onAddUserButtonClick},"Add new user to chat"),r.a.createElement("button",{onClick:a.onAddSpecialMessagesPreprocessorButtonClick},"Add special messages preprocessor")):void 0},a.state={showAddedUserMenu:!1,showSpecialMessagesPreprocessorMenu:!1},a}return Object(ie.a)(t,e),Object(ce.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("span",null,"Chat: ",this.props.currentChat.name),this.renderAddedUserWindow())}}]),t}(r.a.Component),ke=Object(o.b)((function(e){return{currentChat:e.currentChat,usersList:e.usersList}}),(function(e){return{findUsers:function(t){return e(function(e){return function(t){var a,n,r,s;return m.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:if(c.prev=0,a=localStorage,!(n=a.token)){c.next=12;break}return c.next=5,m.a.awrap(fetch("".concat(d).concat(w,"?user_seek_data=").concat(e),{method:"GET",headers:j(n)}));case 5:if(r=c.sent,s=x(r)){c.next=11;break}return c.next=10,m.a.awrap(r.json());case 10:s=c.sent;case 11:s.badStatusText?(t(H(s)),localStorage.removeItem("token")):t({type:R,payload:s});case 12:c.next=17;break;case 14:c.prev=14,c.t0=c.catch(0),console.log("error",c.t0);case 17:case"end":return c.stop()}}),null,null,[[0,14]])}}(t))},addNewUserToCurrentChat:function(t){return e(function(e){return function(t,a){var n,r,s,c,o,u;return m.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:if(i.prev=0,n=localStorage,!(r=n.token)){i.next=13;break}return s=a(),c=s.currentChat,i.next=6,m.a.awrap(fetch(d+y,{method:"POST",headers:j(r),body:JSON.stringify({chatId:c._id,newUserId:e._id})}));case 6:if(o=i.sent,u=x(o)){i.next=12;break}return i.next=11,m.a.awrap(o.json());case 11:u=i.sent;case 12:u.badStatusText?t(H(u)):t(Q(u.chat));case 13:i.next=18;break;case 15:i.prev=15,i.t0=i.catch(0),console.log("error",i.t0);case 18:case"end":return i.stop()}}),null,null,[[0,15]])}}(t))},addNewSpecialMessagesPreprocessor:function(t){return e(function(e){return function(t,a){var n,r,s,c,o,u;return m.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:if(e){i.next=2;break}return i.abrupt("return");case 2:return i.next=4,m.a.awrap(N(e));case 4:if(n=i.sent,(l=n)&&""!=l.trim()){i.next=8;break}return t(B({message:"File is empty or has wrong format"})),i.abrupt("return");case 8:if((r=JSON.parse(n)).forward&&r.backward){i.next=12;break}return t(B({message:"File has wrong format"})),i.abrupt("return");case 12:s=new Function("text",r.forward),c=new Function("text",r.backward),o=a(),u=o.currentChat,localStorage.setItem(u._id,n),t(z(s,c));case 17:case"end":return i.stop()}var l}))}}(t))}}}))(Ce),Oe=function(e){function t(){var e,a;Object(se.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(oe.a)(this,(e=Object(ue.a)(t)).call.apply(e,[this].concat(r)))).state={email:"",password:""},a.onSubmit=function(e){e.preventDefault(),a.props.onSubmit(a.state.email,a.state.password),a.setState({email:"",password:""})},a.updateUserEmailValue=function(e){a.setState({email:e.target.value})},a.updateUserPasswordValue=function(e){a.setState({password:e.target.value})},a}return Object(ie.a)(t,e),Object(ce.a)(t,[{key:"render",value:function(){return r.a.createElement("form",{onSubmit:this.onSubmit,className:"reg-auth-form"},r.a.createElement("h3",null,"Login"),r.a.createElement("label",null,"User email"),r.a.createElement("input",{name:"userEmail",placeholder:"User email",type:"text",value:this.state.email,onChange:this.updateUserEmailValue}),r.a.createElement("br",null),r.a.createElement("label",null,"User password"),r.a.createElement("input",{name:"userPassword",placeholder:"User password",type:"text",value:this.state.password,onChange:this.updateUserPasswordValue}),r.a.createElement("br",null),r.a.createElement("button",{type:"submit"},"Submit"))}}]),t}(r.a.Component),Ue=function(e){function t(){var e,a;Object(se.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(oe.a)(this,(e=Object(ue.a)(t)).call.apply(e,[this].concat(r)))).state={email:"",name:"",password:""},a.onSubmit=function(e){e.preventDefault();var t=a.state,n={email:t.email,name:t.name,password:t.password};a.props.onSubmit(n),a.setState({email:"",name:"",password:""})},a.updateUserEmailValue=function(e){a.setState({email:e.target.value})},a.updateUserNameValue=function(e){a.setState({name:e.target.value})},a.updateUserPasswordValue=function(e){a.setState({password:e.target.value})},a}return Object(ie.a)(t,e),Object(ce.a)(t,[{key:"render",value:function(){return r.a.createElement("form",{onSubmit:this.onSubmit,className:"reg-auth-form"},r.a.createElement("h3",null,"New user registration"),r.a.createElement("label",null,"User email"),r.a.createElement("input",{name:"userEmail",placeholder:"User email",type:"text",value:this.state.email,onChange:this.updateUserEmailValue}),r.a.createElement("br",null),r.a.createElement("label",null,"User name"),r.a.createElement("input",{name:"userName",placeholder:"User name",type:"text",value:this.state.name,onChange:this.updateUserNameValue}),r.a.createElement("br",null),r.a.createElement("label",null,"User password"),r.a.createElement("input",{name:"userPassword",placeholder:"User password",type:"text",value:this.state.password,onChange:this.updateUserPasswordValue}),r.a.createElement("br",null),r.a.createElement("button",{type:"submit"},"Send new user registration data"))}}]),t}(r.a.Component);function je(e){return r.a.createElement("div",null,r.a.createElement("button",{onClick:e.onSignOut},"Sign out"),r.a.createElement("span",null,e.currentUserName))}function xe(e){var t,a,n,s=e.lastError,c=s.status,o=s.badStatusText,u=s.message;return c&&(t=r.a.createElement("p",null,"Status: ",c)),c&&(a=r.a.createElement("p",null,"Status text: ",o)),c&&(n=r.a.createElement("p",null,"Message: ",u)),r.a.createElement("div",{className:"moda-window"},r.a.createElement("div",null,r.a.createElement("h4",null,"Error")),r.a.createElement("div",null,t,a,n),r.a.createElement("button",{onClick:e.onOk},"Ok"))}a(34);var Me=function(e){function t(){var e,a;Object(se.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(oe.a)(this,(e=Object(ue.a)(t)).call.apply(e,[this].concat(r)))).onSignOut=function(){a.props.resetAuthenticationResult()},a}return Object(ie.a)(t,e),Object(ce.a)(t,[{key:"renderChatListNewChatForm",value:function(){if(this.props.currentUser._id)return r.a.createElement("div",null,r.a.createElement(be,null),r.a.createElement(le,{onSubmitNewChat:this.props.createNewChat,currentUserId:this.props.currentUser._id}))}},{key:"renderMessageList",value:function(){if(this.props.currentUser._id&&this.props.currentChat._id)return r.a.createElement(fe,{sendNewMessage:this.props.sendNewMessage})}},{key:"renderErrorWindow",value:function(){if(this.props.lastError)return r.a.createElement("div",{className:"cover-div"},r.a.createElement(xe,{className:"modal-window",onOk:this.props.clearLastError,lastError:this.props.lastError}))}},{key:"renderMainContent",value:function(){return this.props.isUserAuthenticated?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"main-panel"},r.a.createElement("div",{className:"user-chats-panel"},this.renderChatListNewChatForm()),r.a.createElement("div",{className:"current-chat-panel"},this.renderMessageList())),r.a.createElement("div",{className:"top-panel"},r.a.createElement(je,{className:"settings-panel",onSignOut:this.onSignOut,currentUserName:this.props.currentUser.name}),r.a.createElement(ke,{className:"current-chat-settings"}))):r.a.createElement(r.a.Fragment,null,this.renderErrorWindow(),r.a.createElement("div",{className:"reg-auth-forms-panel"},r.a.createElement(Ue,{onSubmit:this.props.submitNewUser}),r.a.createElement(Oe,{onSubmit:this.props.submitUserEmailAndPassword})))}},{key:"render",value:function(){return r.a.createElement("div",{className:"app-panel"},this.renderMainContent())}}]),t}(r.a.Component),Ne=Object(o.b)((function(e){return{currentUser:e.currentUser,currentChat:e.currentChat,wasMessageReceived:e.wasMessageReceived,isUserAuthenticated:e.isUserAuthenticated,lastError:e.lastError}}),(function(e){return{createNewChat:function(t,a){return e((n=t,r=a,function(e,t){var a,s,c,o,u,i,l;return m.a.async((function(p){for(;;)switch(p.prev=p.next){case 0:if(p.prev=0,a=localStorage,!(s=a.token)){p.next=13;break}return c={chat:{name:n,users:r}},p.next=6,m.a.awrap(fetch(d+v,{method:"POST",headers:j(s),body:JSON.stringify(c)}));case 6:if(o=p.sent,u=x(o)){p.next=12;break}return p.next=11,m.a.awrap(o.json());case 11:u=p.sent;case 12:u.status?e(H(u)):(i=t(),l=i.currentUser,e(Q(u.chat)),e(Z(l._id)));case 13:p.next=18;break;case 15:p.prev=15,p.t0=p.catch(0),console.log("error",p.t0);case 18:case"end":return p.stop()}}),null,null,[[0,15]])}));var n,r},sendNewMessage:function(t){return e(ne(t))},submitUserEmailAndPassword:function(t,a){return e((n=t,r=a,function(e){var t,a,s,c,o,u;return m.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:if(i.prev=0,M(n)){i.next=4;break}return e(B({message:"Bad email: ".concat(n)})),i.abrupt("return");case 4:return t={user:{email:n,name:"",password:r}},i.next=7,m.a.awrap(fetch(d+E,{method:"POST",headers:U,body:JSON.stringify(t)}));case 7:if(a=i.sent,s=x(a)){i.next=13;break}return i.next=12,m.a.awrap(a.json());case 12:s=i.sent;case 13:s.badStatusText?(e(H(s)),e(W(!1))):(c=s.user,o=c._id,u=c.token,localStorage.setItem("token",u),e(V(s.user)),e(W(!0)),e(Z(o))),i.next=19;break;case 16:i.prev=16,i.t0=i.catch(0),console.log("error",i.t0);case 19:case"end":return i.stop()}}),null,null,[[0,16]])}));var n,r},submitNewUser:function(t){return e(function(e){return function(t){var a,n,r,s,c;return m.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:if(o.prev=0,M(e.email)){o.next=4;break}return t(B({message:"Bad email: ".concat(e.email)})),o.abrupt("return");case 4:return o.next=6,m.a.awrap(fetch(d+S,{method:"POST",headers:U,body:JSON.stringify({user:e})}));case 6:if(a=o.sent,n=x(a)){o.next=12;break}return o.next=11,m.a.awrap(a.json());case 11:n=o.sent;case 12:n.badStatusText?(t(H(n)),t(W(!1))):(r=n.user,s=r._id,c=r.token,localStorage.setItem("token",c),t(V(n.user)),t(G({})),t(W(!0)),t(Z(s))),o.next=18;break;case 15:o.prev=15,o.t0=o.catch(0),console.log("error",o.t0);case 18:case"end":return o.stop()}}),null,null,[[0,15]])}}(t))},resetAuthenticationResult:function(){return e(J())},clearLastError:function(){return e({type:F})}}}))(Me);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Ae=Object(u.d)(re,Object(u.a)(i.a));c.a.render(r.a.createElement(o.a,{store:Ae},r.a.createElement(Ne,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[20,1,2]]]);
//# sourceMappingURL=main.ca952eff.chunk.js.map