{"version":3,"sources":["actions/chatSettingsActions.js","actions/helper.js","applicationSettings.js","actions/messageListActions.js","actions/webSocketActions.js","reducers/index.js","reducers/messageListData.js","reducers/chatSettings.js","middleware/webSocketMiddleware.js","components/ModalWindow/asModalWindow.js","components/InputField/InputField.js","components/AuthenticationAndRegistrationForm/AuthenticationAndRegistrationForm.js","containers/AuthenticationAndRegistrationWindow/AuthenticationAndRegistrationWindow.js","containers/SettingsPanel/SettingsPanel.js","components/UserFrame/UserFrame.js","components/AddToChatNewUserWindow/__SeekForm/AddToChatNewUserWindow-SeekForm.js","components/AddToChatNewUserWindow/AddToChatNewUserWindow.js","components/FileInput/FileInput.js","components/SpecialMessagesPreprocessorMenu/__AddFileForm/SpecialMessagesPreprocessorMenu-AddFileForm.js","components/SpecialMessagesPreprocessorMenu/SpecialMessagesPreprocessorMenu.js","containers/CurrentChatSettings/CurrentChatSettings.js","containers/AppPanel/__TopPanel/AppPanel-TopPanel.js","components/helper.js","components/MessageFrame/__MessageTimestamp/MessageFrame-MessageTimestamp.js","components/MessageFrame/__AuthorNameLabel/MessageFrame-AuthorNameLabel.js","components/MessageFrame/__MessageTextField/MessageFrame-MessageTextField.js","components/MessageFrame/MessageFrame.js","containers/MessageList/__ScrollDownButton/MessageList-ScrollDownButton.js","containers/MessageList/MessageList.js","components/SimpleDataForm/SimpleDataForm.js","containers/CurrentChatPanel/CurrentChatPanel.js","containers/ChatList/__ChatFrame/ChatList-ChatFrame.js","containers/ChatList/ChatList.js","containers/UserChatsPanel/UserChatsPanel.js","containers/AppPanel/__MainPanel/AppPanel-MainPanel.js","containers/AppPanel/AppPanel.js","containers/App.js","components/ErrorWindow/ErrorWindow.js","serviceWorker.js","index.js","store/configureStore.js"],"names":["CHANGE_CURRENT_USER","CHANGE_CURRENT_CHAT","REFRESH_CHATS_LIST","SET_AUTHENTICATION_RESULT","SET_LAST_ERROR","FILL_FOUND_USERS_LIST","CLEAR_LAST_ERROR","ADD_NEW_SPECIAL_MESSAGES_PREPROCESSOR_FUNCTION","changeCurrentUser","user","type","payload","changeCurrentChat","chat","refreshChatsList","chats","setAuthenticationResult","result","handleServerError","serverErrorData","dispatch","status","resetAuthenticationResult","setLastError","errorData","fillFoundUsersList","usersList","localStorage","removeItem","clearLastError","addNewSpecialMessagesPreprocessorFunction","forwardPreprocessorFunction","backwardPreprocessorFunction","checkIsUserAuthenticated","a","userJson","JSON","parse","fetchChatsList","_id","addNewSpecialMessagesPreprocessor","file","getState","readTextFile","preprocessorString","isStringNullOrEmpty","message","eval","createTextMutators","mutators","forward","backward","currentChat","setItem","tryGetPreprocessorAnd–°hangeCurrentChat","getItem","preprocessor","Function","clearMessages","createNewChat","name","users","getUserToken","token","newChatData","fetch","serverLocation","submitNewChatPath","method","headers","createHttpHeadersWithToken","body","stringify","response","data","checkResponseAndCreateErrorIfBadStatus","json","currentUser","console","log","userId","chatsListGetPath","badStatusText","submitUserEmailAndPassword","email","password","validateEmail","userAuthenticationData","submitUserEmailAndPasswordPath","httpHeadersWithoutToken","submitNewUser","submitNewUserPath","findUsers","userSeekData","searchUsersPath","addNewUserToCurrentChat","addNewUserToChatPath","chatId","newUserId","Accept","Authorization","ok","statusText","test","Promise","resolve","reject","reader","FileReader","onload","onerror","readAsText","str","trim","convertMessages","messages","convertor","map","item","text","wsServerLocation","messageSendPath","messageGetPath","newMessageGetPath","fetchMessagesCount","ADD_NEW_MESSAGE","MESSAGE_WAS_RECEIVED","REFRESH_MESSAGES_LIST","UNSHIFT_PREVIOUS_MESSAGES","PUSH_NEW_MESSAGES","CLEAR_MESSAGES","addNewMessage","messageWasReceived","bool","encryptAndSendNewMessage","time","Date","getTime","authorEmail","authorName","wasMessageReceived","sendNewMessage","fetchMessagesList","oldestMessageTime","fetchNewMessages","newestMessageTime","applyBackwardPreprocessorFunctionAndPushMessage","pushNewMessages","subscribeForNewMessages","wsConnect","unsubscribeForNewMessages","wsDisconnect","WS_CONNECT","WS_DISCONNECT","host","wsConnected","wsDisconnected","combineReducers","state","action","previousMessages","newMessages","chatsList","isUserAuthenticated","lastError","webSocketMiddleware","socket","store","next","close","WebSocket","onmessage","event","actionType","onMessage","onclose","onClose","onopen","target","url","onOpen","asModalWindow","Component","props","className","InputField","caption","placeholder","value","onChange","AuthenticationAndRegistrationForm","isRegistrationMode","onSubmit","eventArg","preventDefault","onAuthenticationSubmit","onRegistrationSubmit","setState","updateUserEmailValue","updateUserNameValue","updateUserPasswordValue","changeMode","checked","renderHeader","headerText","renderUserNameInputField","renderSubmitButton","buttonText","onClick","this","align","React","AuthenticationAndRegistrationWindow","componentDidUpdate","history","push","AuthenticationAndRegistrationWindowWithRouter","withRouter","connect","userEmail","userPassword","onSignOut","SettingsPanel","UserFrame","onUserClick","SeekForm","onSubmitUserSeekData","searchQueryString","updateSearchQueryString","AddToChatNewUserWindow","renderUsersList","length","key","onCancelClick","FileInput","filePath","updateFile","files","renderFileName","fileName","AddFileForm","onSubmitFile","updateMessagesPreprocessorFile","SpecialMessagesPreprocessorMenu","AddToChatNewUserModalWindow","SpecialMessagesPreprocessorModalWindow","CurrentChatSettings","onAddUserButtonClick","showAddedUserMenu","onAddSpecialMessagesPreprocessorButtonClick","showSpecialMessagesPreprocessorMenu","cancelUserAdding","preprocessorFunctionString","cancelSpecialMessagesPreprocessorAdding","renderAddedUserWindow","Fragment","TopPanel","addLeadZero","number","MessageTimestamp","date","hours","getHours","minutes","getMinutes","day","getDate","month","getMonth","year","getFullYear","AuthorNameLabel","MessageTextField","MessageFrame","renderAuthorName","currentUserEmail","messageFrameClass","ScrollDownButton","decodedString","DOMParser","parseFromString","textContent","onScrollDownClick","MessageList","componentDidMount","fetchMessages","current","messageListRef","reloadMessagesList","messagesLength","previousMessagesLength","suspendMessagesFetching","scrollTop","scrollDownIfNeed","needScrollDown","fetchMessagesForced","lastMessageIndex","scrollDown","scrollHeight","onScroll","clientHeight","showScrollDownButton","renderMessageList","index","renderScrollDownButton","renderChatNameCaption","chatName","createRef","enableScrollDown","offsetWidth","clientWidth","ref","SimpleDataForm","newData","onSubmitNewData","updateInputValue","buttonCaption","CurrentChatPanel","ChatFrame","onSelectChat","ChatList","renderChatList","UserChatsPanel","onSubmitNewChat","usersIds","MainPanel","AppPanel","AppPanelWithRouter","ErrorModalWindow","statusParagraph","badStatusTextParagraph","messageParagraph","onOk","App","exact","path","render","component","renderErrorWindow","renderMainContent","AppWithRouter","Boolean","window","location","hostname","match","createStore","rootReducer","applyMiddleware","thunk","wsMiddleware","ReactDOM","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.3b8a791d.chunk.js","sourcesContent":["import {\n  serverLocation,\n  submitNewChatPath,\n  chatsListGetPath,\n  submitUserEmailAndPasswordPath,\n  submitNewUserPath,\n  searchUsersPath,\n  addNewUserToChatPath,\n} from '../applicationSettings'\n\nimport { clearMessages } from './messageListActions'\n\nimport {\n  createHttpHeadersWithToken,\n  httpHeadersWithoutToken,\n  checkResponseAndCreateErrorIfBadStatus,\n  validateEmail,\n  readTextFile,\n  isStringNullOrEmpty,\n  getUserToken,\n} from './helper'\n\nexport const CHANGE_CURRENT_USER = 'CHANGE_CURRENT_USER'\nexport const CHANGE_CURRENT_CHAT = 'CHANGE_CURRENT_CHAT'\nexport const REFRESH_CHATS_LIST = 'REFRESH_CHATS_LIST'\nexport const SET_AUTHENTICATION_RESULT = 'SET_AUTHENTICATION_RESULT'\nexport const SET_LAST_ERROR = 'SET_LAST_ERROR'\nexport const FILL_FOUND_USERS_LIST = 'FILL_FOUND_USERS_LIST'\nexport const CLEAR_LAST_ERROR = 'CLEAR_LAST_ERROR'\nexport const ADD_NEW_SPECIAL_MESSAGES_PREPROCESSOR_FUNCTION =\n  'ADD_NEW_SPECIAL_MESSAGES_PREPROCESSOR_FUNCTION'\n\nexport function changeCurrentUser(user) {\n  return {\n    type: CHANGE_CURRENT_USER,\n    payload: user,\n  }\n}\n\nexport function changeCurrentChat(chat) {\n  return {\n    type: CHANGE_CURRENT_CHAT,\n    payload: chat,\n  }\n}\n\nexport function refreshChatsList(chats) {\n  return {\n    type: REFRESH_CHATS_LIST,\n    payload: chats,\n  }\n}\n\nexport function setAuthenticationResult(result) {\n  return {\n    type: SET_AUTHENTICATION_RESULT,\n    payload: result,\n  }\n}\n\nexport function handleServerError(serverErrorData) {\n  return dispatch => {\n    if (serverErrorData.status === 401) {\n      dispatch(resetAuthenticationResult())\n    }\n\n    dispatch(setLastError(serverErrorData))\n  }\n}\n\nexport function setLastError(errorData) {\n  return {\n    type: SET_LAST_ERROR,\n    payload: errorData,\n  }\n}\n\nexport function fillFoundUsersList(usersList) {\n  return {\n    type: FILL_FOUND_USERS_LIST,\n    payload: usersList,\n  }\n}\n\nexport function resetAuthenticationResult() {\n  return dispatch => {\n    localStorage.removeItem('userJson')\n    dispatch(setAuthenticationResult(false))\n  }\n}\n\nexport function clearLastError() {\n  return {\n    type: CLEAR_LAST_ERROR,\n  }\n}\n\nexport function addNewSpecialMessagesPreprocessorFunction(\n  forwardPreprocessorFunction,\n  backwardPreprocessorFunction\n) {\n  return {\n    type: ADD_NEW_SPECIAL_MESSAGES_PREPROCESSOR_FUNCTION,\n    payload: {\n      forwardPreprocessorFunction,\n      backwardPreprocessorFunction,\n    },\n  }\n}\n\nexport function checkIsUserAuthenticated() {\n  return async dispatch => {\n    const { userJson } = localStorage\n    let user\n    try {\n      if (!userJson) return\n      user = await JSON.parse(userJson)\n    } catch (error) {\n      localStorage.removeItem('userJson')\n      return\n    }\n\n    dispatch(changeCurrentUser(user))\n    dispatch(setAuthenticationResult(true))\n    dispatch(fetchChatsList(user._id))\n  }\n}\n\nexport function addNewSpecialMessagesPreprocessor(file) {\n  return async (dispatch, getState) => {\n    if (!file) return\n\n    let preprocessorString = await readTextFile(file)\n\n    if (isStringNullOrEmpty(preprocessorString)) {\n      dispatch(setLastError({ message: 'File is empty or has wrong format' }))\n      return\n    }\n\n    let createTextMutators\n\n    eval(preprocessorString)\n\n    if (!createTextMutators) {\n      dispatch(setLastError({ message: 'File has wrong format' }))\n      return\n    }\n\n    const mutators = createTextMutators()\n\n    if (!mutators) {\n      dispatch(setLastError({ message: 'File has wrong format' }))\n      return\n    }\n\n    const { forward, backward } = mutators\n    if (typeof forward !== 'function' || typeof backward !== 'function') {\n      dispatch(setLastError({ message: 'File has wrong format' }))\n      return\n    }\n    //const preprocessor = JSON.parse(preprocessorString)\n\n    // if (!preprocessor.forward || !preprocessor.backward) {\n    //   dispatch(setLastError({ message: 'File has wrong format' }))\n    //   return\n    // }\n\n    // const forwardPreprocessorFunction = new Function(\n    //   'text',\n    //   preprocessor.forward\n    // )\n    // const backwardPreprocessorFunction = new Function(\n    //   'text',\n    //   preprocessor.backward\n    // )\n\n    const { currentChat } = getState()\n\n    localStorage.setItem(currentChat._id, preprocessorString)\n\n    dispatch(addNewSpecialMessagesPreprocessorFunction(forward, backward))\n  }\n}\n\nexport function tryGetPreprocessorAnd–°hangeCurrentChat(chat) {\n  return dispatch => {\n    const preprocessorString = localStorage.getItem(chat._id)\n\n    let forwardPreprocessorFunction, backwardPreprocessorFunction\n\n    if (preprocessorString) {\n      const preprocessor = JSON.parse(preprocessorString)\n\n      forwardPreprocessorFunction = new Function('text', preprocessor.forward)\n      backwardPreprocessorFunction = new Function('text', preprocessor.backward)\n    }\n\n    dispatch(changeCurrentChat(chat))\n    dispatch(clearMessages())\n\n    if (forwardPreprocessorFunction && backwardPreprocessorFunction) {\n      dispatch(\n        addNewSpecialMessagesPreprocessorFunction(\n          forwardPreprocessorFunction,\n          backwardPreprocessorFunction\n        )\n      )\n    }\n  }\n}\n\nexport function createNewChat(name, users) {\n  return async (dispatch, getState) => {\n    try {\n      const token = await getUserToken()\n\n      if (!token) return\n\n      const newChatData = {\n        chat: {\n          name,\n          users,\n        },\n      }\n\n      const response = await fetch(serverLocation + submitNewChatPath, {\n        method: 'POST',\n        headers: createHttpHeadersWithToken(token),\n        body: JSON.stringify(newChatData),\n      })\n\n      let data = checkResponseAndCreateErrorIfBadStatus(response)\n\n      if (!data) {\n        data = await response.json()\n      }\n\n      if (data.status) {\n        dispatch(handleServerError(data))\n      } else {\n        const { currentUser } = getState()\n\n        dispatch(tryGetPreprocessorAnd–°hangeCurrentChat(data.chat))\n        dispatch(fetchChatsList(currentUser._id))\n      }\n    } catch (error) {\n      console.log('error', error)\n    }\n  }\n}\n\nexport function fetchChatsList(userId) {\n  return async dispatch => {\n    try {\n      const token = await getUserToken()\n\n      if (!token) return\n\n      const response = await fetch(\n        `${serverLocation}${chatsListGetPath}?user_id=${userId}`,\n        {\n          method: 'GET',\n          headers: createHttpHeadersWithToken(token),\n        }\n      )\n\n      let data = checkResponseAndCreateErrorIfBadStatus(response)\n\n      if (!data) {\n        data = await response.json()\n      }\n\n      if (data.badStatusText) {\n        dispatch(handleServerError(data))\n        localStorage.removeItem('token')\n        localStorage.removeItem('userJson')\n      } else {\n        dispatch(refreshChatsList(data))\n      }\n    } catch (error) {\n      console.log('error', error)\n    }\n  }\n}\n\nexport function submitUserEmailAndPassword(email, password) {\n  return async dispatch => {\n    try {\n      if (!validateEmail(email)) {\n        dispatch(\n          setLastError({\n            message: `Bad email: ${email}`,\n          })\n        )\n        return\n      }\n\n      const userAuthenticationData = {\n        user: {\n          email,\n          name: '',\n          password,\n        },\n      }\n\n      const response = await fetch(\n        serverLocation + submitUserEmailAndPasswordPath,\n        {\n          method: 'POST',\n          headers: httpHeadersWithoutToken,\n          body: JSON.stringify(userAuthenticationData),\n        }\n      )\n\n      let data = checkResponseAndCreateErrorIfBadStatus(response)\n\n      if (!data) {\n        data = await response.json()\n      }\n\n      if (data.badStatusText) {\n        dispatch(handleServerError(data))\n        dispatch(setAuthenticationResult(false))\n      } else {\n        const { _id } = data.user\n\n        localStorage.setItem('userJson', JSON.stringify(data.user))\n\n        dispatch(changeCurrentUser(data.user))\n        dispatch(setAuthenticationResult(true))\n        dispatch(fetchChatsList(_id))\n      }\n    } catch (error) {\n      console.log('error', error)\n    }\n  }\n}\n\nexport function submitNewUser(user) {\n  return async dispatch => {\n    try {\n      if (!validateEmail(user.email)) {\n        dispatch(\n          setLastError({\n            message: `Bad email: ${user.email}`,\n          })\n        )\n\n        return\n      }\n\n      const response = await fetch(serverLocation + submitNewUserPath, {\n        method: 'POST',\n        headers: httpHeadersWithoutToken,\n        body: JSON.stringify({ user }),\n      })\n\n      let data = checkResponseAndCreateErrorIfBadStatus(response)\n\n      if (!data) {\n        data = await response.json()\n      }\n\n      if (data.badStatusText) {\n        dispatch(handleServerError(data))\n        dispatch(setAuthenticationResult(false))\n      } else {\n        const { _id } = data.user\n\n        localStorage.setItem('userJson', JSON.stringify(data.user))\n\n        dispatch(changeCurrentUser(data.user))\n        dispatch(changeCurrentChat({}))\n        dispatch(setAuthenticationResult(true))\n        dispatch(fetchChatsList(_id))\n      }\n    } catch (error) {\n      console.log('error', error)\n    }\n  }\n}\n\nexport function findUsers(userSeekData) {\n  return async dispatch => {\n    try {\n      const token = await getUserToken()\n\n      if (!token) return\n\n      const response = await fetch(\n        `${serverLocation}${searchUsersPath}?user_seek_data=${userSeekData}`,\n        {\n          method: 'GET',\n          headers: createHttpHeadersWithToken(token),\n        }\n      )\n\n      let data = checkResponseAndCreateErrorIfBadStatus(response)\n\n      if (!data) {\n        data = await response.json()\n      }\n\n      if (data.badStatusText) {\n        dispatch(handleServerError(data))\n\n        localStorage.removeItem('token')\n        localStorage.removeItem('userJson')\n      } else {\n        dispatch(fillFoundUsersList(data))\n      }\n    } catch (error) {\n      console.log('error', error)\n    }\n  }\n}\n\nexport function addNewUserToCurrentChat(user) {\n  return async (dispatch, getState) => {\n    try {\n      const token = await getUserToken()\n\n      if (!token) return\n\n      const { currentChat } = getState()\n\n      const response = await fetch(serverLocation + addNewUserToChatPath, {\n        method: 'POST',\n        headers: createHttpHeadersWithToken(token),\n        body: JSON.stringify({\n          chatId: currentChat._id,\n          newUserId: user._id,\n        }),\n      })\n\n      let data = checkResponseAndCreateErrorIfBadStatus(response)\n\n      if (!data) {\n        data = await response.json()\n      }\n\n      if (data.badStatusText) {\n        dispatch(handleServerError(data))\n      } else {\n        dispatch(tryGetPreprocessorAnd–°hangeCurrentChat(data.chat))\n      }\n    } catch (error) {\n      console.log('error', error)\n    }\n  }\n}\n","export const httpHeadersWithoutToken = {\n  Accept: 'application/json',\n  'Content-Type': 'application/json',\n}\n\nexport function createHttpHeadersWithToken(token) {\n  return {\n    Accept: 'application/json',\n    'Content-Type': 'application/json',\n    Authorization: `Bearer ${token}`,\n  }\n}\n\nexport function checkResponseAndCreateErrorIfBadStatus(response) {\n  if (response.ok) {\n    return\n  } else {\n    const { status, statusText, message } = response\n\n    return {\n      status,\n      badStatusText: statusText,\n      message,\n    }\n  }\n}\n\nexport function validateEmail(email) {\n  const reg = /^([A-Za-z0-9_\\-\\.])+\\@([A-Za-z0-9_\\-\\.])+\\.([A-Za-z]{2,4})$/\n\n  return reg.test(email)\n}\n\nexport function readTextFile(file) {\n  return new Promise((resolve, reject) => {\n    var reader = new FileReader()\n    reader.onload = () => {\n      resolve(reader.result)\n    }\n    reader.onerror = reject\n    reader.readAsText(file)\n  })\n}\n\nexport function isStringNullOrEmpty(str) {\n  if (!str) return true\n\n  if (str.trim() === '') return true\n\n  return false\n}\n\nexport function convertMessages(messages, convertor) {\n  if (convertor) {\n    messages = messages.map(item => {\n      const text = convertor(item.text)\n      return { ...item, text }\n    })\n  }\n\n  return messages\n}\n\nexport async function getUserToken() {\n  const { userJson } = localStorage\n\n  if (!userJson) return null\n\n  const user = await JSON.parse(userJson)\n\n  if (!user) return null\n\n  return user.token ? user.token : null\n}\n","export const serverLocation = 'http://localhost:4000/'\nexport const wsServerLocation = 'ws://localhost:4000/'\n\nexport const messageSendPath = 'messages/new/'\nexport const messageGetPath = 'messages/listRequest/'\nexport const newMessageGetPath = 'messages/lastMessages/'\nexport const submitNewChatPath = 'chats/new/'\nexport const chatsListGetPath = 'chats/listRequest/'\nexport const submitUserEmailAndPasswordPath = 'users/login/'\nexport const submitNewUserPath = 'users/new/'\nexport const searchUsersPath = 'users/search/'\nexport const addNewUserToChatPath = 'chats/addNewUser/'\n\nexport const fetchMessagesCount = 15\nexport const updateInterval = 10000\n","import {\n  serverLocation,\n  wsServerLocation,\n  messageSendPath,\n  messageGetPath,\n  newMessageGetPath,\n  fetchMessagesCount,\n} from '../applicationSettings'\n\nimport { handleServerError } from './chatSettingsActions'\nimport { wsConnect, wsDisconnect } from './webSocketActions'\n\nimport {\n  createHttpHeadersWithToken,\n  checkResponseAndCreateErrorIfBadStatus,\n  convertMessages,\n  getUserToken,\n} from './helper'\n\nexport const ADD_NEW_MESSAGE = 'ADD_NEW_MESSAGE'\nexport const MESSAGE_WAS_RECEIVED = 'MESSAGE_WAS_RECEIVED'\nexport const REFRESH_MESSAGES_LIST = 'REFRESH_MESSAGES_LIST'\nexport const UNSHIFT_PREVIOUS_MESSAGES = 'UNSHIFT_PREVIOUS_MESSAGES'\nexport const PUSH_NEW_MESSAGES = 'PUSH_NEW_MESSAGES'\nexport const CLEAR_MESSAGES = 'CLEAR_MESSAGES'\n\nexport function clearMessages() {\n  return {\n    type: CLEAR_MESSAGES,\n  }\n}\n\nexport function addNewMessage(message) {\n  return {\n    type: ADD_NEW_MESSAGE,\n    payload: message,\n  }\n}\n\nexport function messageWasReceived(bool) {\n  return {\n    type: MESSAGE_WAS_RECEIVED,\n    payload: bool,\n  }\n}\n\nexport function refreshMessagesList(messages) {\n  return {\n    type: REFRESH_MESSAGES_LIST,\n    payload: messages,\n  }\n}\n\nexport function unshiftPreviousMessages(messages) {\n  return {\n    type: UNSHIFT_PREVIOUS_MESSAGES,\n    payload: messages,\n  }\n}\n\nexport function pushNewMessages(messages) {\n  return {\n    type: PUSH_NEW_MESSAGES,\n    payload: messages,\n  }\n}\n\nexport function encryptAndSendNewMessage(text) {\n  return (dispatch, getState) => {\n    const { forwardPreprocessorFunction } = getState().currentChat\n\n    if (forwardPreprocessorFunction) {\n      text = forwardPreprocessorFunction(text)\n    }\n\n    dispatch(sendNewMessage(text))\n  }\n}\n\nexport function sendNewMessage(text) {\n  return async (dispatch, getState) => {\n    try {\n      const token = await getUserToken()\n\n      if (!token) return\n\n      dispatch(messageWasReceived(false))\n\n      const time = new Date().getTime()\n      const authorEmail = getState().currentUser.email\n      const authorName = getState().currentUser.name\n      const chatId = getState().currentChat._id\n\n      const message = {\n        chatId,\n        time,\n        authorEmail,\n        authorName,\n        text,\n      }\n\n      const response = await fetch(serverLocation + messageSendPath, {\n        method: 'POST',\n        headers: createHttpHeadersWithToken(token),\n        body: JSON.stringify(message),\n      })\n\n      let data = checkResponseAndCreateErrorIfBadStatus(response)\n\n      if (!data) {\n        data = await response.json()\n      }\n\n      if (data.status) {\n        dispatch(handleServerError(data))\n        message.wasMessageReceived = false\n        dispatch(addNewMessage(message))\n        localStorage.removeItem('token')\n      } else {\n        message.wasMessageReceived = true\n        //dispatch(addNewMessage(message))\n        dispatch(messageWasReceived(true))\n      }\n    } catch (error) {\n      console.log('error', error)\n    }\n  }\n}\n\nexport function fetchMessagesList(chatId, oldestMessageTime) {\n  return async (dispatch, getState) => {\n    try {\n      const token = await getUserToken()\n\n      if (!token) return\n\n      const response = await fetch(\n        `${serverLocation}${messageGetPath}?chat_id=${chatId}&oldest_message_time=${oldestMessageTime}&fetch_messages_count=${fetchMessagesCount}`,\n        {\n          method: 'GET',\n          headers: createHttpHeadersWithToken(token),\n        }\n      )\n\n      let data = checkResponseAndCreateErrorIfBadStatus(response)\n\n      if (!data) {\n        data = await response.json()\n      }\n\n      if (data.badStatusText) {\n        dispatch(handleServerError(data))\n        localStorage.removeItem('token')\n      } else {\n        const { backwardPreprocessorFunction } = getState().currentChat\n        data = convertMessages(data, backwardPreprocessorFunction)\n        dispatch(unshiftPreviousMessages(data))\n      }\n    } catch (error) {\n      console.log('error', error)\n    }\n  }\n}\n\nexport function fetchNewMessages(chatId, newestMessageTime) {\n  return async (dispatch, getState) => {\n    try {\n      const token = await getUserToken()\n\n      if (!token) return\n\n      const response = await fetch(\n        `${serverLocation}${newMessageGetPath}?chat_id=${chatId}&newest_message_time=${newestMessageTime}`,\n        {\n          method: 'GET',\n          headers: createHttpHeadersWithToken(token),\n        }\n      )\n\n      let data = checkResponseAndCreateErrorIfBadStatus(response)\n\n      if (!data) {\n        data = await response.json()\n      }\n\n      if (data.badStatusText) {\n        dispatch(handleServerError(data))\n        localStorage.removeItem('token')\n      } else {\n        dispatch(applyBackwardPreprocessorFunctionAndPushMessage(data))\n      }\n    } catch (error) {\n      console.log('error', error)\n    }\n  }\n}\n\nexport function applyBackwardPreprocessorFunctionAndPushMessage(messages) {\n  return (dispatch, getState) => {\n    const { backwardPreprocessorFunction } = getState().currentChat\n\n    if (backwardPreprocessorFunction) {\n      messages = convertMessages(messages, backwardPreprocessorFunction)\n    }\n\n    dispatch(pushNewMessages(messages))\n  }\n}\n\nexport function subscribeForNewMessages(chatId) {\n  return dispatch => {\n    dispatch(wsConnect(`${wsServerLocation}${chatId}`))\n  }\n}\n\nexport function unsubscribeForNewMessages() {\n  return dispatch => {\n    dispatch(wsDisconnect())\n  }\n}\n","export const WS_CONNECT = 'WS_CONNECT'\nexport const WS_CONNECTING = 'WS_CONNECTING'\nexport const WS_CONNECTED = 'WS_CONNECTED'\nexport const WS_DISCONNECT = 'WS_DISCONNECT'\nexport const WS_DISCONNECTED = 'WS_DISCONNECTED'\n\nexport function wsConnect(host) {\n  return {\n    type: WS_CONNECT,\n    payload: host,\n  }\n}\n\nexport function wsConnecting() {\n  return {\n    type: WS_CONNECTING,\n  }\n}\n\nexport function wsConnected() {\n  return {\n    type: WS_CONNECTED,\n  }\n}\n\nexport function wsDisconnect() {\n  return {\n    type: WS_DISCONNECT,\n  }\n}\n\nexport function wsDisconnected() {\n  return {\n    type: WS_DISCONNECTED,\n  }\n}\n","import { combineReducers } from 'redux'\nimport { messages, wasMessageReceived } from './messageListData'\nimport {\n  currentUser,\n  currentChat,\n  chatsList,\n  isUserAuthenticated,\n  lastError,\n  usersList,\n} from './chatSettings'\n\nexport default combineReducers({\n  messages,\n  wasMessageReceived,\n  currentUser,\n  currentChat,\n  chatsList,\n  isUserAuthenticated,\n  lastError,\n  usersList,\n})\n","import {\n  ADD_NEW_MESSAGE,\n  MESSAGE_WAS_RECEIVED,\n  REFRESH_MESSAGES_LIST,\n  UNSHIFT_PREVIOUS_MESSAGES,\n  PUSH_NEW_MESSAGES,\n  CLEAR_MESSAGES,\n} from '../actions/messageListActions'\n\nexport function messages(state = [], action) {\n  switch (action.type) {\n    case CLEAR_MESSAGES:\n      return []\n    case ADD_NEW_MESSAGE:\n      return [...state, action.payload]\n    case REFRESH_MESSAGES_LIST:\n      return action.payload\n    case UNSHIFT_PREVIOUS_MESSAGES:\n      const previousMessages = action.payload\n      return [...previousMessages, ...state]\n    case PUSH_NEW_MESSAGES:\n      const newMessages = action.payload\n      return [...state, ...newMessages]\n    default:\n      return state\n  }\n}\n\nexport function wasMessageReceived(state = true, action) {\n  switch (action.type) {\n    case MESSAGE_WAS_RECEIVED:\n      return action.payload\n    default:\n      return state\n  }\n}\n","import {\n  CHANGE_CURRENT_USER,\n  CHANGE_CURRENT_CHAT,\n  REFRESH_CHATS_LIST,\n  SET_AUTHENTICATION_RESULT,\n  SET_LAST_ERROR,\n  FILL_FOUND_USERS_LIST,\n  CLEAR_LAST_ERROR,\n  ADD_NEW_SPECIAL_MESSAGES_PREPROCESSOR_FUNCTION,\n} from '../actions/chatSettingsActions'\n\nexport function currentUser(state = {}, action) {\n  switch (action.type) {\n    case CHANGE_CURRENT_USER:\n      return action.payload\n    default:\n      return state\n  }\n}\n\nexport function currentChat(state = {}, action) {\n  switch (action.type) {\n    case CHANGE_CURRENT_CHAT:\n      return action.payload\n    case ADD_NEW_SPECIAL_MESSAGES_PREPROCESSOR_FUNCTION:\n      return { ...state, ...action.payload }\n    default:\n      return state\n  }\n}\n\nexport function chatsList(state = [], action) {\n  switch (action.type) {\n    case REFRESH_CHATS_LIST:\n      return action.payload\n    default:\n      return state\n  }\n}\n\nexport function isUserAuthenticated(state = false, action) {\n  switch (action.type) {\n    case SET_AUTHENTICATION_RESULT:\n      return action.payload\n    default:\n      return state\n  }\n}\n\nexport function lastError(state = null, action) {\n  switch (action.type) {\n    case SET_LAST_ERROR:\n      return action.payload\n    case CLEAR_LAST_ERROR:\n      return null\n    default:\n      return state\n  }\n}\n\nexport function usersList(state = [], action) {\n  switch (action.type) {\n    case FILL_FOUND_USERS_LIST:\n      return action.payload\n    default:\n      return state\n  }\n}\n","import { applyBackwardPreprocessorFunctionAndPushMessage } from '../actions/messageListActions'\n\nimport {\n  wsConnected,\n  wsDisconnected,\n  WS_CONNECT,\n  WS_DISCONNECT,\n} from '../actions/webSocketActions'\n\nconst webSocketMiddleware = () => {\n  let socket = null\n\n  const onOpen = store => event => {\n    store.dispatch(wsConnected(event.target.url))\n  }\n\n  const onClose = store => () => {\n    store.dispatch(wsDisconnected())\n  }\n\n  const onMessage = store => event => {\n    const data = JSON.parse(event.data)\n\n    switch (data.actionType) {\n      case 'save':\n        const messages = [data.message]\n        store.dispatch(\n          applyBackwardPreprocessorFunctionAndPushMessage(messages)\n        )\n        break\n      default:\n        break\n    }\n  }\n\n  return store => next => action => {\n    switch (action.type) {\n      case WS_CONNECT:\n        if (socket !== null) {\n          socket.close()\n        }\n\n        socket = new WebSocket(action.payload)\n        socket.onmessage = onMessage(store)\n        socket.onclose = onClose(store)\n        socket.onopen = onOpen(store)\n        break\n      case WS_DISCONNECT:\n        if (socket !== null) {\n          socket.close()\n        }\n\n        socket = null\n        break\n      default:\n        return next(action)\n    }\n  }\n}\n\nexport default webSocketMiddleware()\n","import React from 'react'\n\nimport './ModalWindow.sass'\n\nfunction asModalWindow(Component) {\n  return function(props) {\n    return (\n      <div className=\"modalWindow\">\n        <div>\n          <Component {...props} />\n        </div>\n      </div>\n    )\n  }\n}\n\nexport { asModalWindow }\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport './InputField.sass'\n\nfunction InputField(props) {\n  const { caption, name, placeholder, type, value, onChange } = props\n\n  return (\n    <div className=\"inputField\">\n      <label>{caption}</label>\n      <input\n        name={name}\n        placeholder={placeholder}\n        type={type}\n        value={value}\n        onChange={onChange}\n      />\n    </div>\n  )\n}\n\nInputField.propTypes = {\n  caption: PropTypes.string,\n  name: PropTypes.string,\n  placeholder: PropTypes.string,\n  type: PropTypes.string,\n  value: PropTypes.string,\n  onChange: PropTypes.func,\n}\n\nexport { InputField }\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport { InputField } from '../InputField/InputField'\n\nimport './AuthenticationAndRegistrationForm.sass'\nimport '../SubmitButton/SubmitButton.sass'\n\nclass AuthenticationAndRegistrationForm extends React.Component {\n  state = {\n    email: '',\n    name: '',\n    password: '',\n    isRegistrationMode: false,\n  }\n\n  onSubmit = eventArg => {\n    eventArg.preventDefault()\n\n    const { email, name, password, isRegistrationMode } = this.state\n    const { onAuthenticationSubmit, onRegistrationSubmit } = this.props\n\n    const user = {\n      email,\n      name,\n      password,\n    }\n\n    if (isRegistrationMode) {\n      onRegistrationSubmit(user)\n    } else {\n      onAuthenticationSubmit(email, password)\n    }\n\n    this.setState({\n      email: '',\n      name: '',\n      password: '',\n    })\n  }\n\n  updateUserEmailValue = eventArg => {\n    this.setState({\n      email: eventArg.target.value,\n    })\n  }\n\n  updateUserNameValue = eventArg => {\n    this.setState({\n      name: eventArg.target.value,\n    })\n  }\n\n  updateUserPasswordValue = eventArg => {\n    this.setState({\n      password: eventArg.target.value,\n    })\n  }\n\n  changeMode = ({ target: { checked } }) => {\n    this.setState({\n      isRegistrationMode: checked,\n    })\n  }\n\n  renderHeader = () => {\n    let headerText\n\n    if (this.state.isRegistrationMode) {\n      headerText = 'New user registration'\n    } else {\n      headerText = 'Login'\n    }\n\n    return (\n      <h3 className=\"authenticationAndRegistrationForm__Header\">\n        {headerText}\n      </h3>\n    )\n  }\n\n  renderUserNameInputField = () => {\n    if (this.state.isRegistrationMode) {\n      return (\n        <InputField\n          caption=\"User name\"\n          name=\"userName\"\n          placeholder=\"User name\"\n          type=\"text\"\n          value={this.state.name}\n          onChange={this.updateUserNameValue}\n        />\n      )\n    }\n  }\n\n  renderSubmitButton = () => {\n    let buttonText\n\n    if (this.state.isRegistrationMode) {\n      buttonText = 'Sign up'\n    } else {\n      buttonText = 'Sign in'\n    }\n\n    return (\n      <button className=\"submitButton\" type=\"submit\">\n        {buttonText}\n      </button>\n    )\n  }\n\n  render() {\n    return (\n      <div className=\"authenticationAndRegistrationForm\">\n        <input type=\"checkbox\" name=\"changeMode\" onClick={this.changeMode} />\n        <span>Registration</span>\n        <form onSubmit={this.onSubmit}>\n          <div align=\"center\">{this.renderHeader()}</div>\n          {this.renderUserNameInputField()}\n          <InputField\n            caption=\"User email\"\n            name=\"userEmail\"\n            placeholder=\"User email\"\n            type=\"text\"\n            value={this.state.email}\n            onChange={this.updateUserEmailValue}\n          />\n          <InputField\n            caption=\"User password\"\n            name=\"userPassword\"\n            placeholder=\"User password\"\n            type=\"text\"\n            value={this.state.password}\n            onChange={this.updateUserPasswordValue}\n          />\n          <div align=\"center\">{this.renderSubmitButton()}</div>\n        </form>\n      </div>\n    )\n  }\n}\n\nAuthenticationAndRegistrationForm.propTypes = {\n  onAuthenticationSubmit: PropTypes.func.isRequired,\n  onRegistrationSubmit: PropTypes.func.isRequired,\n}\n\nexport { AuthenticationAndRegistrationForm }\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { withRouter } from 'react-router-dom'\n\nimport { AuthenticationAndRegistrationForm } from '../../components/AuthenticationAndRegistrationForm/AuthenticationAndRegistrationForm'\n\nimport { connect } from 'react-redux'\n\nimport {\n  submitUserEmailAndPassword,\n  submitNewUser,\n  resetAuthenticationResult,\n} from '../../actions/chatSettingsActions'\n\nimport './AuthenticationAndRegistrationWindow.sass'\n\nclass AuthenticationAndRegistrationWindow extends React.Component {\n  componentDidUpdate = () => {\n    const { isUserAuthenticated, history } = this.props\n\n    if (isUserAuthenticated) {\n      history.push('/chat')\n    }\n  }\n\n  render() {\n    const { submitUserEmailAndPassword, submitNewUser } = this.props\n\n    return (\n      <div className=\"authenticationAndRegistrationWindow\">\n        <AuthenticationAndRegistrationForm\n          onAuthenticationSubmit={submitUserEmailAndPassword}\n          onRegistrationSubmit={submitNewUser}\n        />\n      </div>\n    )\n  }\n}\n\nAuthenticationAndRegistrationWindow.propTypes = {\n  onSignOut: PropTypes.func.isRequired,\n  submitUserEmailAndPassword: PropTypes.func,\n  submitNewUser: PropTypes.func,\n}\n\nconst mapStateToProps = state => {\n  return {\n    isUserAuthenticated: state.isUserAuthenticated,\n  }\n}\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    submitUserEmailAndPassword: (userEmail, userPassword) =>\n      dispatch(submitUserEmailAndPassword(userEmail, userPassword)),\n    submitNewUser: user => dispatch(submitNewUser(user)),\n    onSignOut: () => dispatch(resetAuthenticationResult()),\n  }\n}\n\nconst AuthenticationAndRegistrationWindowWithRouter = withRouter(\n  AuthenticationAndRegistrationWindow\n)\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(AuthenticationAndRegistrationWindowWithRouter)\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { connect } from 'react-redux'\n\nimport { resetAuthenticationResult } from '../../actions/chatSettingsActions'\n\nimport './SettingsPanel.sass'\n\nclass SettingsPanel extends React.Component {\n  render() {\n    return (\n      <div className=\"settingsPanel\">\n        <span>{this.props.currentUser.name}</span>\n        <button onClick={this.props.onSignOut}>Sign out</button>\n      </div>\n    )\n  }\n}\n\nSettingsPanel.propTypes = {\n  onSignOut: PropTypes.func.isRequired,\n  currentUserName: PropTypes.exact({\n    _id: PropTypes.number.isRequired,\n    name: PropTypes.string.isRequired,\n    email: PropTypes.string.isRequired,\n  }),\n}\n\nconst mapStateToProps = state => {\n  return {\n    currentUser: state.currentUser,\n  }\n}\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    onSignOut: () => dispatch(resetAuthenticationResult()),\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(SettingsPanel)\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport './UserFrame.sass'\n\nclass UserFrame extends React.Component {\n  onUserClick = () => {\n    const { user } = this.props\n\n    this.props.onUserClick(user)\n  }\n\n  render() {\n    const { user } = this.props\n\n    return (\n      <div className=\"userFrame\" onClick={this.onUserClick}>\n        <span>{user.name}</span>\n      </div>\n    )\n  }\n}\n\nUserFrame.propTypes = {\n  chat: PropTypes.exact({\n    _id: PropTypes.string.isRequired,\n    name: PropTypes.string.isRequired,\n    email: PropTypes.string.isRequired,\n  }),\n  onSelectUser: PropTypes.func,\n}\n\nexport { UserFrame }\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport { InputField } from '../../InputField/InputField'\n\nimport '../../SubmitButton/SubmitButton.sass'\n\nclass SeekForm extends React.Component {\n  state = {\n    userSeekData: '',\n  }\n\n  onSubmit = eventArg => {\n    eventArg.preventDefault()\n\n    this.props.onSubmitUserSeekData(this.state.userSeekData)\n\n    this.setState({\n      searchQueryString: '',\n    })\n  }\n\n  updateSearchQueryString = eventArg => {\n    this.setState({\n      userSeekData: eventArg.target.value,\n    })\n  }\n\n  render() {\n    return (\n      <form onSubmit={this.onSubmit}>\n        <InputField\n          caption=\"User email\"\n          name=\"userEmail\"\n          placeholder=\"User email\"\n          type=\"text\"\n          value={this.state.userSeekData}\n          onChange={this.updateSearchQueryString}\n        />\n        <div align=\"center\">\n          <button className=\"submitButton\" type=\"submit\">\n            Find users\n          </button>\n        </div>\n      </form>\n    )\n  }\n}\n\nSeekForm.propTypes = {\n  onSubmitUserSeekData: PropTypes.func.isRequired,\n}\n\nexport { SeekForm }\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport { UserFrame } from '../UserFrame/UserFrame'\nimport { SeekForm } from './__SeekForm/AddToChatNewUserWindow-SeekForm'\n\nimport './AddToChatNewUserWindow.sass'\nimport '../CloseButton/CloseButton.sass'\nimport './__UsersList/AddToChatNewUserWindow-UsersList.sass'\n\nclass AddToChatNewUserWindow extends React.Component {\n  onSubmitUserSeekData = userSeekData => {\n    this.props.findUsers(userSeekData)\n  }\n\n  renderUsersList = () => {\n    const { usersList, onUserClick } = this.props\n\n    if (usersList && usersList.length) {\n      return usersList.map(function(item) {\n        return (\n          <UserFrame onUserClick={onUserClick} key={item._id} user={item} />\n        )\n      })\n    }\n  }\n\n  render() {\n    return (\n      <div className=\"addToChatNewUserWindow\">\n        <h4>Search for a new member</h4>\n        <button className=\"closeButton\" onClick={this.props.onCancelClick}>\n          X\n        </button>\n        <SeekForm onSubmitUserSeekData={this.onSubmitUserSeekData} />\n        <div className=\"addToChatNewUserWindow-UsersList\">\n          {this.renderUsersList()}\n        </div>\n      </div>\n    )\n  }\n}\n\nAddToChatNewUserWindow.propTypes = {\n  usersList: PropTypes.arrayOf(\n    PropTypes.shape({\n      user: PropTypes.exact({\n        _id: PropTypes.number.isRequired,\n        name: PropTypes.string.isRequired,\n        email: PropTypes.string.isRequired,\n      }),\n    })\n  ),\n  findUsers: PropTypes.func.isRequired,\n  onUserClick: PropTypes.func.isRequired,\n}\n\nexport { AddToChatNewUserWindow }\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport './FileInput.sass'\n\nclass FileInput extends React.Component {\n  state = {\n    file: null,\n    filePath: '',\n  }\n\n  updateFile = eventArg => {\n    this.setState({\n      file: eventArg.target.files[0],\n      filePath: eventArg.target.value,\n    })\n\n    this.props.updateFile(eventArg)\n  }\n\n  renderFileName = () => {\n    const { file } = this.state\n    let fileName = ''\n\n    if (file) fileName = file.name\n\n    return <span>{fileName}</span>\n  }\n\n  render() {\n    const { name } = this.props\n\n    return (\n      <div className=\"fileInput\">\n        <div>\n          <span>{this.renderFileName()}</span>\n        </div>\n        <div>\n          <label>\n            <input\n              name={name}\n              type=\"file\"\n              value={this.state.filePath}\n              onChange={this.updateFile}\n            />\n            <span>Open file</span>\n          </label>\n        </div>\n      </div>\n    )\n  }\n}\n\nFileInput.propTypes = {\n  name: PropTypes.string,\n  updateFile: PropTypes.func.isRequired,\n}\n\nexport { FileInput }\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport { FileInput } from '../../FileInput/FileInput'\n\nimport './SpecialMessagesPreprocessorMenu-AddFileForm.sass'\nimport '../../SubmitButton/SubmitButton.sass'\n\nclass AddFileForm extends React.Component {\n  state = {\n    file: null,\n  }\n\n  onSubmit = event => {\n    const { file } = this.state\n    const { onSubmitFile } = this.props\n\n    event.preventDefault()\n\n    if (file) {\n      onSubmitFile(file)\n    }\n  }\n\n  updateMessagesPreprocessorFile = eventArg => {\n    this.setState({\n      file: eventArg.target.files[0],\n    })\n  }\n\n  render() {\n    return (\n      <form className=\"addFileForm\" onSubmit={this.onSubmit}>\n        <FileInput\n          name=\"messagesPreprocessorFile\"\n          updateFile={this.updateMessagesPreprocessorFile}\n        />\n        <div>\n          <button className=\"submitButton\" type=\"submit\">\n            Add\n          </button>\n        </div>\n      </form>\n    )\n  }\n}\n\nAddFileForm.propTypes = {\n  onSubmitFile: PropTypes.func.isRequired,\n}\n\nexport { AddFileForm }\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport { AddFileForm } from './__AddFileForm/SpecialMessagesPreprocessorMenu-AddFileForm'\n\nimport './SpecialMessagesPreprocessorMenu.sass'\n\nclass SpecialMessagesPreprocessorMenu extends React.Component {\n  render() {\n    return (\n      <div className=\"specialMessagesPreprocessorMenu\">\n        <h4>Add special messages preprocessor</h4>\n        <button className=\"closeButton\" onClick={this.props.onCancelClick}>\n          X\n        </button>\n        <AddFileForm onSubmitFile={this.props.onSubmit} />\n      </div>\n    )\n  }\n}\n\nSpecialMessagesPreprocessorMenu.propTypes = {\n  onSubmit: PropTypes.func.isRequired,\n  onCancelClick: PropTypes.func.isRequired,\n}\n\nexport { SpecialMessagesPreprocessorMenu }\n","import React from 'react'\nimport { connect } from 'react-redux'\nimport PropTypes from 'prop-types'\n\nimport { asModalWindow } from '../../components/ModalWindow/asModalWindow'\nimport { AddToChatNewUserWindow } from '../../components/AddToChatNewUserWindow/AddToChatNewUserWindow'\nimport { SpecialMessagesPreprocessorMenu } from '../../components/SpecialMessagesPreprocessorMenu/SpecialMessagesPreprocessorMenu'\nimport {\n  findUsers,\n  addNewUserToCurrentChat,\n  addNewSpecialMessagesPreprocessor,\n} from '../../actions/chatSettingsActions'\n\nimport './CurrentChatSettings.sass'\n\nconst AddToChatNewUserModalWindow = asModalWindow(AddToChatNewUserWindow)\nconst SpecialMessagesPreprocessorModalWindow = asModalWindow(\n  SpecialMessagesPreprocessorMenu\n)\n\nclass CurrentChatSettings extends React.Component {\n  constructor(props) {\n    super(props)\n\n    this.state = {\n      showAddedUserMenu: false,\n      showSpecialMessagesPreprocessorMenu: false,\n    }\n  }\n\n  onAddUserButtonClick = () => {\n    this.setState({\n      showAddedUserMenu: true,\n    })\n  }\n\n  onAddSpecialMessagesPreprocessorButtonClick = () => {\n    this.setState({\n      showSpecialMessagesPreprocessorMenu: true,\n    })\n  }\n\n  addNewUserToCurrentChat = user => {\n    this.cancelUserAdding()\n    this.props.addNewUserToCurrentChat(user)\n  }\n\n  cancelUserAdding = () => {\n    this.setState({\n      showAddedUserMenu: false,\n    })\n  }\n\n  addNewSpecialMessagesPreprocessor = preprocessorFunctionString => {\n    this.cancelSpecialMessagesPreprocessorAdding()\n    this.props.addNewSpecialMessagesPreprocessor(preprocessorFunctionString)\n  }\n\n  cancelSpecialMessagesPreprocessorAdding = () => {\n    this.setState({\n      showSpecialMessagesPreprocessorMenu: false,\n    })\n  }\n\n  renderAddedUserWindow = () => {\n    const {\n      showAddedUserMenu,\n      showSpecialMessagesPreprocessorMenu,\n    } = this.state\n    const { currentChat, findUsers, usersList } = this.props\n\n    if (showAddedUserMenu) {\n      return (\n        <AddToChatNewUserModalWindow\n          findUsers={findUsers}\n          usersList={usersList}\n          onUserClick={this.addNewUserToCurrentChat}\n          onCancelClick={this.cancelUserAdding}\n        />\n      )\n    }\n\n    if (showSpecialMessagesPreprocessorMenu) {\n      return (\n        <SpecialMessagesPreprocessorModalWindow\n          currentChat={currentChat}\n          onSubmit={this.addNewSpecialMessagesPreprocessor}\n          onCancelClick={this.cancelSpecialMessagesPreprocessorAdding}\n        />\n      )\n    }\n\n    if (currentChat._id) {\n      return (\n        <React.Fragment>\n          <button onClick={this.onAddUserButtonClick}>\n            Add new user to chat\n          </button>\n          <button onClick={this.onAddSpecialMessagesPreprocessorButtonClick}>\n            Add special messages preprocessor\n          </button>\n        </React.Fragment>\n      )\n    }\n  }\n\n  render() {\n    return (\n      <div className=\"currentChatSettings\">{this.renderAddedUserWindow()}</div>\n    )\n  }\n}\n\nconst mapStateToProps = state => {\n  return {\n    currentChat: state.currentChat,\n    usersList: state.usersList,\n  }\n}\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    findUsers: userSeekData => dispatch(findUsers(userSeekData)),\n    addNewUserToCurrentChat: user => dispatch(addNewUserToCurrentChat(user)),\n    addNewSpecialMessagesPreprocessor: file =>\n      dispatch(addNewSpecialMessagesPreprocessor(file)),\n  }\n}\n\nCurrentChatSettings.propTypes = {\n  usersList: PropTypes.arrayOf(\n    PropTypes.shape({\n      user: PropTypes.exact({\n        _id: PropTypes.number.isRequired,\n        name: PropTypes.string.isRequired,\n        email: PropTypes.string.isRequired,\n      }),\n    })\n  ),\n  currentChat: PropTypes.exact({\n    _id: PropTypes.string,\n    name: PropTypes.string,\n    users: PropTypes.arrayOf(\n      PropTypes.shape({\n        _id: PropTypes.string.isRequired,\n        name: PropTypes.string.isRequired,\n        email: PropTypes.string.isRequired,\n      })\n    ),\n    forwardPreprocessorFunction: PropTypes.func,\n    backwardPreprocessorFunction: PropTypes.func,\n  }),\n  findUsers: PropTypes.func.isRequired,\n  addNewUserToCurrentChat: PropTypes.func.isRequired,\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(CurrentChatSettings)\n","import React from 'react'\n\nimport SettingsPanel from '../../SettingsPanel/SettingsPanel'\nimport CurrentChatSettings from '../../CurrentChatSettings/CurrentChatSettings'\n\nimport './AppPanel-TopPanel.sass'\n\nfunction TopPanel() {\n  return (\n    <div className=\"topPanel\">\n      <CurrentChatSettings />\n      <SettingsPanel />\n    </div>\n  )\n}\n\nexport { TopPanel }\n","export function addLeadZero(number) {\n  if (number < 10) return '0' + number\n  return number\n}\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { addLeadZero } from '../../helper'\n\nimport './MessageFrame-MessageTimestamp.sass'\n\nfunction MessageTimestamp(props) {\n  const date = new Date(props.time)\n  let hours = addLeadZero(date.getHours())\n  let minutes = addLeadZero(date.getMinutes())\n  let day = addLeadZero(date.getDate())\n  let month = addLeadZero(date.getMonth() + 1)\n  let year = date.getFullYear()\n\n  return (\n    <div className=\"messageFrame-MessageTimestamp\">\n      <span>\n        {hours}:{minutes} {day}.{month}.{year}\n      </span>\n    </div>\n  )\n}\n\nMessageTimestamp.propTypes = {\n  time: PropTypes.oneOfType([\n    PropTypes.number,\n    PropTypes.string,\n    PropTypes.instanceOf(Date),\n  ]).isRequired,\n}\n\nexport { MessageTimestamp }\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport './MessageFrame-AuthorNameLabel.sass'\n\nfunction AuthorNameLabel(props) {\n  return (\n    <span className=\"messageFrame-AuthorNameLabel\">{props.authorName}</span>\n  )\n}\n\nAuthorNameLabel.propTypes = {\n  authorName: PropTypes.string,\n}\n\nexport { AuthorNameLabel }\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nfunction MessageTextField(props) {\n  return <span>{props.text}</span>\n}\n\nMessageTextField.propTypes = {\n  text: PropTypes.string,\n}\n\nexport { MessageTextField }\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { MessageTimestamp } from './__MessageTimestamp/MessageFrame-MessageTimestamp'\nimport { AuthorNameLabel } from './__AuthorNameLabel/MessageFrame-AuthorNameLabel'\nimport { MessageTextField } from './__MessageTextField/MessageFrame-MessageTextField'\n\nimport './MessageFrame.sass'\nimport './_user/MessageFrame_user_another.sass'\nimport './_user/MessageFrame_user_current.sass'\n\nclass MessageFrame extends React.Component {\n  renderAuthorName = () => {\n    const { message, currentUserEmail } = this.props\n\n    if (currentUserEmail === message.authorEmail) {\n      return\n    } else {\n      return <AuthorNameLabel authorName={message.authorName} />\n    }\n  }\n\n  render() {\n    const { message, currentUserEmail } = this.props\n    let messageFrameClass = 'messageFrame'\n\n    if (currentUserEmail === message.authorEmail) {\n      messageFrameClass += ' messageFrame_user_current'\n    } else {\n      messageFrameClass += ' messageFrame_user_another'\n    }\n\n    return (\n      <div className={messageFrameClass}>\n        <div>{this.renderAuthorName()}</div>\n        <div>\n          <MessageTextField text={message.text} />\n        </div>\n        <div>\n          <MessageTimestamp time={message.time} />\n        </div>\n      </div>\n    )\n  }\n}\n\nMessageFrame.propTypes = {\n  message: PropTypes.exact({\n    _id: PropTypes.string,\n    chatId: PropTypes.string.isRequired,\n    authorName: PropTypes.string.isRequired,\n    authorEmail: PropTypes.string.isRequired,\n    time: PropTypes.oneOfType([\n      PropTypes.number,\n      PropTypes.string,\n      PropTypes.instanceOf(Date),\n    ]).isRequired,\n    text: PropTypes.string.isRequired,\n    wasMessageReceived: PropTypes.bool,\n  }),\n}\n\nexport { MessageFrame }\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport './MessageList-ScrollDownButton.sass'\n\nfunction ScrollDownButton(props) {\n  const strToDecode = '&#11015'\n  const parser = new DOMParser()\n  const decodedString = parser.parseFromString(\n    `<!doctype html><body>${strToDecode}`,\n    'text/html'\n  ).body.textContent\n\n  return (\n    <div className=\"scrollDownButton\" onClick={props.onScrollDownClick}>\n      {decodedString}\n    </div>\n  )\n}\n\nScrollDownButton.propTypes = {\n  text: PropTypes.string,\n}\n\nexport { ScrollDownButton }\n","import React from 'react'\nimport { connect } from 'react-redux'\nimport PropTypes from 'prop-types'\nimport {\n  fetchMessagesList,\n  fetchNewMessages,\n  subscribeForNewMessages,\n  unsubscribeForNewMessages,\n} from '../../actions/messageListActions'\n\nimport { MessageFrame } from '../../components/MessageFrame/MessageFrame'\nimport { ScrollDownButton } from './__ScrollDownButton/MessageList-ScrollDownButton'\n//import { updateInterval } from '../applicationSettings'\n\nimport './MessageList.sass'\nimport './__Item/MessageList-Item.sass'\nimport './__ChatNameCaption/MessageList-ChatNameCaption.sass'\n\nclass MessageList extends React.Component {\n  constructor(props) {\n    super(props)\n\n    this.messageListRef = React.createRef()\n\n    this.state = {\n      enableScrollDown: true,\n      previousMessagesLength: 0,\n      suspendMessagesFetching: false,\n      currentChat: null,\n      needScrollDown: true,\n      showScrollDownButton: false,\n    }\n  }\n\n  componentDidMount = () => {\n    const { currentChat, subscribeForNewMessages } = this.props\n    if (this.state.currentChat !== currentChat) {\n      this.setState({ currentChat })\n      subscribeForNewMessages(this.props.currentChat._id)\n    }\n    this.fetchMessages()\n    //this.initializeMessagesListUpdateTimer()\n  }\n\n  // initializeMessagesListUpdateTimer = () => {\n  //   this.timerID = setInterval(() => {\n  //     this.fetchNewMessages()\n  //     this.tryLoadMessagesUntilScrollAppears()\n  //   }, updateInterval)\n  // }\n\n  componentWillUnmount() {\n    this.props.unsubscribeForNewMessages()\n    //clearInterval(this.timerID)\n  }\n\n  componentDidUpdate = () => {\n    const { messages, currentChat, subscribeForNewMessages } = this.props\n    const scrollDownShift = 30\n    const { current } = this.messageListRef\n\n    if (this.state.currentChat !== currentChat) {\n      this.reloadMessagesList()\n      subscribeForNewMessages(this.props.currentChat._id)\n      return\n    }\n\n    if (!messages) return\n\n    const messagesLength = messages.length\n    const previousMessagesLength = this.state.previousMessagesLength\n\n    if (messagesLength <= previousMessagesLength) {\n      return\n    }\n\n    this.setState({\n      previousMessagesLength: messagesLength,\n      suspendMessagesFetching: false,\n    })\n\n    if (current) {\n      current.scrollTop += scrollDownShift\n    }\n\n    this.scrollDownIfNeed()\n  }\n\n  reloadMessagesList = () => {\n    this.setState({\n      currentChat: this.props.currentChat,\n      previousMessagesLength: 0,\n      suspendMessagesFetching: true,\n      needScrollDown: true,\n    })\n\n    this.fetchMessagesForced()\n  }\n\n  fetchMessages = () => {\n    if (this.state.suspendMessagesFetching) return\n\n    this.fetchMessagesForced()\n  }\n\n  fetchMessagesForced = () => {\n    const currentChat = this.props.currentChat\n    const messages = this.props.messages\n\n    if (!currentChat || !currentChat._id) return\n    if (!messages) return\n\n    const time = new Date().getTime()\n\n    const oldestMessageTime = messages.length ? messages[0].time : time\n\n    this.props.fetchMessagesList(currentChat._id, oldestMessageTime)\n  }\n\n  fetchNewMessages = () => {\n    const currentChat = this.props.currentChat\n    const messages = this.props.messages\n\n    if (!currentChat || !currentChat._id) return\n    if (!messages) return\n\n    const lastMessageIndex = messages.length - 1\n\n    if (lastMessageIndex < 0) {\n      this.fetchMessages()\n      return\n    }\n\n    this.props.fetchNewMessages(\n      currentChat._id,\n      messages[lastMessageIndex].time\n    )\n  }\n\n  scrollDownIfNeed = () => {\n    if (this.state.needScrollDown) {\n      this.setState({\n        needScrollDown: false,\n      })\n\n      this.scrollDown()\n    }\n  }\n\n  tryLoadMessagesUntilScrollAppears() {\n    const { current } = this.messageListRef\n\n    if (current.offsetWidth <= current.clientWidth) {\n      this.fetchMessages()\n    }\n  }\n\n  scrollDown = () => {\n    const { current } = this.messageListRef\n\n    this.setState({\n      needScrollDown: false,\n    })\n\n    if (current) {\n      current.scrollTop = current.scrollHeight\n    }\n  }\n\n  onScrollDownClick = () => {\n    this.scrollDown()\n  }\n\n  onScroll = () => {\n    const minScrollTop = 200\n    const scrollDownButtonThreshold = 200\n    const {\n      scrollHeight,\n      scrollTop,\n      clientHeight,\n    } = this.messageListRef.current\n\n    this.setState({\n      showScrollDownButton:\n        scrollHeight - scrollTop >= clientHeight + scrollDownButtonThreshold,\n      needScrollDown: scrollHeight - scrollTop == clientHeight,\n    })\n\n    if (this.state.suspendMessagesFetching) return\n\n    if (scrollTop < minScrollTop) {\n      this.setState({\n        suspendMessagesFetching: true,\n      })\n\n      this.fetchMessages()\n    }\n  }\n\n  renderMessageList = () => {\n    const { messages, currentUser } = this.props\n    const messagesLength = messages.length\n\n    if (messages && messagesLength) {\n      return messages.map(function(item, index) {\n        return (\n          <div className=\"item\" key={index}>\n            <MessageFrame message={item} currentUserEmail={currentUser.email} />\n          </div>\n        )\n      })\n    }\n  }\n\n  renderScrollDownButton = () => {\n    if (this.state.showScrollDownButton) {\n      return <ScrollDownButton onScrollDownClick={this.onScrollDownClick} />\n    }\n  }\n\n  renderChatNameCaption = () => {\n    const chatName = this.props.currentChat.name\n    if (chatName) {\n      return (\n        <div className=\"chatNameCaption\">\n          <div>\n            <span>{chatName}</span>\n          </div>\n        </div>\n      )\n    }\n  }\n\n  render() {\n    const strToDecode = '&#11015'\n    const parser = new DOMParser()\n    const decodedString = parser.parseFromString(\n      `<!doctype html><body>${strToDecode}`,\n      'text/html'\n    ).body.textContent\n\n    return (\n      <React.Fragment>\n        <div\n          ref={this.messageListRef}\n          className=\"messageList\"\n          onScroll={this.onScroll}\n        >\n          {this.renderMessageList()}\n        </div>\n        {this.renderScrollDownButton()}\n        {this.renderChatNameCaption()}\n      </React.Fragment>\n    )\n  }\n}\n\nconst mapStateToProps = state => {\n  return {\n    messages: state.messages,\n    currentChat: state.currentChat,\n    currentUser: state.currentUser,\n  }\n}\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    fetchMessagesList: (chatId, oldestMessageTime) =>\n      dispatch(fetchMessagesList(chatId, oldestMessageTime)),\n    fetchNewMessages: (chatId, newestMessageTime) =>\n      dispatch(fetchNewMessages(chatId, newestMessageTime)),\n    subscribeForNewMessages: chatId =>\n      dispatch(subscribeForNewMessages(chatId)),\n    unsubscribeForNewMessages: () => dispatch(unsubscribeForNewMessages()),\n  }\n}\n\nMessageList.propTypes = {\n  messages: PropTypes.arrayOf(\n    PropTypes.shape({\n      message: PropTypes.exact({\n        chatId: PropTypes.number.isRequired,\n        authorName: PropTypes.string.isRequired,\n        authorEmail: PropTypes.string.isRequired,\n        time: PropTypes.oneOfType([\n          PropTypes.number,\n          PropTypes.string,\n          PropTypes.instanceOf(Date),\n        ]).isRequired,\n        text: PropTypes.string.isRequired,\n        wasMessageReceived: PropTypes.bool,\n      }),\n    })\n  ),\n}\n\nexport { MessageList }\nexport default connect(mapStateToProps, mapDispatchToProps)(MessageList)\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport './SimpleDataForm.sass'\n\nclass SimpleDataForm extends React.Component {\n  state = {\n    newData: '',\n  }\n\n  onSubmit = event => {\n    event.preventDefault()\n\n    this.props.onSubmitNewData(this.state.newData)\n\n    this.setState({\n      newData: '',\n    })\n  }\n\n  updateInputValue = eventArg => {\n    this.setState({\n      newData: eventArg.target.value,\n    })\n  }\n\n  render() {\n    const { caption, name, placeholder, type, buttonCaption } = this.props\n\n    return (\n      <form className=\"simpleDataForm\" onSubmit={this.onSubmit}>\n        <h4>{caption}</h4>\n        <div>\n          <input\n            name={name}\n            placeholder={placeholder}\n            type={type}\n            value={this.state.newData}\n            onChange={this.updateInputValue}\n          />\n          <button type=\"submit\">{buttonCaption}</button>\n        </div>\n      </form>\n    )\n  }\n}\n\nSimpleDataForm.propTypes = {\n  onSubmitNewData: PropTypes.func.isRequired,\n  caption: PropTypes.string,\n  name: PropTypes.string.isRequired,\n  placeholder: PropTypes.string,\n  type: PropTypes.string.isRequired,\n  buttonCaption: PropTypes.string,\n}\n\nexport { SimpleDataForm }\n","import React from 'react'\nimport { connect } from 'react-redux'\nimport { encryptAndSendNewMessage } from '../../actions/messageListActions'\n\nimport MessageList from '../MessageList/MessageList'\nimport { SimpleDataForm } from '../../components/SimpleDataForm/SimpleDataForm'\n\nimport './CurrentChatPanel.sass'\n\nclass CurrentChatPanel extends React.Component {\n  renderMessageList() {\n    if (!this.props.currentUser._id) return\n    if (!this.props.currentChat._id) return\n\n    return (\n      <React.Fragment>\n        <MessageList />\n        <SimpleDataForm\n          onSubmitNewData={this.props.sendNewMessage}\n          caption=\"+Message\"\n          name=\"userMessage\"\n          placeholder=\"message text\"\n          type=\"text\"\n          buttonCaption=\"Send\"\n        />\n      </React.Fragment>\n    )\n  }\n\n  render() {\n    return <div className=\"currentChatPanel\">{this.renderMessageList()}</div>\n  }\n}\n\nconst mapStateToProps = state => {\n  return {\n    currentUser: state.currentUser,\n    currentChat: state.currentChat,\n  }\n}\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    sendNewMessage: message => dispatch(encryptAndSendNewMessage(message)),\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(CurrentChatPanel)\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport './ChatList-ChatFrame.sass'\n\nclass ChatFrame extends React.Component {\n  onSelectChat = () => {\n    const { chat } = this.props\n\n    this.props.onSelectChat(chat)\n  }\n\n  renderUsersList = users => {\n    if (users && users.length) {\n      return users.map((item, index) => {\n        return (\n          <div key={index}>\n            <p>{item.name}</p>\n          </div>\n        )\n      })\n    }\n  }\n\n  render() {\n    const { chat } = this.props\n\n    return (\n      <div className=\"chatList-ChatFrame\" onClick={this.onSelectChat}>\n        <div>\n          <h4>{chat.name}</h4>\n        </div>\n        <div>\n          <p>Chat members:</p>\n          <div>{this.renderUsersList(chat.users)}</div>\n        </div>\n      </div>\n    )\n  }\n}\n\nChatFrame.propTypes = {\n  chat: PropTypes.exact({\n    _id: PropTypes.string.isRequired,\n    name: PropTypes.string.isRequired,\n    users: PropTypes.arrayOf(\n      PropTypes.exact({\n        _id: PropTypes.string.isRequired,\n        name: PropTypes.string.isRequired,\n        email: PropTypes.string.isRequired,\n      })\n    ).isRequired,\n  }),\n  onSelectChat: PropTypes.func.isRequired,\n}\n\nexport { ChatFrame }\n","import React from 'react'\nimport { connect } from 'react-redux'\nimport PropTypes from 'prop-types'\n\nimport {\n  fetchChatsList,\n  tryGetPreprocessorAnd–°hangeCurrentChat,\n} from '../../actions/chatSettingsActions'\n\nimport { ChatFrame } from './__ChatFrame/ChatList-ChatFrame'\n\nimport './ChatList.sass'\n\nclass ChatList extends React.Component {\n  componentDidMount() {\n    let userId = this.props.currentUser._id\n\n    if (!userId) return\n\n    this.props.fetchChatsList(userId)\n  }\n\n  renderChatList = () => {\n    const { chatsList, changeCurrentChat } = this.props\n\n    if (chatsList && chatsList.length) {\n      return chatsList.map(function(item) {\n        return (\n          <ChatFrame\n            onSelectChat={changeCurrentChat}\n            key={item._id}\n            chat={item}\n          />\n        )\n      })\n    }\n  }\n\n  render() {\n    return <div className=\"—ÅhatList\">{this.renderChatList()}</div>\n  }\n}\n\nconst mapStateToProps = state => {\n  return {\n    chatsList: state.chatsList,\n    currentUser: state.currentUser,\n  }\n}\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    fetchChatsList: userId => dispatch(fetchChatsList(userId)),\n    changeCurrentChat: chat =>\n      dispatch(tryGetPreprocessorAnd–°hangeCurrentChat(chat)),\n  }\n}\n\nChatList.propTypes = {\n  chatsList: PropTypes.arrayOf(\n    PropTypes.shape({\n      chat: PropTypes.exact({\n        _id: PropTypes.string.isRequired,\n        name: PropTypes.string.isRequired,\n        users: PropTypes.arrayOf(\n          PropTypes.shape({\n            _id: PropTypes.string.isRequired,\n            name: PropTypes.string.isRequired,\n            email: PropTypes.string.isRequired,\n          })\n        ).isRequired,\n      }),\n    })\n  ),\n  changeCurrentChat: PropTypes.func.isRequired,\n}\n\nexport { ChatList }\nexport default connect(mapStateToProps, mapDispatchToProps)(ChatList)\n","import React from 'react'\nimport { connect } from 'react-redux'\n\nimport ChatList from '../ChatList/ChatList'\nimport { SimpleDataForm } from '../../components/SimpleDataForm/SimpleDataForm'\n\nimport { createNewChat } from '../../actions/chatSettingsActions'\n\nimport './UserChatsPanel.sass'\n\nclass UserChatsPanel extends React.Component {\n  onSubmitNewChat = chatName => {\n    this.props.createNewChat(chatName, [this.props.currentUser._id])\n  }\n\n  render() {\n    return (\n      <div className=\"userChatsPanel\">\n        <ChatList />\n        <SimpleDataForm\n          onSubmitNewData={this.onSubmitNewChat}\n          caption=\"+Chat\"\n          name=\"chatName\"\n          placeholder=\"chat name\"\n          type=\"text\"\n          buttonCaption=\"Create\"\n        />\n      </div>\n    )\n  }\n}\n\nconst mapStateToProps = state => {\n  return {\n    currentUser: state.currentUser,\n  }\n}\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    createNewChat: (chatName, usersIds) =>\n      dispatch(createNewChat(chatName, usersIds)),\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(UserChatsPanel)\n","import React from 'react'\n\nimport CurrentChatPanel from '../../CurrentChatPanel/CurrentChatPanel'\nimport UserChatsPanel from '../../UserChatsPanel/UserChatsPanel'\n\nimport './AppPanel-MainPanel.sass'\n\nfunction MainPanel() {\n  return (\n    <div className=\"mainPanel\">\n      <UserChatsPanel />\n      <CurrentChatPanel />\n    </div>\n  )\n}\n\nexport { MainPanel }\n","import React from 'react'\nimport { withRouter } from 'react-router-dom'\n\nimport { TopPanel } from './__TopPanel/AppPanel-TopPanel'\nimport { MainPanel } from './__MainPanel/AppPanel-MainPanel'\n\nimport { connect } from 'react-redux'\n\nimport './AppPanel.sass'\n\nclass AppPanel extends React.Component {\n  componentDidUpdate = () => {\n    const { isUserAuthenticated, history } = this.props\n\n    if (!isUserAuthenticated) {\n      history.push('/login')\n    }\n  }\n\n  render() {\n    return (\n      <div className=\"appPanel\">\n        <div className=\"mainPanelPlace\">\n          <MainPanel />\n        </div>\n        <div className=\"topPanelPlace\">\n          <TopPanel />\n        </div>\n      </div>\n    )\n  }\n}\n\nconst mapStateToProps = state => {\n  return {\n    isUserAuthenticated: state.isUserAuthenticated,\n  }\n}\n\nconst AppPanelWithRouter = withRouter(AppPanel)\nexport default connect(mapStateToProps)(AppPanelWithRouter)\n","import React from 'react'\nimport { Route, Switch, withRouter } from 'react-router-dom'\n\nimport { asModalWindow } from '../components/ModalWindow/asModalWindow'\nimport AuthenticationAndRegistrationWindow from './AuthenticationAndRegistrationWindow/AuthenticationAndRegistrationWindow'\nimport { ErrorWindow } from '../components/ErrorWindow/ErrorWindow'\nimport AppPanel from './AppPanel/AppPanel'\n\nimport { connect } from 'react-redux'\n\nimport {\n  checkIsUserAuthenticated,\n  submitUserEmailAndPassword,\n  submitNewUser,\n  clearLastError,\n  resetAuthenticationResult,\n} from '../actions/chatSettingsActions'\n\nconst ErrorModalWindow = asModalWindow(ErrorWindow)\n\nclass App extends React.Component {\n  componentDidMount() {\n    const { isUserAuthenticated, checkIsUserAuthenticated } = this.props\n\n    checkIsUserAuthenticated()\n\n    if (isUserAuthenticated) {\n      this.props.history.push('/chat')\n    } else {\n      this.props.history.push('/login')\n    }\n  }\n\n  renderErrorWindow() {\n    if (!this.props.lastError) return\n\n    return (\n      <ErrorModalWindow\n        onOk={this.props.clearLastError}\n        lastError={this.props.lastError}\n      />\n    )\n  }\n\n  renderMainContent() {\n    return (\n      <Switch>\n        <Route\n          exact\n          path=\"/login\"\n          render={() => <AuthenticationAndRegistrationWindow />}\n        />\n        <Route path=\"/chat\" component={AppPanel} />\n      </Switch>\n    )\n  }\n\n  render() {\n    return (\n      <React.Fragment>\n        {this.renderErrorWindow()}\n        {this.renderMainContent()}\n      </React.Fragment>\n    )\n  }\n}\n\nconst mapStateToProps = state => {\n  return {\n    isUserAuthenticated: state.isUserAuthenticated,\n    lastError: state.lastError,\n  }\n}\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    checkIsUserAuthenticated: () => dispatch(checkIsUserAuthenticated()),\n    submitUserEmailAndPassword: (userEmail, userPassword) =>\n      dispatch(submitUserEmailAndPassword(userEmail, userPassword)),\n    submitNewUser: user => dispatch(submitNewUser(user)),\n    clearLastError: () => dispatch(clearLastError()),\n    onSignOut: () => dispatch(resetAuthenticationResult()),\n  }\n}\n\nconst AppWithRouter = withRouter(App)\nexport default connect(mapStateToProps, mapDispatchToProps)(AppWithRouter)\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport './ErrorWindow.sass'\n\nfunction ErrorWindow(props) {\n  const { status, badStatusText, message } = props.lastError\n\n  let statusParagraph, badStatusTextParagraph, messageParagraph\n\n  if (status) {\n    statusParagraph = <p>Status: {status}</p>\n    badStatusTextParagraph = <p>Status text: {badStatusText}</p>\n    messageParagraph = <p>Message: {message}</p>\n  }\n\n  return (\n    <div className=\"errorWindow\">\n      <div>\n        <h4>Error</h4>\n      </div>\n      <div>\n        {statusParagraph}\n        {badStatusTextParagraph}\n        {messageParagraph}\n      </div>\n      <button onClick={props.onOk}>Ok</button>\n    </div>\n  )\n}\n\nErrorWindow.propTypes = {\n  lastError: PropTypes.exact({\n    status: PropTypes.number,\n    badStatusText: PropTypes.string,\n    message: PropTypes.string,\n  }),\n}\n\nexport { ErrorWindow }\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n)\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href)\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config)\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          )\n        })\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config)\n      }\n    })\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing\n        if (installingWorker == null) {\n          return\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              )\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration)\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.')\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration)\n              }\n            }\n          }\n        }\n      }\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error)\n    })\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type')\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload()\n          })\n        })\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config)\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      )\n    })\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister()\n    })\n  }\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport { Provider } from 'react-redux'\nimport { BrowserRouter } from 'react-router-dom'\nimport configureStore from './store/configureStore'\nimport './index.css'\nimport App from './containers/App'\nimport * as serviceWorker from './serviceWorker'\n\nconst store = configureStore()\n\nReactDOM.render(\n  <BrowserRouter>\n    <Provider store={store}>\n      <App />\n    </Provider>\n  </BrowserRouter>,\n  document.getElementById('root')\n)\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister()\n","import { createStore, applyMiddleware } from 'redux'\nimport thunk from 'redux-thunk'\nimport rootReducer from '../reducers'\nimport wsMiddleware from '../middleware/webSocketMiddleware'\n\nexport default function configureStore(initialState) {\n  return createStore(rootReducer, applyMiddleware(thunk, wsMiddleware))\n}\n"],"sourceRoot":""}