(this.webpackJsonpwhisper=this.webpackJsonpwhisper||[]).push([[0],[,,,,,,,,,,,,,,,,function(e,t,n){},,,function(e,t,n){e.exports=n(59)},,,,,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),s=n(10),c=n.n(s),o=n(6),u=n(8),i=n(18),l=n(9),p=n(5),m=n.n(p),f=n(7),d="http://localhost:4000/",h=n(11),v={Accept:"application/json","Content-Type":"application/json"};function g(e){return{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}function b(e){if(!e.ok)return{status:e.status,badStatusText:e.statusText,message:e.message}}function S(e){return/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/.test(e)}function E(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(){t(r.result)},r.onerror=n,r.readAsText(e)}))}function w(e,t){return t&&(e=e.map((function(e){var n=t(e.text);return Object(h.a)({},e,{text:n})}))),e}function C(){return y.apply(this,arguments)}function y(){return(y=Object(f.a)(m.a.mark((function e(){var t,n,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=localStorage,n=t.userJson){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,JSON.parse(n);case 5:if(r=e.sent){e.next=8;break}return e.abrupt("return",null);case 8:return e.abrupt("return",r.token?r.token:null);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){return{type:"CHANGE_CURRENT_USER",payload:e}}function k(e){return{type:"CHANGE_CURRENT_CHAT",payload:e}}function N(e){return{type:"SET_AUTHENTICATION_RESULT",payload:e}}function U(e){return function(t){401===e.status&&t(x()),t(M(e))}}function M(e){return{type:"SET_LAST_ERROR",payload:e}}function x(){return function(e){localStorage.removeItem("userJson"),e(N(!1))}}function _(e,t){return{type:"ADD_NEW_SPECIAL_MESSAGES_PREPROCESSOR_FUNCTION",payload:{forwardPreprocessorFunction:e,backwardPreprocessorFunction:t}}}function j(e){return function(t){var n,r,a=localStorage.getItem(e._id);if(a){var s=JSON.parse(a);n=new Function("text",s.forward),r=new Function("text",s.backward)}t(k(e)),t({type:"CLEAR_MESSAGES"}),n&&r&&t(_(n,r))}}function A(e){return function(){var t=Object(f.a)(m.a.mark((function t(n){var r,a,s;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,C();case 3:if(r=t.sent){t.next=6;break}return t.abrupt("return");case 6:return t.next=8,fetch("".concat(d).concat("chats/listRequest/","?user_id=").concat(e),{method:"GET",headers:g(r)});case 8:if(a=t.sent,s=b(a)){t.next=14;break}return t.next=13,a.json();case 13:s=t.sent;case 14:s.badStatusText?(n(U(s)),localStorage.removeItem("token"),localStorage.removeItem("userJson")):n({type:"REFRESH_CHATS_LIST",payload:s}),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(0),console.log("error",t.t0);case 20:case"end":return t.stop()}}),t,null,[[0,17]])})));return function(e){return t.apply(this,arguments)}}()}function R(e){return{type:"ADD_NEW_MESSAGE",payload:e}}function T(e){return{type:"MESSAGE_WAS_RECEIVED",payload:e}}function L(e){return function(t,n){var r=n().currentChat.forwardPreprocessorFunction;r&&(e=r(e)),t(function(e){return function(){var t=Object(f.a)(m.a.mark((function t(n,r){var a,s,c,o,u,i,l,p;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,C();case 3:if(a=t.sent){t.next=6;break}return t.abrupt("return");case 6:return n(T(!1)),s=(new Date).getTime(),c=r().currentUser.email,o=r().currentUser.name,u=r().currentChat._id,i={chatId:u,time:s,authorEmail:c,authorName:o,text:e},t.next=14,fetch(d+"messages/new/",{method:"POST",headers:g(a),body:JSON.stringify(i)});case 14:if(l=t.sent,p=b(l)){t.next=20;break}return t.next=19,l.json();case 19:p=t.sent;case 20:p.status?(n(U(p)),i.wasMessageReceived=!1,n(R(i)),localStorage.removeItem("token")):(i.wasMessageReceived=!0,n(T(!0))),t.next=26;break;case 23:t.prev=23,t.t0=t.catch(0),console.log("error",t.t0);case 26:case"end":return t.stop()}}),t,null,[[0,23]])})));return function(e,n){return t.apply(this,arguments)}}()}(e))}}function F(e){return function(t,n){var r=n().currentChat.backwardPreprocessorFunction;r&&(e=w(e,r)),t(function(e){return{type:"PUSH_NEW_MESSAGES",payload:e}}(e))}}var D=Object(u.c)({messages:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CLEAR_MESSAGES":return[];case"ADD_NEW_MESSAGE":return[].concat(Object(l.a)(e),[t.payload]);case"REFRESH_MESSAGES_LIST":return t.payload;case"UNSHIFT_PREVIOUS_MESSAGES":var n=t.payload;return[].concat(Object(l.a)(n),Object(l.a)(e));case"PUSH_NEW_MESSAGES":var r=t.payload;return[].concat(Object(l.a)(e),Object(l.a)(r));default:return e}},wasMessageReceived:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"MESSAGE_WAS_RECEIVED":return t.payload;default:return e}},currentUser:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CHANGE_CURRENT_USER":return t.payload;default:return e}},currentChat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CHANGE_CURRENT_CHAT":return t.payload;case"ADD_NEW_SPECIAL_MESSAGES_PREPROCESSOR_FUNCTION":return Object(h.a)({},e,{},t.payload);default:return e}},chatsList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"REFRESH_CHATS_LIST":return t.payload;default:return e}},isUserAuthenticated:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_AUTHENTICATION_RESULT":return t.payload;default:return e}},lastError:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_LAST_ERROR":return t.payload;case"CLEAR_LAST_ERROR":return null;default:return e}},usersList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"FILL_FOUND_USERS_LIST":return t.payload;default:return e}}}),P=function(){var e=null;return function(t){return function(n){return function(r){switch(r.type){case"WS_CONNECT":null!==e&&e.close(),(e=new WebSocket(r.payload)).onmessage=function(e){return function(t){var n=JSON.parse(t.data);switch(n.actionType){case"save":var r=[n.message];e.dispatch(F(r))}}}(t),e.onclose=function(e){return function(){e.dispatch({type:"WS_DISCONNECTED"})}}(t),e.onopen=function(e){return function(t){e.dispatch((t.target.url,{type:"WS_CONNECTED"}))}}(t);break;case"WS_DISCONNECT":null!==e&&e.close(),e=null;break;default:return n(r)}}}}}();n(31);var I=n(1),W=n(2),H=n(4),J=n(3);function G(e){return e<10?"0"+e:e}n(32);function B(e){var t=new Date(e.time),n=G(t.getHours()),r=G(t.getMinutes()),s=G(t.getDate()),c=G(t.getMonth()+1),o=t.getFullYear();return a.a.createElement("div",{className:"messageFrame-MessageTimestamp"},a.a.createElement("span",null,n,":",r," ",s,".",c,".",o))}n(33);function V(e){return a.a.createElement("span",{className:"messageFrame-AuthorNameLabel"},e.authorName)}function z(e){return a.a.createElement("span",null,e.text)}n(34),n(35),n(36);var Q=function(e){Object(H.a)(n,e);var t=Object(J.a)(n);function n(){var e;Object(I.a)(this,n);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).renderAuthorName=function(){var t=e.props,n=t.message;return t.currentUserEmail===n.authorEmail?void 0:a.a.createElement(V,{authorName:n.authorName})},e}return Object(W.a)(n,[{key:"render",value:function(){var e=this.props,t=e.message,n="messageFrame";return e.currentUserEmail===t.authorEmail?n+=" messageFrame_user_current":n+=" messageFrame_user_another",a.a.createElement("div",{className:n},a.a.createElement("div",null,this.renderAuthorName()),a.a.createElement("div",null,a.a.createElement(z,{text:t.text})),a.a.createElement("div",null,a.a.createElement(B,{time:t.time})))}}]),n}(a.a.Component);n(37);function Z(e){var t=(new DOMParser).parseFromString("<!doctype html><body>".concat("&#11015"),"text/html").body.textContent;return a.a.createElement("div",{className:"scrollDownButton",onClick:e.onScrollDownClick},t)}n(38),n(39);var q=function(e){Object(H.a)(n,e);var t=Object(J.a)(n);function n(e){var r;return Object(I.a)(this,n),(r=t.call(this,e)).componentDidMount=function(){var e=r.props,t=e.currentChat,n=e.subscribeForNewMessages;r.state.currentChat!==t&&(r.setState({currentChat:t}),n(r.props.currentChat._id)),r.fetchMessages()},r.componentDidUpdate=function(){var e=r.props,t=e.messages,n=e.currentChat,a=e.subscribeForNewMessages,s=r.messageListRef.current;if(r.state.currentChat!==n)return r.reloadMessagesList(),void a(r.props.currentChat._id);if(t){var c=t.length;c<=r.state.previousMessagesLength||(r.setState({previousMessagesLength:c,suspendMessagesFetching:!1}),s&&(s.scrollTop+=30),r.scrollDownIfNeed())}},r.reloadMessagesList=function(){r.setState({currentChat:r.props.currentChat,previousMessagesLength:0,suspendMessagesFetching:!0,needScrollDown:!0}),r.fetchMessagesForced()},r.fetchMessages=function(){r.state.suspendMessagesFetching||r.fetchMessagesForced()},r.fetchMessagesForced=function(){var e=r.props.currentChat,t=r.props.messages;if(e&&e._id&&t){var n=(new Date).getTime(),a=t.length?t[0].time:n;r.props.fetchMessagesList(e._id,a)}},r.fetchNewMessages=function(){var e=r.props.currentChat,t=r.props.messages;if(e&&e._id&&t){var n=t.length-1;n<0?r.fetchMessages():r.props.fetchNewMessages(e._id,t[n].time)}},r.scrollDownIfNeed=function(){r.state.needScrollDown&&(r.setState({needScrollDown:!1}),r.scrollDown())},r.scrollDown=function(){var e=r.messageListRef.current;r.setState({needScrollDown:!1}),e&&(e.scrollTop=e.scrollHeight)},r.onScrollDownClick=function(){r.scrollDown()},r.onScroll=function(){var e=r.messageListRef.current,t=e.scrollHeight,n=e.scrollTop,a=e.clientHeight;r.setState({showScrollDownButton:t-n>=a+200,needScrollDown:t-n==a}),r.state.suspendMessagesFetching||n<200&&(r.setState({suspendMessagesFetching:!0}),r.fetchMessages())},r.renderMessageList=function(){var e=r.props,t=e.messages,n=e.currentUser,s=t.length;if(t&&s)return t.map((function(e,t){return a.a.createElement("div",{className:"item",key:t},a.a.createElement(Q,{message:e,currentUserEmail:n.email}))}))},r.renderScrollDownButton=function(){if(r.state.showScrollDownButton)return a.a.createElement(Z,{onScrollDownClick:r.onScrollDownClick})},r.messageListRef=a.a.createRef(),r.state={enableScrollDown:!0,previousMessagesLength:0,suspendMessagesFetching:!1,currentChat:null,needScrollDown:!0,showScrollDownButton:!1},r}return Object(W.a)(n,[{key:"componentWillUnmount",value:function(){this.props.unsubscribeForNewMessages()}},{key:"tryLoadMessagesUntilScrollAppears",value:function(){var e=this.messageListRef.current;e.offsetWidth<=e.clientWidth&&this.fetchMessages()}},{key:"render",value:function(){(new DOMParser).parseFromString("<!doctype html><body>".concat("&#11015"),"text/html").body.textContent;return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{ref:this.messageListRef,className:"messageList",onScroll:this.onScroll},this.renderMessageList()),this.renderScrollDownButton())}}]),n}(a.a.Component),$=Object(o.b)((function(e){return{messages:e.messages,currentChat:e.currentChat,currentUser:e.currentUser}}),(function(e){return{fetchMessagesList:function(t,n){return e(function(e,t){return function(){var n=Object(f.a)(m.a.mark((function n(r,a){var s,c,o,u;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,C();case 3:if(s=n.sent){n.next=6;break}return n.abrupt("return");case 6:return n.next=8,fetch("".concat(d).concat("messages/listRequest/","?chat_id=").concat(e,"&oldest_message_time=").concat(t,"&fetch_messages_count=").concat(15),{method:"GET",headers:g(s)});case 8:if(c=n.sent,o=b(c)){n.next=14;break}return n.next=13,c.json();case 13:o=n.sent;case 14:o.badStatusText?(r(U(o)),localStorage.removeItem("token")):(u=a().currentChat.backwardPreprocessorFunction,o=w(o,u),r({type:"UNSHIFT_PREVIOUS_MESSAGES",payload:o})),n.next=20;break;case 17:n.prev=17,n.t0=n.catch(0),console.log("error",n.t0);case 20:case"end":return n.stop()}}),n,null,[[0,17]])})));return function(e,t){return n.apply(this,arguments)}}()}(t,n))},fetchNewMessages:function(t,n){return e(function(e,t){return function(){var n=Object(f.a)(m.a.mark((function n(r,a){var s,c,o;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,C();case 3:if(s=n.sent){n.next=6;break}return n.abrupt("return");case 6:return n.next=8,fetch("".concat(d).concat("messages/lastMessages/","?chat_id=").concat(e,"&newest_message_time=").concat(t),{method:"GET",headers:g(s)});case 8:if(c=n.sent,o=b(c)){n.next=14;break}return n.next=13,c.json();case 13:o=n.sent;case 14:o.badStatusText?(r(U(o)),localStorage.removeItem("token")):r(F(o)),n.next=20;break;case 17:n.prev=17,n.t0=n.catch(0),console.log("error",n.t0);case 20:case"end":return n.stop()}}),n,null,[[0,17]])})));return function(e,t){return n.apply(this,arguments)}}()}(t,n))},subscribeForNewMessages:function(t){return e(function(e){return function(t){t({type:"WS_CONNECT",payload:"".concat("ws://localhost:4000/").concat(e)})}}(t))},unsubscribeForNewMessages:function(){return e((function(e){e({type:"WS_DISCONNECT"})}))}}}))(q),X=(n(40),function(e){Object(H.a)(n,e);var t=Object(J.a)(n);function n(){var e;Object(I.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).state={newMessage:""},e.onSubmit=function(t){t.preventDefault(),e.props.onSubmitNewMessage(e.state.newMessage),e.setState({newMessage:""})},e.updateInputValue=function(t){e.setState({newMessage:t.target.value})},e}return Object(W.a)(n,[{key:"render",value:function(){return a.a.createElement("form",{className:"newMessageForm",onSubmit:this.onSubmit},a.a.createElement("h4",null,"+Message"),a.a.createElement("input",{name:"userMessage",placeholder:"message text",type:"text",value:this.state.newMessage,onChange:this.updateInputValue}),a.a.createElement("button",{type:"submit"},"Send message"))}}]),n}(a.a.Component)),Y=(n(41),function(e){Object(H.a)(n,e);var t=Object(J.a)(n);function n(){return Object(I.a)(this,n),t.apply(this,arguments)}return Object(W.a)(n,[{key:"renderMessageList",value:function(){if(this.props.currentUser._id&&this.props.currentChat._id)return a.a.createElement(a.a.Fragment,null,a.a.createElement($,null),a.a.createElement(X,{onSubmitNewMessage:this.props.sendNewMessage}))}},{key:"render",value:function(){return a.a.createElement("div",{className:"currentChatPanel"},this.renderMessageList())}}]),n}(a.a.Component)),K=Object(o.b)((function(e){return{currentUser:e.currentUser,currentChat:e.currentChat}}),(function(e){return{sendNewMessage:function(t){return e(L(t))}}}))(Y),ee=(n(42),function(e){Object(H.a)(n,e);var t=Object(J.a)(n);function n(){var e;Object(I.a)(this,n);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).onSelectChat=function(){var t=e.props.chat;e.props.onSelectChat(t)},e.renderUsersList=function(e){if(e&&e.length)return e.map((function(e,t){return a.a.createElement("div",{key:t},a.a.createElement("p",null,e.name))}))},e}return Object(W.a)(n,[{key:"render",value:function(){var e=this.props.chat;return a.a.createElement("div",{className:"chatList-ChatFrame",onClick:this.onSelectChat},a.a.createElement("div",null,a.a.createElement("h4",null,e.name)),a.a.createElement("div",null,a.a.createElement("p",null,"Chat members:"),a.a.createElement("div",null,this.renderUsersList(e.users))))}}]),n}(a.a.Component)),te=(n(43),function(e){Object(H.a)(n,e);var t=Object(J.a)(n);function n(){var e;Object(I.a)(this,n);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).renderChatList=function(){var t=e.props,n=t.chatsList,r=t.changeCurrentChat;if(n&&n.length)return n.map((function(e){return a.a.createElement(ee,{onSelectChat:r,key:e._id,chat:e})}))},e}return Object(W.a)(n,[{key:"componentDidMount",value:function(){var e=this.props.currentUser._id;e&&this.props.fetchChatsList(e)}},{key:"render",value:function(){return a.a.createElement("div",{className:"\u0441hatList"},this.renderChatList())}}]),n}(a.a.Component)),ne=Object(o.b)((function(e){return{chatsList:e.chatsList,currentUser:e.currentUser}}),(function(e){return{fetchChatsList:function(t){return e(A(t))},changeCurrentChat:function(t){return e(j(t))}}}))(te),re=(n(44),function(e){Object(H.a)(n,e);var t=Object(J.a)(n);function n(){var e;Object(I.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).state={name:"",users:[]},e.onSubmit=function(t){t.preventDefault(),e.props.onSubmitNewChat(e.state.name,[e.props.currentUserId]),e.setState({name:"",users:[]})},e.updateChatNameValue=function(t){e.setState({name:t.target.value})},e}return Object(W.a)(n,[{key:"render",value:function(){return a.a.createElement("form",{className:"newChatForm",onSubmit:this.onSubmit},a.a.createElement("h4",null,"+Chat"),a.a.createElement("input",{name:"chatName",placeholder:"chat name",type:"text",value:this.state.name,onChange:this.updateChatNameValue}),a.a.createElement("button",{type:"submit"},"Create new chat"))}}]),n}(a.a.Component)),ae=(n(45),function(e){Object(H.a)(n,e);var t=Object(J.a)(n);function n(){return Object(I.a)(this,n),t.apply(this,arguments)}return Object(W.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"userChatsPanel"},a.a.createElement(ne,null),a.a.createElement(re,{onSubmitNewChat:this.props.createNewChat,currentUserId:this.props.currentUser._id}))}}]),n}(a.a.Component)),se=Object(o.b)((function(e){return{currentUser:e.currentUser}}),(function(e){return{createNewChat:function(t,n){return e((r=t,a=n,function(){var e=Object(f.a)(m.a.mark((function e(t,n){var s,c,o,u,i,l;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,C();case 3:if(s=e.sent){e.next=6;break}return e.abrupt("return");case 6:return c={chat:{name:r,users:a}},e.next=9,fetch(d+"chats/new/",{method:"POST",headers:g(s),body:JSON.stringify(c)});case 9:if(o=e.sent,u=b(o)){e.next=15;break}return e.next=14,o.json();case 14:u=e.sent;case 15:u.status?t(U(u)):(i=n(),l=i.currentUser,t(j(u.chat)),t(A(l._id))),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),console.log("error",e.t0);case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(t,n){return e.apply(this,arguments)}}()));var r,a}}}))(ae);n(46);function ce(e){return function(t){return a.a.createElement("div",{className:"modalWindow"},a.a.createElement("div",null,a.a.createElement(e,t)))}}n(47);var oe=function(e){Object(H.a)(n,e);var t=Object(J.a)(n);function n(){var e;Object(I.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).onUserClick=function(){var t=e.props.user;e.props.onUserClick(t)},e}return Object(W.a)(n,[{key:"render",value:function(){var e=this.props.user;return a.a.createElement("div",{className:"userFrame",onClick:this.onUserClick},a.a.createElement("span",null,e.name))}}]),n}(a.a.Component);n(48);function ue(e){var t=e.caption,n=e.name,r=e.placeholder,s=e.type,c=e.value,o=e.onChange;return a.a.createElement("div",{className:"inputField"},a.a.createElement("label",null,t),a.a.createElement("input",{name:n,placeholder:r,type:s,value:c,onChange:o}))}n(16);var ie=function(e){Object(H.a)(n,e);var t=Object(J.a)(n);function n(){var e;Object(I.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).state={userSeekData:""},e.onSubmit=function(t){t.preventDefault(),e.props.onSubmitUserSeekData(e.state.userSeekData),e.setState({searchQueryString:""})},e.updateSearchQueryString=function(t){e.setState({userSeekData:t.target.value})},e}return Object(W.a)(n,[{key:"render",value:function(){return a.a.createElement("form",{onSubmit:this.onSubmit},a.a.createElement(ue,{caption:"User email",name:"userEmail",placeholder:"User email",type:"text",value:this.state.userSeekData,onChange:this.updateSearchQueryString}),a.a.createElement("div",{align:"center"},a.a.createElement("button",{className:"submitButton",type:"submit"},"Find users")))}}]),n}(a.a.Component),le=(n(49),n(50),n(51),function(e){Object(H.a)(n,e);var t=Object(J.a)(n);function n(){var e;Object(I.a)(this,n);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).onSubmitUserSeekData=function(t){e.props.findUsers(t)},e.renderUsersList=function(){var t=e.props,n=t.usersList,r=t.onUserClick;if(n&&n.length)return n.map((function(e){return a.a.createElement(oe,{onUserClick:r,key:e._id,user:e})}))},e}return Object(W.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"addToChatNewUserWindow"},a.a.createElement("h4",null,"Search for a new member"),a.a.createElement("button",{className:"closeButton",onClick:this.props.onCancelClick},"X"),a.a.createElement(ie,{onSubmitUserSeekData:this.onSubmitUserSeekData}),a.a.createElement("div",{className:"addToChatNewUserWindow-UsersList"},this.renderUsersList()))}}]),n}(a.a.Component)),pe=(n(52),function(e){Object(H.a)(n,e);var t=Object(J.a)(n);function n(){var e;Object(I.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).state={file:null,filePath:""},e.onSubmit=function(t){var n=e.state.file,r=e.props.onSubmit;t.preventDefault(),n&&r(n)},e.updateMessagesPreprocessorFile=function(t){e.setState({file:t.target.files[0],filePath:t.target.value})},e}return Object(W.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"specialMessagesPreprocessorMenu"},a.a.createElement("form",{onSubmit:this.onSubmit},a.a.createElement("h4",null,"+Chat"),a.a.createElement("input",{name:"messagesPreprocessorFile",type:"file",value:this.state.filePath,onChange:this.updateMessagesPreprocessorFile}),a.a.createElement("button",{type:"submit"},"Add special messages preprocessor"),a.a.createElement("button",{onClick:this.props.onCancelClick},"Cancel")))}}]),n}(a.a.Component)),me=(n(53),ce(le)),fe=ce(pe),de=function(e){Object(H.a)(n,e);var t=Object(J.a)(n);function n(e){var r;return Object(I.a)(this,n),(r=t.call(this,e)).onAddUserButtonClick=function(){r.setState({showAddedUserMenu:!0})},r.onAddSpecialMessagesPreprocessorButtonClick=function(){r.setState({showSpecialMessagesPreprocessorMenu:!0})},r.addNewUserToCurrentChat=function(e){r.cancelUserAdding(),r.props.addNewUserToCurrentChat(e)},r.cancelUserAdding=function(){r.setState({showAddedUserMenu:!1})},r.addNewSpecialMessagesPreprocessor=function(e){r.cancelSpecialMessagesPreprocessorAdding(),r.props.addNewSpecialMessagesPreprocessor(e)},r.cancelSpecialMessagesPreprocessorAdding=function(){r.setState({showSpecialMessagesPreprocessorMenu:!1})},r.renderAddedUserWindow=function(){var e=r.state,t=e.showAddedUserMenu,n=e.showSpecialMessagesPreprocessorMenu,s=r.props,c=s.currentChat,o=s.findUsers,u=s.usersList;return t?a.a.createElement(me,{findUsers:o,usersList:u,onUserClick:r.addNewUserToCurrentChat,onCancelClick:r.cancelUserAdding}):n?a.a.createElement(fe,{currentChat:c,onSubmit:r.addNewSpecialMessagesPreprocessor,onCancelClick:r.cancelSpecialMessagesPreprocessorAdding}):c._id?a.a.createElement(a.a.Fragment,null,a.a.createElement("button",{onClick:r.onAddUserButtonClick},"Add new user to chat"),a.a.createElement("button",{onClick:r.onAddSpecialMessagesPreprocessorButtonClick},"Add special messages preprocessor")):void 0},r.state={showAddedUserMenu:!1,showSpecialMessagesPreprocessorMenu:!1},r}return Object(W.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"currentChatSettings"},a.a.createElement("span",null,"Chat: ",this.props.currentChat.name),this.renderAddedUserWindow())}}]),n}(a.a.Component),he=Object(o.b)((function(e){return{currentChat:e.currentChat,usersList:e.usersList}}),(function(e){return{findUsers:function(t){return e(function(e){return function(){var t=Object(f.a)(m.a.mark((function t(n){var r,a,s;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,C();case 3:if(r=t.sent){t.next=6;break}return t.abrupt("return");case 6:return t.next=8,fetch("".concat(d).concat("users/search/","?user_seek_data=").concat(e),{method:"GET",headers:g(r)});case 8:if(a=t.sent,s=b(a)){t.next=14;break}return t.next=13,a.json();case 13:s=t.sent;case 14:s.badStatusText?(n(U(s)),localStorage.removeItem("token"),localStorage.removeItem("userJson")):n({type:"FILL_FOUND_USERS_LIST",payload:s}),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(0),console.log("error",t.t0);case 20:case"end":return t.stop()}}),t,null,[[0,17]])})));return function(e){return t.apply(this,arguments)}}()}(t))},addNewUserToCurrentChat:function(t){return e(function(e){return function(){var t=Object(f.a)(m.a.mark((function t(n,r){var a,s,c,o,u;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,C();case 3:if(a=t.sent){t.next=6;break}return t.abrupt("return");case 6:return s=r(),c=s.currentChat,t.next=9,fetch(d+"chats/addNewUser/",{method:"POST",headers:g(a),body:JSON.stringify({chatId:c._id,newUserId:e._id})});case 9:if(o=t.sent,u=b(o)){t.next=15;break}return t.next=14,o.json();case 14:u=t.sent;case 15:u.badStatusText?n(U(u)):n(j(u.chat)),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(0),console.log("error",t.t0);case 21:case"end":return t.stop()}}),t,null,[[0,18]])})));return function(e,n){return t.apply(this,arguments)}}()}(t))},addNewSpecialMessagesPreprocessor:function(t){return e(function(e){return function(){var t=Object(f.a)(m.a.mark((function t(n,r){var a,s,c,o,u,i;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,E(e);case 4:if(a=t.sent,(l=a)&&""!==l.trim()){t.next=8;break}return n(M({message:"File is empty or has wrong format"})),t.abrupt("return");case 8:if((s=JSON.parse(a)).forward&&s.backward){t.next=12;break}return n(M({message:"File has wrong format"})),t.abrupt("return");case 12:c=new Function("text",s.forward),o=new Function("text",s.backward),u=r(),i=u.currentChat,localStorage.setItem(i._id,a),n(_(c,o));case 17:case"end":return t.stop()}var l}),t)})));return function(e,n){return t.apply(this,arguments)}}()}(t))}}}))(de),ve=(n(54),function(e){Object(H.a)(n,e);var t=Object(J.a)(n);function n(){return Object(I.a)(this,n),t.apply(this,arguments)}return Object(W.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"settingsPanel"},a.a.createElement("button",{onClick:this.props.onSignOut},"Sign out"),a.a.createElement("span",null,this.props.currentUser.name))}}]),n}(a.a.Component)),ge=Object(o.b)((function(e){return{currentUser:e.currentUser}}),(function(e){return{onSignOut:function(){return e(x())}}}))(ve),be=(n(55),function(e){Object(H.a)(n,e);var t=Object(J.a)(n);function n(){var e;Object(I.a)(this,n);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).state={email:"",name:"",password:"",isRegistrationMode:!1},e.onSubmit=function(t){t.preventDefault();var n=e.state,r=n.email,a=n.name,s=n.password,c=n.isRegistrationMode,o=e.props,u=o.onAuthenticationSubmit,i=o.onRegistrationSubmit;c?i({email:r,name:a,password:s}):u(r,s),e.setState({email:"",name:"",password:""})},e.updateUserEmailValue=function(t){e.setState({email:t.target.value})},e.updateUserNameValue=function(t){e.setState({name:t.target.value})},e.updateUserPasswordValue=function(t){e.setState({password:t.target.value})},e.changeMode=function(t){var n=t.target.checked;e.setState({isRegistrationMode:n})},e.renderHeader=function(){var t;return t=e.state.isRegistrationMode?"New user registration":"Login",a.a.createElement("h3",{className:"authenticationAndRegistrationForm__Header"},t)},e.renderUserNameInputField=function(){if(e.state.isRegistrationMode)return a.a.createElement(ue,{caption:"User name",name:"userName",placeholder:"User name",type:"text",value:e.state.name,onChange:e.updateUserNameValue})},e.renderSubmitButton=function(){var t;return t=e.state.isRegistrationMode?"Sign up":"Sign in",a.a.createElement("button",{className:"submitButton",type:"submit"},t)},e}return Object(W.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"authenticationAndRegistrationForm"},a.a.createElement("input",{type:"checkbox",name:"changeMode",onClick:this.changeMode}),a.a.createElement("span",null,"Registration"),a.a.createElement("form",{onSubmit:this.onSubmit},a.a.createElement("div",{align:"center"},this.renderHeader()),this.renderUserNameInputField(),a.a.createElement(ue,{caption:"User email",name:"userEmail",placeholder:"User email",type:"text",value:this.state.email,onChange:this.updateUserEmailValue}),a.a.createElement(ue,{caption:"User password",name:"userPassword",placeholder:"User password",type:"text",value:this.state.password,onChange:this.updateUserPasswordValue}),a.a.createElement("div",{align:"center"},this.renderSubmitButton())))}}]),n}(a.a.Component));n(56);function Se(e){return a.a.createElement("div",{className:"authenticationAndRegistrationWindow"},a.a.createElement(be,e))}n(57);n(58);var Ee=ce((function(e){var t,n,r,s=e.lastError,c=s.status,o=s.badStatusText,u=s.message;return c&&(t=a.a.createElement("p",null,"Status: ",c),n=a.a.createElement("p",null,"Status text: ",o),r=a.a.createElement("p",null,"Message: ",u)),a.a.createElement("div",{className:"errorWindow"},a.a.createElement("div",null,a.a.createElement("h4",null,"Error")),a.a.createElement("div",null,t,n,r),a.a.createElement("button",{onClick:e.onOk},"Ok"))})),we=function(e){Object(H.a)(n,e);var t=Object(J.a)(n);function n(){var e;Object(I.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).onSignOut=function(){e.props.resetAuthenticationResult()},e}return Object(W.a)(n,[{key:"componentDidMount",value:function(){this.props.checkIsUserAuthenticated()}},{key:"renderErrorWindow",value:function(){if(this.props.lastError)return a.a.createElement(Ee,{onOk:this.props.clearLastError,lastError:this.props.lastError})}},{key:"renderMainContent",value:function(){return this.props.isUserAuthenticated?a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"main-panel"},a.a.createElement(se,null),a.a.createElement(K,null)),a.a.createElement("div",{className:"top-panel"},a.a.createElement(ge,null),a.a.createElement(he,null))):a.a.createElement(Se,{onAuthenticationSubmit:this.props.submitUserEmailAndPassword,onRegistrationSubmit:this.props.submitNewUser})}},{key:"render",value:function(){return a.a.createElement(a.a.Fragment,null,this.renderErrorWindow(),a.a.createElement("div",{className:"appPanel"},this.renderMainContent()))}}]),n}(a.a.Component),Ce=Object(o.b)((function(e){return{currentUser:e.currentUser,currentChat:e.currentChat,wasMessageReceived:e.wasMessageReceived,isUserAuthenticated:e.isUserAuthenticated,lastError:e.lastError}}),(function(e){return{checkIsUserAuthenticated:function(){return e(function(){var e=Object(f.a)(m.a.mark((function e(t){var n,r,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=localStorage,r=n.userJson,e.prev=1,r){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,JSON.parse(r);case 6:a=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(1),localStorage.removeItem("userJson"),e.abrupt("return");case 13:t(O(a)),t(N(!0)),t(A(a._id));case 16:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}())},sendNewMessage:function(t){return e(L(t))},submitUserEmailAndPassword:function(t,n){return e((r=t,a=n,function(){var e=Object(f.a)(m.a.mark((function e(t){var n,s,c,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,S(r)){e.next=4;break}return t(M({message:"Bad email: ".concat(r)})),e.abrupt("return");case 4:return n={user:{email:r,name:"",password:a}},e.next=7,fetch(d+"users/login/",{method:"POST",headers:v,body:JSON.stringify(n)});case 7:if(s=e.sent,c=b(s)){e.next=13;break}return e.next=12,s.json();case 12:c=e.sent;case 13:c.badStatusText?(t(U(c)),t(N(!1))):(o=c.user._id,localStorage.setItem("userJson",JSON.stringify(c.user)),t(O(c.user)),t(N(!0)),t(A(o))),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),console.log("error",e.t0);case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t){return e.apply(this,arguments)}}()));var r,a},submitNewUser:function(t){return e(function(e){return function(){var t=Object(f.a)(m.a.mark((function t(n){var r,a,s;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,S(e.email)){t.next=4;break}return n(M({message:"Bad email: ".concat(e.email)})),t.abrupt("return");case 4:return t.next=6,fetch(d+"users/new/",{method:"POST",headers:v,body:JSON.stringify({user:e})});case 6:if(r=t.sent,a=b(r)){t.next=12;break}return t.next=11,r.json();case 11:a=t.sent;case 12:a.badStatusText?(n(U(a)),n(N(!1))):(s=a.user._id,localStorage.setItem("userJson",JSON.stringify(a.user)),n(O(a.user)),n(k({})),n(N(!0)),n(A(s))),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(0),console.log("error",t.t0);case 18:case"end":return t.stop()}}),t,null,[[0,15]])})));return function(e){return t.apply(this,arguments)}}()}(t))},resetAuthenticationResult:function(){return e(x())},clearLastError:function(){return e({type:"CLEAR_LAST_ERROR"})}}}))(we);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ye=Object(u.d)(D,Object(u.a)(i.a,P));c.a.render(a.a.createElement(o.a,{store:ye},a.a.createElement(Ce,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}],[[19,1,2]]]);
//# sourceMappingURL=main.75ba4c1b.chunk.js.map